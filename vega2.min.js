!function(a,b){if("function"==typeof define&&define.amd)define(["d3","topojson"],b);else if("object"==typeof exports)module.exports=b(require("d3"),require("topojson"));else{var c="undefined"==typeof topojson?null:topojson;a.vg=b(d3,c)}}(this,function(a,b){var c,e,f;return function(a){function b(a,b){return u.call(a,b)}function d(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return d(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,e=k(a),f=e[0];return a=e[1],f&&(f=d(f,b),c=j(f)),f?a=c&&c.normalize?c.normalize(a,h(b)):d(a,b):(a=d(a,b),e=k(a),f=e[0],a=e[1],f&&(c=j(f))),{f:f?f+"!"+a:a,n:a,pr:f,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=e=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,f=function(a,c,d){c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},f.amd={jQuery:!0}}(),f("../node_modules/almond/almond",function(){}),f("core/changeset",[],function(){function a(a,b){var d={};return c(a,d),d.add=[],d.mod=[],d.rem=[],d.touch=b,d}function b(){}function c(a,b){a||(a={}),b.stamp=a.stamp||0,a.sort&&(b.sort=a.sort),a.facet&&(b.facet=a.facet),a.trans&&(b.trans=a.trans),["signals","fields","data","scales"].forEach(function(c){b[c]=a[c]||{}})}return{create:a,done:b,copy:c}}),f("util/config",["require","exports","module","d3"],function(a,b,c){var d=a("d3"),e={};return e.debug=!1,e.isNode="undefined"!=typeof c&&this.exports!==c,e.domainWhiteList=!1,e.safeMode=!1,e.baseURL="",e.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',e.autopadInset=5,e.scale={time:d.time.scale,utc:d.time.scale.utc},e.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},e.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},e.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},e.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},e.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e}),f("util/index",["require","exports","module","./config"],function(a){function b(a){return a.replace(h,"$1\\'")}function c(a,b,c){var d=0,e=a.split(i);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function d(a){console.log(a)}var e=a("./config"),f={},g=Object.prototype.toString;f.isObject=function(a){return a===Object(a)},f.isFunction=function(a){return"[object Function]"==g.call(a)},f.isString=function(a){return"[object String]"==g.call(a)},f.isArray=Array.isArray||function(a){return"[object Array]"==g.call(a)},f.isNumber=function(a){return"[object Number]"==g.call(a)},f.isBoolean=function(a){return"[object Boolean]"==g.call(a)},f.isTree=function(a){return a&&a.__vgtree__},f.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},f.number=function(a){return+a},f["boolean"]=function(a){return!!a},f.identity=function(a){return a},f["true"]=function(){return!0},f.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},f.duplicate=function(a){return JSON.parse(JSON.stringify(a))},f.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},f.accessor=function(a){var b;return f.isFunction(a)||null==a?a:f.isString(a)&&(b=f.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},f.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=f.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),f.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},f.cmp=function(a,b){return b>a?-1:a>b?1:0},f.numcmp=function(a,b){return a-b},f.array=function(a){return null!=a?f.isArray(a)?a:[a]:[]},f.values=function(a){return f.isObject(a)&&!f.isArray(a)&&a.values?f.isFunction(a.values)?a.values():a.values:a},f.tuple_ids=function(a){return a.reduce(function(a,b){return a[b._id]=1,a},{})},f.str=function(a){return f.isArray(a)?"["+a.map(f.str)+"]":f.isObject(a)?JSON.stringify(a):f.isString(a)?"'"+b(a)+"'":a};var h=/(^|[^\\])'/g;f.keys=function(a){var b=[];for(var c in a)b.push(c);return b},f.unique=function(a,b,c){if(!f.isArray(a)||0==a.length)return[];b=b||f.identity,c=c||[];for(var d,e=0,g=a.length;g>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},f.minIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),d>e&&(d=e,c=g);return c},f.maxIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),e>d&&(d=e,c=g);return c},f.truncate=function(a,b,d,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(d){case"left":return f+(e?c(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?c(a,i):a.slice(0,i))+f+(e?c(a,j,1):a.slice(g-j));default:return(e?c(a,h):a.slice(0,h))+f}};var i=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;return f.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:e.render.fontSize)+"px "+(a.font||e.render.font)},f.log=function(a){d("[Vega Log] "+a)},f.error=function(a){a="[Vega Err] "+a,d(a),"undefined"!=typeof alert&&alert(a)},f.debug=function(a,b){if(e.debug){var c=Function.prototype.bind.call(console.log,console);b.unshift(a.stamp||-1),a.add&&b.push(a.add.length,a.mod.length,a.rem.length,!!a.touch),c.apply(console,b)}},f}),f("util/constants",["require","exports","module"],function(){return{GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},MODIFY_ADD:"add",MODIFY_REMOVE:"remove",MODIFY_TOGGLE:"toggle",MODIFY_CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",MARK:"mark",AXIS:"axis"}}),f("core/tuple",["require","exports","module","../util/index","../util/constants"],function(a){function b(a,b){var c=Object.create(f.isObject(a)?a:{data:a});return c._id=++h,c._prev=b||g.SENTINEL,c}function c(a,b,c){var e=a[b];e!==c&&(e&&a._prev&&d(a,b),a[b]=c)}function d(a,b,c){a._prev=a._prev===g.SENTINEL?{}:a._prev,a._prev[b]={value:a[b],stamp:c}}function e(){h=1}var f=a("../util/index"),g=a("../util/constants"),h=1;return{create:b,set:c,prev:d,reset:e}}),f("core/collector",["require","exports","module","../core/changeset","../util/index"],function(a){var b=a("../core/changeset"),c=a("../util/index");return function(a,e){function f(a){var b,c;for(b=0,c=e.length;c>b;b++){var d=e[b];if(d==h)break;"collector"!=d._type&&d.data&&a(d)}}var g=[];e||(e=[]);var h=new a.Node(function(a){if(c.debug(a,["collecting"]),a.touch)0==e.length&&(a=b.create(a),a.mod=g.slice());else{if(a.rem.length){var d=a.rem.reduce(function(a,b){return a[b._id]=1,a},{});g=g.filter(function(a){return 1!==d[a._id]})}a.add.length&&(g=g.length?g.concat(a.add):a.add),a.sort&&g.sort(a.sort)}return e.length>0&&(h.data(),a.touch=!0),a});return h.data=function(){var a,b,c,e,h={};if(f(function(a){a.data().forEach(function(a){e=h[a._id]||(h[a._id]={});for(c in a)e[c]=a[c]})}),Object.keys(h).length)for(a=0,b=g.length;b>a;a++){d=g[a];for(c in h[d._id])d[c]=h[d._id][c]}return g},h._type="collector",h._router=!0,h._touchable=!0,f(function(a){a.parentCollector=h}),h}}),f("core/Datasource",["require","exports","module","./changeset","./tuple","./collector","../util/index","../util/constants"],function(a){var b=a("./changeset"),c=a("./tuple"),d=a("./collector"),e=a("../util/index"),f=a("../util/constants");return function(a){function g(a,c){this._name=a,this._data=[],this._source=null,this._facet=c,this._input=b.create(),this._output=null,this._pipeline=null,this._collector=null}return g.prototype.add=function(a){var b=this._input.add;return b.push.apply(b,e.array(a).map(function(a){return c.create(a)})),this},g.prototype.remove=function(a){var b=this._data.filter(a);return this._input.rem.push.apply(this._input.rem,b),this},g.prototype.update=function(a,b,d){var e=this._input.mod;return this._input.fields[b]=1,this._data.filter(a).forEach(function(a){var f=a[b],g=d(a);f!==g&&(c.prev(a,b),a.__proto__[b]=g,e.indexOf(a)<0&&e.push(a))}),this},g.prototype.values=function(a){return arguments.length?(this._input.rem=this._data.slice(),a&&this.add(a),this):this._collector?this._collector.data():this._data},g.prototype.source=function(b){return arguments.length?(this._source=a.data(b),this):this._source},g.prototype.fire=function(){a.graph.propagate(this._input,this._pipeline[0])},g.prototype.pipeline=function(c){var g=this;c.length&&(g._collector=d(a,c),c.push(g._collector));var h=new a.Node(function(a){e.debug(a,["input",g._name]);var c=g._input,d=b.create(a);if(d.facet=g._facet,a.touch)d.mod=g._source?g._source.values().slice():g._data.slice();else{var c=g._input,h=e.tuple_ids(c.rem);g._data=g._data.filter(function(a){return 1!==h[a._id]}).concat(c.add),g._input=b.create(),d.add=c.add,d.rem=c.rem,d.mod=c.mod.map(function(b){var c;if(b._prev===f.SENTINEL)return b;for(c in b._prev)void 0===b._prev[c].stamp&&(b._prev[c].stamp=a.stamp);return b})}return d});h._type="input",h._router=!0,h._touchable=!0,c.unshift(h),a.addListener(h);var i=new a.Node(function(a){e.debug(a,["output",g._name]),g._output=a;var c=b.create(a,!0);return c.data[g._name]=1,c});return i._type="output",i._router=!0,i._touchable=!0,c.push(i),g._pipeline=c,a.graph.connect(g._pipeline),this},g.prototype.addListener=function(b){if(b instanceof g){var c=this,d=b;b=new a.Node(function(a){return d._input=c._output,a}),b.addListener(d._pipeline[0])}this._pipeline[this._pipeline.length-1].addListener(b)},g.prototype.removeListener=function(a){this._pipeline[this._pipeline.length-1].removeListener(a)},g}}),f("core/Signal",["require","exports","module","./changeset","../util/index"],function(a){{var b=a("./changeset");a("../util/index")}return function(a){function c(b,c){this._name=b,this._value=c,this._node=new a.Node}return c.prototype.name=function(){return this._name},c.prototype.node=function(a){return arguments.length?(this._node=a,this):this._node},c.prototype.value=function(a){return arguments.length?(this._value=a,this):this._value},c.prototype.fire=function(){var c=b.create({},!0);c.signals[this._name]=1,a.graph.propagate(c,this._node)},c.prototype.addListener=function(a){a instanceof c&&(a=a.node()),this._node.addListener(a)},c.prototype.removeListener=function(a){a instanceof c&&(a=a.node()),this._node.removeListener(a)},c}}),f("core/Node",[],function(){return function(a){function b(b,d){if(this._type="operator",this._fn=b||function(a){return a},this._rank=++a._rank,this._listeners=[],this._deps=c(),this._stamp=0,this._router=!1,this._touchable=!1,d)for(var e=0,f=d.length;f>e;e++)this.addListener(d[e])}function c(a,b,c,d){return{signals:a||[],fields:b||[],data:c||[],scales:d||[]}}return b.prototype.addListener=function(c){if(!(c instanceof b))throw"Listener is not a Node";if(-1===this._listeners.indexOf(c)&&(this._listeners.push(c),this._rank>c._rank))for(var d=[c];d.length;){var e=d.splice(0,1)[0];e._rank=++a._rank,d=d.concat(e._listeners)}},b.prototype.removeListener=function(a){for(var b=!1,c=0,d=this._listeners.length;d>c&&!b;c++)this._listeners[c]===a&&(this._listeners.splice(c,1),b=!0);return b},b.prototype.reevaluate=function(a){var b=this,c=!1;return["signals","fields","data","scales"].some(function(d){return c=c||b._deps[d].some(function(b){return!!a[d][b]})})},b.dependency=c,b.reset=function(){rank=0},b}}),f("core/graph",["require","exports","module","d3","./changeset","../util/index"],function(a){var b=a("d3"),c=(a("./changeset"),a("../util/index"));return function(a){function d(b,d){var e,f,g,j,k,l,m,n=[];if(n.enq=function(a){var b=i.left(this,a);this.splice(b,0,a)},b.stamp)throw"Pulse already has a non-zero stamp";for(b.stamp=++a._stamp,n.enq({node:d,pulse:b,rank:d._rank});n.length>0;)if(e=n.pop(),g=e.node,j=e.pulse,k=e.rank,f=g._listeners,k==g._rank){var o=j.touch&&g._stamp>=j.stamp;if(!o){var p=!!j.add.length||!!j.rem.length||g._router;if(p=p||!o,p=p||g.reevaluate(j),p&&(b=g._fn(j),g._stamp=b.stamp),b!=h||!p)for(l=0,m=f.length;m>l;l++)n.enq({node:f[l],pulse:b,rank:f[l]._rank})}}else c.debug(j,["Rank mismatch",k,g._rank]),n.enq({node:g,pulse:j,rank:g._rank})}function e(a,b){var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=a[c],f._touchable&&(e=f),b(f,e,c)}function f(b){return c.debug({},["connecting"]),e(b,function(c,d,e){(c._deps.data.length>0||c._deps.signals.length>0)&&(c._deps.data.forEach(function(b){a.data(b).addListener(d)}),c._deps.signals.forEach(function(b){a.signal(b).addListener(d)})),e>0&&b[e-1].addListener(b[e])}),b}function g(b){return c.debug({},["disconnecting"]),e(b,function(b,c){b._listeners.forEach(function(a){b.removeListener(a)}),b._deps.data.forEach(function(b){a.data(b).removeListener(c)}),b._deps.signals.forEach(function(b){a.signal(b).removeListener(c)})}),b}var h={},i=b.bisector(function(a,b){return a.node==b.node?a.pulse.touch?-1:1:b.rank-a.rank});return{propagate:d,doNotPropagate:h,connect:f,disconnect:g}}}),f("scene/encode",["require","exports","module","../util/index","../util/constants"],function(a){var b=a("../util/index"),c=a("../util/constants"),d={};return function(a,e){function f(b,c,d,e){var f=a.signalValues(b.signals||[]),g={};(b.data||[]).forEach(function(b){g[b]=a.data(b).values()}),b.encode.call(b.encode,e,c,c.mark.group||c,d,g,f,a._predicates)}var g=e.def.properties||{},h=g.enter,i=g.update,j=g.exit,k=new a.Node(function(a){b.debug(a,["encoding",e.def.type]);var g,k,l=e.items;for(g=0;g<l.length;++g)k=l[g],k.status===c.ENTER&&(h&&f(h,k,a.trans,a.stamp),k.status=c.UPDATE),k.status!==c.EXIT&&i&&f(i,k,a.trans,a.stamp),k.status===c.EXIT&&(j&&f(j,k,a.trans,a.stamp),a.trans&&!j?a.trans.interpolate(k,d):a.trans||l[g--].remove());return a}),l=k._deps;return i&&(l.signals=i.signals,l.scales=i.scales,l.data=i.data),k}}),f("core/Bounds",["require","exports","module"],function(){var a=function(a){this.clear(),a&&this.union(a)},b=a.prototype;return b.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},b.set=function(a,b,c,d){return this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},b.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},b.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},b.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},b.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},b.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this.x1,i=this.x2,j=this.y1,k=this.y2;return this.clear().add(d*h-e*j+f,e*h+d*j+g).add(d*h-e*k+f,e*h+d*k+g).add(d*i-e*j+f,e*i+d*j+g).add(d*i-e*k+f,e*i+d*k+g)},b.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},b.encloses=function(a){return a&&this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2},b.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},b.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},b.width=function(){return this.x2-this.x1},b.height=function(){return this.y2-this.y1},a}),f("canvas/path",["require","exports","module","d3","../core/Bounds"],function(a){function b(a){var b,c,d,e=[];a=a.slice().replace(o[0],"###$1").split(o[1]).slice(1);for(var f,g,h=0,i=a.length;i>h;h++){b=a[h],c=b.slice(1).trim().replace(o[2],"$1###-").split(o[3]),g=[b.charAt(0)];for(var f=0,j=c.length;j>f;f++)d=parseFloat(c[f]),isNaN(d)||g.push(d);var k=g[0].toLowerCase(),l=n[k];if(g.length-1>l)for(var m=1,p=g.length;p>m;m+=l)e.push([g[0]].concat(g.slice(m,m+l)));else e.push(g)}return e}function c(a,b,c,d,g,h,i){for(var j=d[0],k=d[1],l=d[2],m=d[3],n=d[4],o=d[5],p=d[6],q=e(o,p,j,k,m,n,l,b,c),r=0;r<q.length;r++){var s=f.apply(null,q[r]);a.bezierCurveTo.apply(a,s),g.add(s[0]-h,s[1]-i),g.add(s[2]-h,s[3]-i),g.add(s[4]-h,s[5]-i)}}function d(a,b,c,d){for(var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=e(l,m,g,h,j,k,i,a,b),o=0;o<n.length;o++){var p=f.apply(null,n[o]);d.add(p[0],p[1]),d.add(p[2],p[3]),d.add(p[4],p[5])}}function e(a,b,c,d,e,f,g,h,i){if(k=r.call(arguments),p[k])return p[k];var j=g*(Math.PI/180),l=Math.sin(j),m=Math.cos(j);c=Math.abs(c),d=Math.abs(d);var n=m*(h-a)*.5+l*(i-b)*.5,o=m*(i-b)*.5-l*(h-a)*.5,q=n*n/(c*c)+o*o/(d*d);q>1&&(q=Math.sqrt(q),c*=q,d*=q);var s=m/c,t=l/c,u=-l/d,v=m/d,w=s*h+t*i,x=u*h+v*i,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;0>B&&(B=0);var C=Math.sqrt(B);f==e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1==f?H+=2*Math.PI:H>0&&0==f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,l,m]}return p[k]=J}function f(a,b,c,d,e,f,g,h){if(k=r.call(arguments),q[k])return q[k];var i=h*e,j=-g*f,l=g*e,m=h*f,n=Math.cos(c),o=Math.sin(c),p=Math.cos(d),s=Math.sin(d),t=.5*(d-c),u=Math.sin(.5*t),v=8/3*u*u/Math.sin(t),w=a+n-v*o,x=b+o+v*n,y=a+p,z=b+s,A=y+v*s,B=z-v*p;return q[k]=[i*w+j*x,l*w+m*x,i*A+j*B,l*A+m*B,i*y+j*z,l*y+m*z]}function g(a,b,d,e){var f,g,h,i,j,k=null,l=0,n=0,o=0,p=0,q=new m;void 0==d&&(d=0),void 0==e&&(e=0),a.beginPath();for(var r=0,s=b.length;s>r;++r){switch(f=b[r],f[0]){case"l":l+=f[1],n+=f[2],a.lineTo(l+d,n+e),q.add(l,n);break;case"L":l=f[1],n=f[2],a.lineTo(l+d,n+e),q.add(l,n);break;case"h":l+=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"H":l=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"v":n+=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"V":n=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"m":l+=f[1],n+=f[2],a.moveTo(l+d,n+e),q.add(l,n);break;case"M":l=f[1],n=f[2],a.moveTo(l+d,n+e),q.add(l,n);break;case"c":g=l+f[5],h=n+f[6],o=l+f[3],p=n+f[4],a.bezierCurveTo(l+f[1]+d,n+f[2]+e,o+d,p+e,g+d,h+e),q.add(l+f[1],n+f[2]),q.add(o,p),q.add(g,h),l=g,n=h;break;case"C":l=f[5],n=f[6],o=f[3],p=f[4],a.bezierCurveTo(f[1]+d,f[2]+e,o+d,p+e,l+d,n+e),q.add(f[1],f[2]),q.add(o,p),q.add(l,n);break;case"s":g=l+f[3],h=n+f[4],o=2*l-o,p=2*n-p,a.bezierCurveTo(o+d,p+e,l+f[1]+d,n+f[2]+e,g+d,h+e),q.add(o,p),q.add(l+f[1],n+f[2]),q.add(g,h),o=l+f[1],p=n+f[2],l=g,n=h;break;case"S":g=f[3],h=f[4],o=2*l-o,p=2*n-p,a.bezierCurveTo(o+d,p+e,f[1]+d,f[2]+e,g+d,h+e),l=g,n=h,q.add(f[1],f[2]),q.add(o,p),q.add(g,h),o=f[1],p=f[2];break;case"q":g=l+f[3],h=n+f[4],o=l+f[1],p=n+f[2],a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,q.add(o,p),q.add(g,h);break;case"Q":g=f[3],h=f[4],a.quadraticCurveTo(f[1]+d,f[2]+e,g+d,h+e),l=g,n=h,o=f[1],p=f[2],q.add(o,p),q.add(g,h);break;case"t":g=l+f[1],h=n+f[2],null===k[0].match(/[QqTt]/)?(o=l,p=n):"t"===k[0]?(o=2*l-i,p=2*n-j):"q"===k[0]&&(o=2*l-o,p=2*n-p),i=o,j=p,a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,o=l+f[1],p=n+f[2],q.add(o,p),q.add(g,h);break;case"T":g=f[1],h=f[2],o=2*l-o,p=2*n-p,a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,q.add(o,p),q.add(g,h);break;case"a":c(a,l+d,n+e,[f[1],f[2],f[3],f[4],f[5],f[6]+l+d,f[7]+n+e],q,d,e),l+=f[6],n+=f[7];break;case"A":c(a,l+d,n+e,[f[1],f[2],f[3],f[4],f[5],f[6]+d,f[7]+e],q,d,e),l=f[6],n=f[7];break;case"z":case"Z":a.closePath()}k=f}return q.translate(d,e)}function h(a,b){for(var c,e,f,g,h,i=null,j=0,k=0,l=0,m=0,n=0,o=a.length;o>n;++n){switch(c=a[n],c[0]){case"l":j+=c[1],k+=c[2],b.add(j,k);break;case"L":j=c[1],k=c[2],b.add(j,k);break;case"h":j+=c[1],b.add(j,k);break;case"H":j=c[1],b.add(j,k);break;case"v":k+=c[1],b.add(j,k);break;case"V":k=c[1],b.add(j,k);break;case"m":j+=c[1],k+=c[2],b.add(j,k);break;case"M":j=c[1],k=c[2],b.add(j,k);break;case"c":e=j+c[5],f=k+c[6],l=j+c[3],m=k+c[4],b.add(j+c[1],k+c[2]),b.add(l,m),b.add(e,f),j=e,k=f;break;case"C":j=c[5],k=c[6],l=c[3],m=c[4],b.add(c[1],c[2]),b.add(l,m),b.add(j,k);break;case"s":e=j+c[3],f=k+c[4],l=2*j-l,m=2*k-m,b.add(l,m),b.add(j+c[1],k+c[2]),b.add(e,f),l=j+c[1],m=k+c[2],j=e,k=f;break;case"S":e=c[3],f=c[4],l=2*j-l,m=2*k-m,j=e,k=f,b.add(c[1],c[2]),b.add(l,m),b.add(e,f),l=c[1],m=c[2];break;case"q":e=j+c[3],f=k+c[4],l=j+c[1],m=k+c[2],j=e,k=f,b.add(l,m),b.add(e,f);break;case"Q":e=c[3],f=c[4],j=e,k=f,l=c[1],m=c[2],b.add(l,m),b.add(e,f);break;case"t":e=j+c[1],f=k+c[2],null===i[0].match(/[QqTt]/)?(l=j,m=k):"t"===i[0]?(l=2*j-g,m=2*k-h):"q"===i[0]&&(l=2*j-l,m=2*k-m),g=l,h=m,j=e,k=f,l=j+c[1],m=k+c[2],b.add(l,m),b.add(e,f);break;case"T":e=c[1],f=c[2],l=2*j-l,m=2*k-m,j=e,k=f,b.add(l,m),b.add(e,f);break;case"a":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6]+j,c[7]+k],b),j+=c[6],k+=c[7];break;case"A":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6],c[7]],b),j=c[6],k=c[7];break;case"z":case"Z":}i=c}return b}function i(a){var b=a[0],c=l.svg.area().x(function(a){return a.x}).y1(function(a){return a.y}).y0(function(a){return a.y+a.height});return b.interpolate&&c.interpolate(b.interpolate),null!=b.tension&&c.tension(b.tension),c(a)}function j(a){var b=a[0],c=l.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return b.interpolate&&c.interpolate(b.interpolate),null!=b.tension&&c.tension(b.tension),c(a)}var k,l=a("d3"),m=a("../core/Bounds"),n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},o=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],p={},q={},r=Array.prototype.join;return{parse:b,render:g,bounds:h,area:i,line:j}}),f("util/bounds",["require","exports","module","../core/Bounds","../canvas/path","./index","./config"],function(b){function c(){return B||(B=a.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node().getContext("2d"))}function d(a,b,c){return null==b?c.set(0,0,0,0):(v(b,c),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&c.expand(a.strokeWidth)),c}function e(a,b){var c=a.path?a.pathCache||(a.pathCache=u(a.path)):null;return d(a,c,b)}function f(a,b){var c=a.mark.items,a=c[0],e=a.pathCache||(a.pathCache=u(w(c)));return d(c[0],e,b)}function g(a,b){var c=a.mark.items,a=c[0],e=a.pathCache||(a.pathCache=u(x(c)));return d(c[0],e,b)}function h(a,b){var c=a.x||0,d=a.y||0,e=c+a.width||0,f=d+a.height||0;return b.set(c,d,e,f),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function i(a,b){var c=a.width||0,d=a.height||0,e=(a.x||0)-("center"===a.align?c/2:"right"===a.align?c:0),f=(a.y||0)-("middle"===a.baseline?d/2:"bottom"===a.baseline?d:0);return b.set(e,f,e+c,f+d)}function j(a,b){var c,d;return b.set(c=a.x||0,d=a.y||0,null!=a.x2?a.x2:c,null!=a.y2?a.y2:d),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function k(a,b){var c,d,e,f,g,h,i,j,k,l=a.x||0,m=a.y||0,n=a.innerRadius||0,o=a.outerRadius||0,p=(a.startAngle||0)-y,q=(a.endAngle||0)-y,r=1/0,s=-1/0,t=1/0,u=-1/0,v=[p,q],w=p-p%y;for(d=0;4>d&&q>w;++d,w+=y)v.push(w);for(d=0,e=v.length;e>d;++d)c=v[d],f=Math.cos(c),h=n*f,j=o*f,g=Math.sin(c),i=n*g,k=o*g,r=Math.min(r,h,j),s=Math.max(s,h,j),t=Math.min(t,i,k),u=Math.max(u,i,k);return b.set(l+r,m+t,l+s,m+u),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function l(a,b){var c,d,e,f,g=null!=a.size?a.size:100,h=a.x||0,i=a.y||0;switch(a.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,b.set(h-d,i-c,h+d,i+c);break;case"diamond":f=Math.sqrt(g/(2*A)),e=f*A,b.set(h-e,i-f,h+e,i+f);break;case"square":d=Math.sqrt(g),c=d/2,b.set(h-c,i-c,h+c,i+c);break;case"triangle-down":e=Math.sqrt(g/z),f=e*z/2,b.set(h-e,i-f,h+e,i+f);break;case"triangle-up":e=Math.sqrt(g/z),f=e*z/2,b.set(h-e,i-f,h+e,i+f);break;default:c=Math.sqrt(g/Math.PI),b.set(h-c,i-c,h+c,i+c)}return a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function m(a,b,d){var e,f,g=(a.x||0)+(a.dx||0),h=(a.y||0)+(a.dy||0),i=a.fontSize||t.render.fontSize,j=a.align,k=a.baseline,l=a.radius||0,m=c();return m.font=s.fontString(a),m.textAlign=j||"left",m.textBaseline=k||"alphabetic",e=m.measureText(a.text||"").width,l&&(f=(a.theta||0)-Math.PI/2,g+=l*Math.cos(f),h+=l*Math.sin(f)),"center"===j?g-=e/2:"right"===j&&(g-=e),"top"===k?h+=i/5:"bottom"===k?h-=i:"middle"===k?h=h-i/2+i/10:h-=4*i/5,b.set(g,h,g+e,h+i),a.angle&&!d&&b.rotate(a.angle*Math.PI/180,a.x||0,a.y||0),b.expand(d?0:1)}function n(a,b,c){var d,e,f=a.axisItems||[],g=a.legendItems||[];for(d=0,e=f.length;e>d;++d)b.union(f[d].bounds);for(d=0,e=a.items.length;e>d;++d)b.union(a.items[d].bounds);if(c){for(d=0,e=g.length;e>d;++d)b.union(g[d].bounds);null!=a.width&&null!=a.height&&b.add(a.width,a.height),null!=a.x&&null!=a.y&&b.add(0,0)}return b.translate(a.x||0,a.y||0),b}function o(a,b,c){b=b||C[a.mark.marktype],a.bounds_prev||(a["bounds:prev"]=new q);var d=a.bounds,e=a["bounds:prev"];return d&&e.clear().union(d),a.bounds=b(a,d?d.clear():new q,c),d||e.clear().union(a.bounds),a.bounds}function p(a,b,c){b=b||a.bounds&&a.bounds.clear()||new q;var d,e,f=a.marktype,g=C[f],h=a.items;if("area"===f||"line"===f)h.length&&(h[0].bounds=g(h[0],b));else for(d=0,e=h.length;e>d;++d)b.union(o(h[d],g,c));a.bounds=b}var q=b("../core/Bounds"),r=b("../canvas/path"),s=b("./index"),t=b("./config"),u=r.parse,v=r.bounds,w=r.area,x=r.line,y=Math.PI/2,z=Math.sqrt(3),A=Math.tan(30*Math.PI/180),B=null,C={group:n,symbol:l,image:i,rect:h,rule:j,arc:k,text:m,path:e,area:f,line:g};return{mark:p,item:o,text:m,group:n}}),f("scene/bounds",["require","exports","module","../util/bounds","../util/constants","../util/index"],function(a){var b=a("../util/bounds"),c=a("../util/constants"),d=a("../util/index");return function(a,e){var f=new a.Node(function(a){return d.debug(a,["bounds",e.marktype]),b.mark(e),e.marktype===c.GROUP&&b.mark(e,null,!1),a.touch=!0,a});return f}}),f("parse/scale",["require","exports","module","d3","../util/config","../util/index","../util/constants"],function(a){function b(a,b,f){var g=c(b,f.scale(b.name)),h=g.type===p?d:e,i=j(a,b,f),k=m.values(f.datum);return h(a,b,g,i,k),g}function c(a,b){var c=a.type||o;if(!b||c!==b.type){var d=l.scale[c]||k.scale[c];d||m.error("Unrecognized scale type: "+c),(b=d()).type=b.type||c,b.scaleName=a.name}return b}function d(a,b,c,d,e){var g,i,j,k,l=!1;m.isObject(b.range)&&!m.isArray(b.range)&&(l=!0,k=b.range.fields||m.array(b.range),d=f(a,k,e)),i=b.sort&&!l,g=h(a,b,e,i),g&&c.domain(g),j="string"==typeof d[0],j||d.length>2||1===d.length||l?c.range(d):b.points?c.rangePoints(d,b.padding||0):b.round||void 0===b.round?c.rangeRoundBands(d,b.padding||0):c.rangeBands(d,b.padding||0)}function e(a,b,c,d,e){var f,g;f=b.type===t?h(a,b,e,!1):i(a,b,e),c.domain(f),"height"===b.range&&(d=d.reverse()),c[b.round&&c.rangeRound?"rangeRound":"range"](d),b.exponent&&b.type===r&&c.exponent(b.exponent),b.clamp&&c.clamp(!0),b.nice&&(b.type===s?(g=k.time[b.nice],g||m.error("Unrecognized interval: "+g),c.nice(g)):c.nice())}function f(a,b,c){return b.reduce(function(b,d){var e=m.values(a.data(d.data)||c),f=m.accessor(m.isString(d.field)?d.field:"data."+m.accessor(d.field.group)(c));return m.unique(e,f,b)},[])}function g(a,b){return b.signal?a.signalRef(b.signal):b}function h(a,b,c,d){var e,h,i=b.domain;return m.isArray(i)?(e=d?i.slice():i,e=e.map(g.bind(null,a))):m.isObject(i)&&(h=i.fields||m.array(i),e=f(a,h,c)),e&&d&&e.sort(m.cmp),e}function i(a,b,c){function d(b,d,e,f){var g=m.values(a.data(b.data)||c),i=m.array(b.field).map(function(a){return m.isString(a)?a:"data."+m.accessor(a.group)(c)});i.forEach(function(a){a=m.accessor(a),d&&(h[0]=k.min([h[0],k.min(g,a)])),e&&(h[f]=k.max([h[f],k.max(g,a)]))})}var e,f,h=[null,null];return void 0!==b.domain&&(m.isArray(b.domain)?h=b.domain.slice().map(g.bind(null,a)):m.isObject(b.domain)?(e=b.domain.fields||m.array(b.domain),e.forEach(function(a){d(a,1,1,1)})):h=b.domain),f=h.length-1,void 0!==b.domainMin&&(m.isObject(b.domainMin)?b.domainMin.signal?h[0]=g(a,b.domainMin):(h[0]=null,e=b.domainMin.fields||m.array(b.domainMin),e.forEach(function(a){d(a,1,0,f)})):h[0]=b.domainMin),void 0!==b.domainMax&&(m.isObject(b.domainMax)?b.domainMax.signal?h[f]=g(a,b.domainMax):(h[f]=null,e=b.domainMax.fields||m.array(b.domainMax),e.forEach(function(a){d(a,0,1,f)})):h[f]=b.domainMax),b.type===q||b.type===s||!b.zero&&void 0!==b.zero||(h[0]=Math.min(0,h[0]),h[f]=Math.max(0,h[f])),h}function j(a,b,c){var d=[null,null];if(void 0!==b.range)if("string"==typeof b.range)if(u[b.range])d=[0,c[b.range]];else{if(!l.range[b.range])return m.error("Unrecogized range: "+b.range),d;d=l.range[b.range]}else if(m.isArray(b.range))d=b.range.map(g.bind(null,a));else{if(m.isObject(b.range))return null;d=[0,b.range]}if(void 0!==b.rangeMin&&(d[0]=b.rangeMin.signal?g(a,b.rangeMin):b.rangeMin),void 0!==b.rangeMax&&(d[d.length-1]=b.rangeMax.signal?g(a,b.rangeMax):b.rangeMax),void 0!==b.reverse){var e=b.reverse;
m.isObject(e)&&(e=m.accessor(e.field)(c.datum)),e&&(d=d.reverse())}return d}var k=a("d3"),l=a("../util/config"),m=a("../util/index"),n=a("../util/constants"),o=n.LINEAR,p=n.ORDINAL,q=n.LOG,r=n.POWER,s=n.TIME,t=n.QUANTILE,u={width:1,height:1};return b}),f("scene/scale",["require","exports","module","../parse/scale","../util/index","../core/changeset"],function(a){var b=a("../parse/scale"),c=a("../util/index"),d=a("../core/changeset"),e="ordinal";return function f(a,g){function h(){var a=[];return["domain","range"].forEach(function(b){c.isArray(g[b])&&g[b].forEach(function(b){b.signal&&a.push(b.signal)}),g[b+"Min"]&&g[b+"Min"].signal&&a.push(g[b+"Min"].signal),g[b+"Max"]&&g[b+"Max"].signal&&a.push(g[b+"Max"].signal)}),a.map(function(a){return c.field(a)[0]})}function i(b,c){var d=a.data(j.data||"vg_"+b.datum._id),f=d?d._output:null,h=b._prev||{},i=h.width||{},l=h.height||{},m=f?!!f.add.length||!!f.rem.length:!1;return j.field&&(m=m||f.fields[j.field]),m=m||f?!!f.sort&&g.type===e:!1,m=m||k.reevaluate(c),m=m||"width"==g.range&&i.stamp==c.stamp,m=m||"height"==g.range&&l.stamp==c.stamp,c.scales[g.name]=1,m}function f(d){c.debug({},["rescaling",d.datum._id]);var e=g.name,f=b(a,g,d);d.scales[e+":prev"]=d.scales[e]||f,d.scales[e]=f;var h=k._deps.data,i=j.data?!1:"vg_"+d.datum._id;i&&-1===h.indexOf(i)&&h.push(i)}var j=g.domain||{},k=new a.Node(function(a){return c.debug(a,["scaling",g.name]),a.add.forEach(f),a.mod.forEach(function(b){i(b,a)&&f(b)}),d.create(a,!0)});return j.data&&k._deps.data.push(j.data),j.field&&k._deps.fields.push(j.field),k._deps.signals=h(),k}}),f("parse/properties",["require","exports","module","../core/tuple","../util/index","../util/config"],function(a){function b(a,b,f){var i,j,k,l,m="",n=h.keys(f),o={},p={signals:{},scales:{},data:{}};for(m+="var o = trans ? {} : item;\n",i=0,j=n.length;j>i;++i)l=f[k=n[i]],m+=i>0?"\n  ":"  ",l.rule?(l=d(a,k,l.rule),m+="\n  "+l.code):(l=e(k,l),m+="this.tpl.set(o, "+h.str(k)+", "+l.val+", stamp);"),o[k]=!0,["signals","scales","data"].forEach(function(a){null!=l[a]&&h.array(l[a]).forEach(function(b){p[a][b]=1})});o.x2&&(o.x?(m+="\n  if (o.x > o.x2) { var t = o.x;this.tpl.set(o, 'x', o.x2, stamp);this.tpl.set(o, 'x2', t, stamp); };",m+="\n  this.tpl.set(o, 'width', (o.x2 - o.x), stamp);"):m+=o.width?"\n  this.tpl.set(o, 'x', (o.x2 - o.width), stamp);":"\n  this.tpl.set(o, 'x', o.x2, stamp);"),o.y2&&(o.y?(m+="\n  if (o.y > o.y2) { var t = o.y;this.tpl.set(o, 'y', o.y2, stamp);this.tpl.set(o, 'y2', t, stamp);};",m+="\n  this.tpl.set(o, 'height', (o.y2 - o.y), stamp);"):m+=o.height?"\n  this.tpl.set(o, 'y', (o.y2 - o.height), stamp);":"\n  this.tpl.set(o, 'y', o.y2, stamp);"),c(b,o)&&(m+="\n  item.touch();"),m+="\n  if (trans) trans.interpolate(item, o);";try{var q=Function("stamp","item","group","trans","db","signals","predicates",m);return q.tpl=g,{encode:q,signals:h.keys(p.signals),scales:h.keys(p.scales),data:h.keys(p.data)}}catch(r){h.error(r),h.log(m)}}function c(a,b){return b.path||("area"===a||"line"===a)&&(b.x||b.x2||b.width||b.y||b.y2||b.height||b.tension||b.interpolate)}function d(a,b,c){var d=[],f=[],g=[],i=[],j="";return(c||[]).forEach(function(k,l){var m,n=k.predicate,o=a.predicate(n),p=[],q=b+"_arg"+l;h.keys(k.input).forEach(function(a){var b=e(l,k.input[a]);p.push(h.str(a)+": "+b.val),d.concat(b.signals),f.concat(b.scales)}),m=e(b,k),d.concat(m.signals),f.concat(m.scales),n?(d.push.apply(d,o.signals),g.push.apply(g,o.data),i.push(q+" = {"+p.join(", ")+"}"),j+="if(predicates["+h.str(n)+"]("+q+", db, signals, predicates)) {\n    this.tpl.set(o, "+h.str(b)+", "+m.val+", stamp);\n",j+=c[l+1]?"  } else ":"  }"):j+="{\n    this.tpl.set(o, "+h.str(b)+", "+m.val+", stamp);\n  }"}),j="var "+i.join(",\n      ")+";\n  "+j,{code:j,signals:d,scales:f,data:g}}function e(a,b){if(null==b)return null;var c="fill"===a||"stroke"===a,d=null;if(c){if(b.c)return f("hcl",b.h,b.c,b.l);if(b.h||b.s)return f("hsl",b.h,b.s,b.l);if(b.l||b.a)return f("lab",b.l,b.a,b.b);if(b.r||b.g||b.b)return f("rgb",b.r,b.g,b.b)}var e=null;if(void 0!==b.value&&(e=h.str(b.value)),void 0!==b.signal){var g=h.field(b.signal);e="signals["+g.map(h.str).join("][")+"]",d=g.shift()}if(null!=b.group){var i="group.datum";h.isString(b.group)&&(i=j[b.group]?"group."+b.group:"group.datum["+h.field(b.group).map(h.str).join("][")+"]")}if(null!=b.field?h.isString(b.field)?(e="item.datum["+h.field(b.field).map(h.str).join("][")+"]",null!=b.group&&(e="this.accessor("+e+")("+i+")")):e="this.accessor(group.datum["+h.field(b.field.group).map(h.str).join("][")+"])(item.datum.data)":null!=b.group&&(e=i),null!=b.scale){var k=h.isString(b.scale)?h.str(b.scale):(b.scale.group?"group":"item")+".datum["+h.str(b.scale.group||b.scale.field)+"]";k="group.scale("+k+")",b.invert&&(k+=".invert"),e=null!==e||b.band||b.mult||b.offset?k+(b.band?".rangeBand()":"("+(null!==e?e:"item.datum.data")+")"):k}return e="("+(b.mult?h.number(b.mult)+" * ":"")+e+")"+(b.offset?" + "+h.number(b.offset):""),{val:e,signals:d,scales:b.scale}}function f(a,b,c,d){var f=b?e("",b):i.color[a][0],g=c?e("",c):i.color[a][1],h=d?e("",d):i.color[a][2];return"(this.d3."+a+"("+[f,g,h].join(",")+') + "")'}var g=a("../core/tuple"),h=a("../util/index"),i=a("../util/config"),j={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return b}),f("parse/mark",["require","exports","module","../util/index","./properties"],function(a){var b=a("../util/index"),c=a("./properties");return function d(a,e){var f=e.properties,g=e.marks;return b.keys(f).forEach(function(b){f[b]=c(a,e.type,f[b])}),e.delay&&(e.delay=c(a,e.type,{delay:e.delay})),g&&(e.marks=g.map(function(b){return d(a,b)})),e}}),f("scene/axis",["require","exports","module","../util/config","../core/tuple","../util/index","../parse/mark"],function(b){function c(b){function c(){x.type=null}function e(a){var c,d,e;"ordinal"===a.type?(c={scale:a.scaleName,offset:.5+a.rangeBand()/2},d=c):(c={scale:a.scaleName,offset:.5},d={scale:a.scaleName+":prev",offset:.5}),e=f(a),Q.gridLines||(Q.gridLines=l()),Q.majorTicks||(Q.majorTicks=l()),Q.minorTicks||(Q.minorTicks=l()),Q.tickLabels||(Q.tickLabels=m()),Q.domain||(Q.domain=o()),Q.title||(Q.title=n()),Q.gridLines.properties.enter.stroke={value:p.axis.gridColor},h(u,Q.gridLines,d,c,1/0),h(u,Q.majorTicks,d,c,B),h(u,Q.minorTicks,d,c,C),g(u,Q.tickLabels,d,c,B,E),j(u,Q.domain,e,D),i(u,Q.title,e,w),r.extend(Q.gridLines.properties.update,K),r.extend(Q.majorTicks.properties.update,M),r.extend(Q.minorTicks.properties.update,N),r.extend(Q.tickLabels.properties.update,L),r.extend(Q.domain.properties.update,P),r.extend(Q.title.properties.update,O);var q=[Q.gridLines,Q.majorTicks,Q.minorTicks,Q.tickLabels,Q.domain,Q.title];r.extend(x,{type:"group",interactive:!1,properties:{enter:{encode:k,scales:[a.scaleName],signals:[],data:[]},update:{encode:k,scales:[a.scaleName],signals:[],data:[]}}}),x.marks=q.map(function(a){return s(b,a)})}var q,u=p.axis.orient,v=0,w=p.axis.titleOffset,x={},y="front",z=!1,A=null,B=p.axis.tickSize,C=p.axis.tickSize,D=p.axis.tickSize,E=p.axis.padding,F=null,G=null,H=null,I=0,J=[p.axis.ticks],K={},L={},M={},N={},O={},P={},Q={gridLines:null,majorTicks:null,minorTicks:null,tickLabels:null,domain:null,title:null},R={};return R.def=function(){x.type||e(q),H=G?"time"===q.type?a.time.format(G):a.format(G):null;var b=function(a){return{data:a}},c=null==F?q.ticks?q.ticks.apply(q,J):q.domain():F,f=d(q,c,I).map(b);c=c.map(b);var g=null==H?q.tickFormat?q.tickFormat.apply(q,J):String:H;c.forEach(function(a){a.label=g(a.data)});var h=A?[A].map(b):[];return x.marks[0].from=function(){return z?c:[]},x.marks[1].from=function(){return c},x.marks[2].from=function(){return f},x.marks[3].from=x.marks[1].from,x.marks[4].from=function(){return[1]},x.marks[5].from=function(){return h},x.offset=v,x.orient=u,x.layer=y,x},R.scale=function(a){return arguments.length?(q!==a&&(q=a,c()),R):q},R.orient=function(a){return arguments.length?(u!==a&&(u=a in t?a+"":p.axis.orient,c()),R):u},R.title=function(a){return arguments.length?(A!==a&&(A=a,c()),R):A},R.ticks=function(){return arguments.length?(J=arguments,R):J},R.tickValues=function(a){return arguments.length?(F=a,R):F},R.tickFormat=function(a){return arguments.length?(G!==a&&(G=a,c()),R):G},R.tickSize=function(a,b){if(!arguments.length)return B;var d=arguments.length-1,e=+a,f=d>1?+b:B,g=d>0?+arguments[d]:B;return(B!==e||C!==f||D!==g)&&c(),B=e,C=f,D=g,R},R.tickSubdivide=function(a){return arguments.length?(I=+a,R):I},R.offset=function(a){return arguments.length?(v=r.isObject(a)?a:+a,R):v},R.tickPadding=function(a){return arguments.length?(E!==+a&&(E=+a,c()),R):E},R.titleOffset=function(a){return arguments.length?(w!==+a&&(w=+a,c()),R):w},R.layer=function(a){return arguments.length?(y!==a&&(y=a,c()),R):y},R.grid=function(a){return arguments.length?(z!==a&&(z=a,c()),R):z},R.gridLineProperties=function(a){return arguments.length?(K!==a&&(K=a),R):K},R.majorTickProperties=function(a){return arguments.length?(M!==a&&(M=a),R):M},R.minorTickProperties=function(a){return arguments.length?(N!==a&&(N=a),R):N},R.tickLabelProperties=function(a){return arguments.length?(L!==a&&(L=a),R):L},R.titleProperties=function(a){return arguments.length?(O!==a&&(O=a),R):O},R.domainProperties=function(a){return arguments.length?(P!==a&&(P=a),R):P},R.reset=function(){c()},R}function d(a,b,c){if(d=[],c&&b.length>1){for(var d,f,g,h=e(a.domain()),i=-1,j=b.length,k=(b[1]-b[0])/++c;++i<j;)for(f=c;--f>0;)(g=+b[i]-f*k)>=h[0]&&d.push(g);for(--i,f=0;++f<c&&(g=+b[i]+f*k)<h[1];)d.push(g)}return d}function e(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function f(a){return a.rangeExtent?a.rangeExtent():e(a.range())}function g(a,b,c,d,e,f){e=Math.max(e,0)+f,("left"===a||"top"===a)&&(e*=-1),"top"===a||"bottom"===a?(r.extend(b.properties.enter,{x:c,y:{value:e}}),r.extend(b.properties.update,{x:d,y:{value:e},align:{value:"center"},baseline:{value:v[a]}})):(r.extend(b.properties.enter,{x:{value:e},y:c}),r.extend(b.properties.update,{x:{value:e},y:d,align:{value:u[a]},baseline:{value:"middle"}}))}function h(a,b,c,d,e){var f="left"===a||"top"===a?-1:1;e=1/0===e?"top"===a||"bottom"===a?{group:"mark.group.height",mult:-f}:{group:"mark.group.width",mult:-f}:{value:f*e},"top"===a||"bottom"===a?(r.extend(b.properties.enter,{x:c,y:{value:0},y2:e}),r.extend(b.properties.update,{x:d,y:{value:0},y2:e}),r.extend(b.properties.exit,{x:d})):(r.extend(b.properties.enter,{x:{value:0},x2:e,y:c}),r.extend(b.properties.update,{x:{value:0},x2:e,y:d}),r.extend(b.properties.exit,{y:d}))}function i(a,b,c,d){var e=~~((c[0]+c[1])/2),f="top"===a||"left"===a?-1:1;"bottom"===a||"top"===a?r.extend(b.properties.update,{x:{value:e},y:{value:f*d},angle:{value:0}}):r.extend(b.properties.update,{x:{value:f*d},y:{value:e},angle:{value:-90}})}function j(a,b,c,d){var e;("top"===a||"left"===a)&&(d=-1*d),e="bottom"===a||"top"===a?"M"+c[0]+","+d+"V0H"+c[1]+"V"+d:"M"+d+","+c[0]+"H0V"+c[1]+"H"+d,b.properties.update.path={value:e}}function k(a,b,c,d){var e=d?{}:b,f=b.mark.def.offset,g=b.mark.def.orient,h=c.width,i=c.height;switch(r.isObject(f)&&(f=-c.scale(f.scale)(f.value)),g){case"left":q.set(e,"x",-f),q.set(e,"y",0);break;case"right":q.set(e,"x",h+f),q.set(e,"y",0);break;case"bottom":q.set(e,"x",0),q.set(e,"y",i+f);break;case"top":q.set(e,"x",0),q.set(e,"y",-f);break;default:q.set(e,"x",0),q.set(e,"y",0)}d&&d.interpolate(b,e)}function l(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:p.axis.tickColor},strokeWidth:{value:p.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function m(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:p.axis.tickLabelColor},font:{value:p.axis.tickLabelFont},fontSize:{value:p.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function n(){return{type:"text",interactive:!0,properties:{enter:{font:{value:p.axis.titleFont},fontSize:{value:p.axis.titleFontSize},fontWeight:{value:p.axis.titleFontWeight},fill:{value:p.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function o(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:p.axis.axisColor},strokeWidth:{value:p.axis.axisWidth}},update:{}}}}var p=b("../util/config"),q=b("../core/tuple"),r=b("../util/index"),s=b("../parse/mark"),t={top:1,right:1,bottom:1,left:1},u={bottom:"center",top:"center",left:"right",right:"left"},v={bottom:"top",top:"bottom",left:"middle",right:"middle"};return c}),f("parse/axes",["require","exports","module","../scene/axis","../util/config","../util/index"],function(a){function b(a,b,e,f){(b||[]).forEach(function(b,g){e[g]=e[g]||d(a),c(b,g,e[g],f)})}function c(a,b,c,d){void 0!==a.scale&&c.scale(d.scale(a.scale)),c.orient(a.orient||g[a.type]),c.offset(a.offset||0),c.layer(a.layer||"front"),c.grid(a.grid||!1),c.title(a.title||null),c.titleOffset(null!=a.titleOffset?a.titleOffset:e.axis.titleOffset),c.tickValues(a.values||null),c.tickFormat(a.format||null),c.tickSubdivide(a.subdivide||0),c.tickPadding(a.tickPadding||e.axis.padding);var h=[];if(void 0!==a.tickSize)for(var i=0;3>i;++i)h.push(a.tickSize);else{var j=e.axis.tickSize;h=[j,j,j]}if(null!=a.tickSizeMajor&&(h[0]=a.tickSizeMajor),null!=a.tickSizeMinor&&(h[1]=a.tickSizeMinor),null!=a.tickSizeEnd&&(h[2]=a.tickSizeEnd),h.length&&c.tickSize.apply(c,h),null!=a.ticks){var k=f.isArray(a.ticks)?a.ticks:[a.ticks];c.ticks.apply(c,k)}else c.ticks(e.axis.ticks);var l=a.properties;l&&l.ticks?(c.majorTickProperties(l.majorTicks?f.extend({},l.ticks,l.majorTicks):l.ticks),c.minorTickProperties(l.minorTicks?f.extend({},l.ticks,l.minorTicks):l.ticks)):(c.majorTickProperties(l&&l.majorTicks||{}),c.minorTickProperties(l&&l.minorTicks||{})),c.tickLabelProperties(l&&l.labels||{}),c.titleProperties(l&&l.title||{}),c.gridLineProperties(l&&l.grid||{}),c.domainProperties(l&&l.axis||{})}var d=a("../scene/axis"),e=a("../util/config"),f=a("../util/index"),g={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return b}),f("scene/group",["require","exports","module","./scale","../parse/axes","../util/index","../util/constants","./build","./build"],function(a){function b(a){for(var b=this,c=null;null==c&&(c=b.scales[a],b=b.mark?b.mark.group:(b.parent||{}).group););return c}var c=a("./scale"),d=a("../parse/axes"),e=a("../util/index"),f=a("../util/constants");return function(g,h,i,j,k,l){function m(a){return e.debug(a,["building group",h]),a.add.forEach(function(a){a.scales=a.scales||{},a.scale=b.bind(a),a.items=a.items||[],r[a._id]=r[a._id]||[],a.axes=a.axes||[],a.axisItems=a.axisItems||[]}),a}function n(b){return e.debug(b,["building marks",h.marks]),b.add.forEach(function(b){var c,d,e,i,k=h.marks;for(d=0,e=k.length;e>d;d++)c="vg_"+b.datum._id,b.items[d]={group:b},i=a("./build")(g,l,k[d],b.items[d],j,c),p.addListener(i),r[b._id].push({builder:i,from:(k[d].from||{}).data||c,type:f.MARK})}),b.mod.forEach(function(a){r[a._id].forEach(function(a){a.type==f.MARK&&void 0!==g.data(a.from)&&p.removeListener(a.builder)})}),b.rem.forEach(function(a){r[a._id].forEach(function(a){a.type===f.MARK?p.removeListener(a.builder):a.type===f.AXIS&&q.removeListener(a.builder),a.builder.disconnect()}),delete r[a._id]}),b}function o(b){e.debug(b,["building axes",h.axes]);b.add.forEach(function(b){var c=b.axes,e=b.axisItems,i=null;d(g,h.axes,c,b),c.forEach(function(c,d){var k=h.axes[d].scale;e[d]={group:b,axisDef:c.def()},i=a("./build")(g,l,e[d].axisDef,e[d],j),i._deps.scales.push(k),q.addListener(i),r[b._id].push({builder:i,type:f.AXIS,scale:k})})}),b.mod.forEach(function(a){d(g,h.axes,a.axes,a),a.axes.forEach(function(a){a.def()})});var c=(h.axes||[]).reduce(function(a,b){return a[b.scale]=1,a},{});return q._deps.scales=e.keys(c),b}var p,q,r={},s=new g.Node(m);return s.parent=k,s.scales={},s.scale=b.bind(s),(h.scales||[]).forEach(function(a){a=s.scales[a.name]=c(g,a);var b=a._deps.data,d=a._deps.signals;b&&b.forEach(function(a){g.data(a).addListener(j)}),d&&d.forEach(function(a){g.signal(a).addListener(j)}),s.addListener(a)}),s.addListener(p=new g.Node(n)),s.addListener(q=new g.Node(o)),s.disconnect=function(){e.keys(r).forEach(function(a){r[a].forEach(function(a){a.type==f.MARK?p.removeListener(a.builder):a.type==f.AXIS&&q.removeListener(a.builder),a.builder.disconnect()})}),r={}},s}}),f("scene/Item",["require","exports","module"],function(){function a(a){this.mark=a}var b=a.prototype;return b.hasPropertySet=function(a){var b=this.mark.def.properties;return b&&null!=b[a]},b.cousin=function(a,b){if(0===a)return this;a=a||-1;var c=this.mark,d=c.group,e=null==b?c.items.indexOf(this):b,f=d.items.indexOf(c)+a;return d.items[f].items[e]},b.sibling=function(a){if(0===a)return this;a=a||-1;var b=this.mark,c=b.items.indexOf(this)+a;return b.items[c]},b.remove=function(){var a=this,b=a.mark.items,c=b.indexOf(a);return c>=0&&(c===b.length-1?b.pop():b.splice(c,1)),a},b.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},a}),f("util/quickselect",[],function(){return function(a,b){function c(a,c){var d=b[a];b[a]=b[c],b[c]=d}for(var d,e,f,g=0,h=b.length-1;h>g;){for(f=b[a],c(a,h),e=d=g;h>e;++e)b[e]<f&&c(e,d++);if(c(h,d),d===a)break;a>d?g=d+1:h=d-1}return b[a]}}),f("transforms/measures",["require","exports","module","../core/tuple","../util/quickselect"],function(a){function b(a){return function(b){var c=Object.create(a);return c.out=b||a.name,c.idx||(c.idx=0),c}}function c(a){function b(a,c){return(c.req||[]).forEach(function(c){a[c]||b(a,a[c]=h[c]())}),a}var c=a.reduce(b,a.reduce(function(a,b){return a[b.name]=b,a},{})),d=[];for(var e in c)d.push(c[e]);return d.sort(function(a,b){return a.idx-b.idx}),d}function d(a){var b=c(a),d="this.flag = this.ADD; this.tuple = t;",h="",i="",j="var t = this.tuple;";return b.forEach(function(a){d+=a.init,h+=a.add,i+=a.rem}),a.forEach(function(a){j+="this.tpl.set(t,'"+a.out+"',"+a.set+", stamp);"}),h+="this.flag |= this.MOD;",i+="this.flag |= this.MOD;",j+="return t;",d=Function("t",d),d.prototype.ADD=1,d.prototype.MOD=2,d.prototype.add=Function("v",h),d.prototype.rem=Function("v",i),d.prototype.set=Function("stamp",j),d.prototype.mod=e,d.prototype.tpl=f,d.prototype.sel=g,d}function e(a,b){void 0!==b&&b!==a&&(this.rem(b),this.add(a))}var f=a("../core/tuple"),g=a("../util/quickselect"),h={count:b({name:"count",init:"this.cnt = 0;",add:"this.cnt += 1;",rem:"this.cnt -= 1;",set:"this.cnt"}),sum:b({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),avg:b({name:"avg",init:"this.avg = 0;",add:"var d = v - this.avg; this.avg += d / this.cnt;",rem:"var d = v - this.avg; this.avg -= d / this.cnt;",set:"this.avg",req:["count"],idx:1}),"var":b({name:"var",init:"this.dev = 0;",add:"this.dev += d * (v - this.avg);",rem:"this.dev -= d * (v - this.avg);",set:"this.dev / (this.cnt-1);",req:["avg"],idx:2}),std:b({name:"std",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / (this.cnt-1))",req:["var"],idx:3}),median:b({name:"median",init:"this.val = [];",add:"this.val.push(v);",rem:"this.val[this.val.indexOf(v)] = this.val[this.val.length-1];this.val.length = this.val.length - 1;",set:"this.sel(~~(this.cnt/2), this.val)"})};return h.create=d,h}),f("transforms/aggregate",["require","exports","module","../core/tuple","../core/changeset","./measures","../util/index"],function(a){var b=a("../core/tuple"),c=a("../core/changeset"),d=a("./measures"),e=a("../util/index");return function(a){function f(a){var c,d,e;return c=a.facet?a.facet.key:"",(d=h[c])||(e=a.facet?a.facet:b.create(null),h[c]=d=new g(e)),d}var g=null,h={},i=null,j=new a.Node(function(a){e.debug(a,["aggregating"]);var b,d=a.facet?a.facet.key:"",g=f(a),j=c.create();return a.add.forEach(function(a){g.add(a[i],1)}),a.mod.forEach(function(b){b._prev[i]&&b._prev[i].stamp==a.stamp&&g.mod(b[i],b._prev[i].value)}),a.rem.forEach(function(b){g.rem(b._prev[i]&&b._prev[i].stamp==a.stamp?b._prev[i].value:b[i])}),b=g.set(a.stamp),a.facet?a:(0===g.cnt?(g.flag===g.MOD&&j.rem.push(b),delete h[d]):g.flag&g.ADD?j.add.push(b):g.flag&g.MOD&&j.mod.push(b),g.flag=0,j)});return j.field=function(a){var b=j._deps.fields,c=b.indexOf(i);return c>-1&&b.slice(c,1),i=a,b.push(i),j},j.stats=function(a){return g=d.create(a.map(function(a){return d[a]()})),j},j}}),f("util/bins",["require","exports","module"],function(){function a(a,b){for(var c=0,d=a.length;d>c;){var e=c+d>>>1;a[e]<b?c=e+1:d=e}return c}function b(b){b=b||{};var c,d,e,f,g=b.maxbins||1024,h=b.base||10,i=b.div||[5,2],j=b.minstep||0,k=Math.log(h),l=Math.ceil(Math.log(g)/k),m=b.min,n=b.max,o=n-m,p=Math.max(j,Math.pow(h,Math.round(Math.log(o)/k)-l)),q=Math.ceil(o/p);if(null!=b.step)p=b.step;else if(b.steps)e=a(b.steps,o/g),e===b.steps.length&&--e,p=b.steps[e];else{do p*=h,q=Math.ceil(o/p);while(q>g);for(e=0;e<i.length;++e)d=p/i[e],d>=j&&g>=o/d&&(p=d,q=Math.ceil(o/p))}return d=Math.log(p),c=d>=0?0:~~(-d/k)+1,f=(0>m?-1:1)*Math.pow(h,-c-1),m=Math.min(m,Math.floor(m/p+f)*p),n=Math.ceil(n/p)*p,{start:m,stop:n,step:p,unit:c}}return b}),f("transforms/bin",["require","exports","module","../util/index","../util/bins","../core/tuple"],function(a){var b=a("../util/index"),c=a("../util/bins"),d=a("../core/tuple");return function(a){var e,f,g=void 0,h=void 0,i=void 0,j=20,k="bin",l=new a.Node(function(a){function b(b){var c=f(b);c=null==c?null:e.start+e.step*~~((c-e.start)/e.step),d.set(b,k,c,a.stamp)}var e=c({min:g,max:h,step:i,maxbins:j});return a.add.forEach(b),a.mod.forEach(b),a.rem.forEach(b),a});return l.min=function(a){return g=a,l},l.max=function(a){return h=a,l},l.step=function(a){return i=a,l},l.maxbins=function(a){return j=a,l},l.field=function(a){return e=a,f=b.accessor(a),l},l.output=function(a){return k=a,l},l}}),f("transforms/facet",["require","exports","module","../util/index","../core/tuple","../core/changeset"],function(a){var b=a("../util/index"),c=a("../core/tuple"),d=a("../core/changeset");return function(a){function e(d,e,i){var l=f.reduce(function(a,b){var c=b(d._prev);return e&&void 0!==(c=b(d._prev))&&c.stamp>=i?(a.push(c.value),a):(a.push(b(d)),a)},[]),m=l.join("|");if(j[m])return j[m];var n=g.map(function(b){var c=new a.Node;return c._fn=b._fn,c._deps=b._deps,c}),o=c.create({keys:l,key:m}),p=a.data("vg_"+o._id,n,o);k.addListener(n[0]),n[n.length-1].addListener(k.parentCollector);var q=function(){b.debug({},["deleting cell",m,n[0]._type]),k.removeListener(n[0]),a.graph.disconnect(n),delete j[m]};return j[m]={t:o,s:h,ds:p,"delete":q,count:0}}var f=[],g=[],h=1,i=2,j={},k=new a.Node(function(a){b.debug(a,["faceting"]);var c,f,g,k=d.create(a);a.add.forEach(function(a){var b=e(a);b.count+=1,b.s|=i,b.ds._input.add.push(a)}),a.mod.forEach(function(b){var c=e(b),d=e(b,!0,a.stamp);c!==d&&(d.count-=1,d.s|=i,d.ds._input.rem.push(b)),c.s&h?(c.count+=1,c.ds._input.add.push(b)):c.ds._input.mod.push(b),c.s|=i}),a.rem.forEach(function(a){var b=e(a);b.count-=1,b.s|=i,b.ds._input.rem.push(a)});for(c in j)f=j[c],g=f.t,d.copy(a,f.ds._input),0===f.count?(f.s===i&&k.rem.push(g),f["delete"]()):f.s&h?k.add.push(g):f.s&i&&k.mod.push(g),f.s=0;return k});return k._router=!0,k.data=function(){var b,c,d,e=[];for(b in j)c=j[b].t,d=a.data("vg_"+c._id).values(),e.push({_id:c._id,values:d});return e},k.pipeline=function(a){return arguments.length?(g=a,k):g},k.keys=function(a){return f=b.array(a).map(b.accessor),k},k.parentCollector=null,k}}),f("parse/expr",["require","exports","module","../util/index"],function(a){function b(a,b){var g,h,i,j,k,l,m,n=b.split(f),o={},p={};for(k=0,l=0,i=0,j=n.length;j>i;++i){var g=n[i];"'"!==g?'"'!==g?l||k||(d[g]&&(n[i]=d[g]),e[g]&&(h=n[i+1])&&"("===h[0]&&(n[i]=e[g]),":"==n[i+1]&&(m=g+":"+n[i+2],a.signal((m=c.field(m))[0])&&(o[m[0]]=1,h=c.field(n[i+2]),n[i]="sg['"+n[i],n[i+2]=n[i+2].replace(h[0],h[0]+"']"),i+=2)),a.signal((h=c.field(g))[0])&&(o[h[0]]=1,n[i]=n[i].replace(h[0],"sg["+c.str(h[0])+"]")),"d"==h[0]&&(p[h.splice(1).join("")]=1)):k||(l=!l):l||(k=!k)}return{fn:Function("d","e","i","p","sg","return ("+n.join("")+");"),signals:c.keys(o),fields:c.keys(p)}}var c=a("../util/index"),d={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},e={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",date:"Date.parse"},f=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return b.eval=function(a,b,d,e,f,g,h){return h=a.signalValues(c.array(h)),b.call(null,d,e,f,g,h)},b}),f("transforms/filter",["require","exports","module","../util/index","../core/tuple","../core/changeset","../parse/expr"],function(a){var b=a("../util/index"),c=(a("../core/tuple"),a("../core/changeset")),d=a("../parse/expr");return function(a){function e(b){return d.eval(a,f,b,null,null,null,h._deps.signals)}var f=null,g={},h=new a.Node(function(a){b.debug(a,["filtering"]);var d=c.create(a);return a.rem.forEach(function(a){1!==g[a._id]?d.rem.push(a):g[a._id]=0}),a.add.forEach(function(a){e(a)?d.add.push(a):g[a._id]=1}),a.mod.forEach(function(a){var b=e(a),c=1===g[a._id];b&&c?(g[a._id]=0,d.add.push(a)):b&&!c?d.mod.push(a):!b&&c||(d.rem.push(a),g[a._id]=1)}),d});return h.test=function(c){return b.isFunction(c)?f=c:(c=d(a,c),f=c.fn,h._deps.signals=c.signals,h._deps.fields=c.fields),h},h}}),f("transforms/fold",["require","exports","module","../util/index","../core/tuple","../core/changeset"],function(a){var b=a("../util/index"),c=a("../core/tuple"),d=a("../core/changeset");return function(a){function e(a,b){var d=j[a._id]||(j[a._id]=Array(g.length));return d[b]||(d[b]=c.create(a,a._prev))}function f(a,b,d){a.forEach(function(a){for(var f=0;f<g.length;++f){var j=e(a,f);c.set(j,i.key,g[f],d),c.set(j,i.value,h[f](a),d),b.push(j)}})}var g=[],h=[],i={key:"key",value:"value"},j={},k=new a.Node(function(a){b.debug(a,["folding"]);var c=d.create(a);return f(a.add,c.add,a.stamp),f(a.mod,c.mod,a.stamp),a.rem.forEach(function(a){c.rem.push.apply(c.rem,j[a._id])}),(a.add.length||a.rem.length||g.some(function(b){return!!a.fields[b]}))&&(c.fields[i.key]=1,c.fields[i.value]=1),c});return k._router=!0,k.fields=function(a){return g=b.array(a),h=g.map(b.accessor),k},k.output=function(a){return b.keys(i).forEach(function(b){void 0!==a[b]&&(i[b]=a[b])}),k},k}}),f("transforms/formula",["require","exports","module","../util/index","../core/tuple","../parse/expr"],function(a){var b=a("../util/index"),c=a("../core/tuple"),d=a("../parse/expr");return function(a){function e(b,e){var i=d.eval(a,g,b,null,null,null,h._deps.signals);c.set(b,f,i,e)}var f=null,g=b.identity,h=new a.Node(function(a){return b.debug(a,["formulating"]),a.add.forEach(function(b){e(b,a.stamp)}),a.mod.forEach(function(b){e(b,a.stamp)}),a.fields[f]=1,a});return h.field=function(a){return f=a,h},h.expr=function(c){return b.isFunction(c)?e=c:(c=d(a,c),g=c.fn,h._deps.signals=c.signals,h._deps.fields=c.fields),h},h}}),f("transforms/sort",["require","exports","module","../util/index","../parse/expr"],function(a){{var b=a("../util/index");a("../parse/expr")}return function(a){function c(){return b.comparator(d.map(function(b){return a.signal(b)?a.signal(b).value():b}))}var d=null,e=new a.Node(function(a){return b.debug(a,["sorting"]),(a.add.length||a.mod.length||a.rem.length)&&(a.sort=c()),a});return e._router=!0,e.by=function(c){return d=b.array(c),d.forEach(function(b){a.signal(b)&&e._deps.signals.push(b)}),e},e}}),f("transforms/zip",["require","exports","module","../util/index","../core/collector"],function(a){var b=a("../util/index"),c=a("../core/collector");return function(a){function d(a){return d[a]||(d[a]=[])}var e=null,f="zip",g="data",h=b.accessor("data"),i=void 0,j=null,k=null,l=c(a),m=0,n=new a.Node(function(c){b.debug(c,["zipping",e]);var n=a.data(e),o=n._output,p=n.values();if(k)o&&o.stamp>m&&(o.add.forEach(function(a){var b=d(k(a));b[0]&&(b[0][f]=a),b[1]=a}),o.rem.forEach(function(a){var b=d(k(a));b[0]&&(b[0][f]=i),b[1]=null}),o.fields[j]&&o.mod.forEach(function(a){var b=k(a._prev);if(b&&!(b.stamp<m)){var c=d(b.value);c[0]&&(c[0][f]=i),c[1]=null;var e=d(k(a));e[0]&&(e[0][f]=a),e[1]=a}}),m=o.stamp),c.add.forEach(function(a){var b=d(h(a));a[f]=b[1]||i,b[0]=a}),c.rem.forEach(function(a){d(h(a))[0]=null}),c.fields[g]&&c.mod.forEach(function(a){var b=h(a._prev);if(b&&!(b.stamp<c.stamp)){d(b.value)[0]=null;var e=d(h(a));a[f]=e[1]||i,e[0]=a}});else{if(0==c.add.length&&0==c.rem.length&&0==o.add.length&&0==o.rem.length)return c;l._fn(c);var q,r=l.data(),s=p.length;for(q=0;q<r.length;q++)r[q][f]=p[q%s]}return c});return n["with"]=function(a){var b=n._deps.data,c=b.indexOf(e);return c>-1&&b.splice(c,1),e=a,b.push(e),n},n["default"]=function(a){return i=a,n},n.as=function(a){return f=a,n},n.key=function(a){return g=a,h=b.accessor(a),n},n.withKey=function(a){return j=a,k=b.accessor(a),n},n}}),f("transforms/index",["require","exports","module","./aggregate","./bin","./facet","./filter","./fold","./formula","./sort","./zip"],function(a){return{aggregate:a("./aggregate"),bin:a("./bin"),facet:a("./facet"),filter:a("./filter"),fold:a("./fold"),formula:a("./formula"),sort:a("./sort"),zip:a("./zip")}}),f("parse/transforms",["require","exports","module","../util/index","../transforms/index"],function(a){var b=a("../util/index"),c=a("../transforms/index");return function d(a,e){var f=c[e.type](a);if("facet"==e.type){var g=(e.transform||[]).map(function(b){return d(a,b)});f.pipeline(g)}return b.keys(e).forEach(function(a){"type"!==a&&("transform"!==a||"facet"!==e.type)&&f[a](e[a])}),f}}),f("transforms/modify",["require","exports","module","../core/tuple","../util/index","../util/constants"],function(a){var b=a("../core/tuple"),c=a("../util/index"),d=a("../util/constants"),e=d.MODIFY_ADD,f=d.MODIFY_REMOVE,g=d.MODIFY_TOGGLE,h=d.MODIFY_CLEAR,i=function(a,b,c,d){for(var e=c.length-1;e>=0;--e)c[e][a]==b&&d.push.apply(d,c.splice(e,1))};return function(a,d,j){var k=d.signal?c.field(d.signal):null,l=k?k[0]:null,m=d.predicate?a.predicate(d.predicate):null,n=null===m,o=new a.Node(function(l){if(null!==m){var o={};(m.data||[]).forEach(function(b){o[b]=a.data(b).values()}),n=m({},o,a.signalValues(m.signals||[]),a._predicates)}if(c.debug(l,[d.type+"ing",n]),!n)return l;var p={},q=k?a.signalRef(d.signal):null,r=a.data(j.name),s=null;if(p[d.field]=q,d.type==e)s=b.create(p),l.add.push(s),r._data.push(s);else if(d.type==f)i(d.field,q,l.add,l.rem),i(d.field,q,l.mod,l.rem),r._data=r._data.filter(function(a){return a[d.field]!==q});else if(d.type==g){var t=[],u=[];i(d.field,q,l.rem,t),i(d.field,q,l.add,u),i(d.field,q,l.mod,u),0==t.length&&0==u.length&&t.push(b.create(p)),l.add.push.apply(l.add,t),r._data.push.apply(r._data,t),l.rem.push.apply(l.rem,u),r._data=r._data.filter(function(a){return-1===u.indexOf(a)})}else d.type==h&&(l.rem.push.apply(l.rem,l.add),l.rem.push.apply(l.rem,l.mod),l.add=[],l.mod=[],r._data=[]);return l.fields[d.field]=1,l}),p=o._deps.signals;return l&&p.push(l),m&&p.push.apply(p,m.signals),o}}),f("util/load",["require","exports","module","./index","./config"],function(b){function c(a){return h.test(a)}function d(b,c){return f.log("LOAD: "+b),e(b)?void a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)}):void f.error("URL is not whitelisted: "+b)}function e(a){if(!g.domainWhiteList)return!0;var b=document.createElement("a");b.href=a;var c=b.hostname.toLowerCase();return g.domainWhiteList.some(function(a){return a===c||c.lastIndexOf("."+a)===c.length-a.length-1})}var f=b("./index"),g=b("./config"),h=/^[A-Za-z]+\:\/\//;return function(a,b){var e=c(a)?a:g.baseURL+a;d(e,b)}}),f("util/read",["require","exports","module","./index"],function(c){function d(a,b){var c=b&&b.type||"json";return a=h[c](a,b),b&&b.parse&&e(a,b.parse),a}function e(a,b){var c=g.keys(b),d=c.map(function(a){return i[b[a]]}),e=g.isTree(a);
f(e?[a]:a,c,d,e)}function f(a,b,c,d){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);d&&f.values&&e(f,b,c,!0)}}var g=c("./index"),h={},i={number:g.number,"boolean":g["boolean"],date:Date.parse};return h.json=function(a,b){var c=g.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=g.accessor(b.property)(c)),c},h.csv=function(b){var c=a.csv.parse(b);return c},h.tsv=function(b){var c=a.tsv.parse(b);return c},h.topojson=function(a,c){if(null==b)return g.error("TopoJSON library not loaded."),[];var d=g.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(g.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(g.error("Invalid TopoJSON object: "+c.mesh),[]):g.error("Missing TopoJSON feature or mesh parameter."),e},h.treejson=function(a,b){return a=g.isObject(a)?a:JSON.parse(a),g.tree(a,b.children)},d.formats=h,d.parse=e,d}),f("parse/data",["require","exports","module","./transforms","../transforms/modify","../util/index","../util/load","../util/read"],function(a){var b=a("./transforms"),c=a("../transforms/modify"),d=a("../util/index"),e=a("../util/load"),f=a("../util/read"),g=function(a,b,c){function h(b){return function(e,g){e?d.error("LOADING FAILED: "+b.url):a.data(b.name).values(f(g.toString(),b.format)),0===--i&&c()}}var i=0;return(b||[]).forEach(function(b){b.url&&(i+=1,e(b.url,h(b))),g.datasource(a,b)}),0===i&&setTimeout(c,1),b};return g.datasource=function(a,d){var e=(d.transform||[]).map(function(c){return b(a,c)}),g=(d.modify||[]).map(function(b){return c(a,b,d)}),h=a.data(d.name,g.concat(e));return d.values?h.values(f(d.values,d.format)):d.source&&(h.source(d.source),a.data(d.source).addListener(h)),h},g}),f("scene/build",["require","exports","module","./encode","../core/collector","./bounds","./group","./Item","../parse/data","../core/tuple","../core/changeset","../util/index","../util/constants"],function(a){var b=a("./encode"),c=a("../core/collector"),d=a("./bounds"),e=a("./group"),f=a("./Item"),g=a("../parse/data"),h=a("../core/tuple"),i=a("../core/changeset"),j=a("../util/index"),k=a("../util/constants");return function(a,l,m,n,o,p){function q(){return n.def=m,n.marktype=m.type,n.interactive=!(m.interactive===!1),n.items=D,m.from&&(m.from.transform||m.from.modify)&&r(),A=new a.Node(w),A._type="builder",A._router=!0,A._touchable=!0,B=b(a,n),C=d(a,n),A.collector=c(a),m.type===k.GROUP&&(A.group=e(a,m,n,A,o,l)),F&&(A._deps.data.push(E),B._deps.data.push(E)),t(),A.disconnect=u,A}function r(){var b=[E,m.type,Date.now()].join("_"),c={name:b,source:E,transform:m.from.transform,modify:m.from.modify};E=b,F=g.datasource(a,c);var d,e=F._source._output;d=F._input=i.create(e),d.add=e.add,d.mod=e.mod,d.rem=e.rem,d.stamp=null,F.fire()}function s(){var a=[A,B];return A.group&&a.push(A.group),a.push(A.collector,C,l),a}function t(){a.graph.connect(s()),B._deps.scales.forEach(function(a){o.group.scale(a).addListener(A)}),o&&C.addListener(o.collector)}function u(){a.graph.disconnect(s()),B._deps.scales.forEach(function(a){o.group.scale(a).removeListener(A)}),A.group&&A.group.disconnect()}function v(a,b){var c=h.create(new f(n));return c.datum=a,m.width&&h.set(c,"width",m.width,b),m.height&&h.set(c,"height",m.height,b),c}function w(a){j.debug(a,["building",E,m.type]);var b,c,d,e=B.reevaluate(a);return F?(b=i.create(a),e&&(b.mod=D.slice()),(c=F._output)?c.stamp<=H?b:(H=c.stamp,x(c)):(b.touch=!0,b)):(d=j.isFunction(m.from)?m.from():[k.SENTINEL],y(a,d))}function x(a){var b,c,d,e,f,g=z(m.key||"_id"),j=i.create(a),l=a.add,n=a.mod,o=a.rem,p=a.stamp;for(b=0,d=l.length;d>b;++b)c=g(f=l[b]),e=v(f,p),h.set(e,"key",c,p),e.status=k.ENTER,G[c]=e,D.push(e),j.add.push(e);for(b=0,d=n.length;d>b;++b)e=G[c=g(f=n[b])],h.set(e,"key",c,p),e.datum=f,e.status=k.UPDATE,j.mod.push(e);for(b=0,d=o.length;d>b;++b)e=G[c=g(o[b])],e.status=k.EXIT,j.rem.push(e),G[c]=null;return D.sort(function(b,c){return a.sort?a.sort(b.datum,c.datum):b.datum._id-c.datum._id}),j}function y(a,b){var c,d,e,f,g,j=z(m.key),l=D.splice(0),n=i.create(a);for(c=0,e=l.length;e>c;++c)f=l[c],f.status=k.EXIT,j&&(G[f.key]=f);for(c=0,e=b.length;e>c;++c)g=b[c],d=c,f=j?G[d=j(g)]:l[c],f?(D.push(f),n.mod.push(f),h.set(f,"key",d),f.datum=g,f.status=k.UPDATE):(D.push(f=v(g,a.stamp)),n.add.push(f),h.set(f,"key",d),f.status=k.ENTER);for(c=0,e=l.length;e>c;++c)f=l[c],f.status===k.EXIT&&(h.set(f,"key",j?f.key:D.length),D.unshift(f),n.rem.unshift(f));return n}function z(a){if(null==a)return null;var b=j.array(a).map(j.accessor);return function(a){for(var c="",d=0,e=b.length;e>d;++d)d>0&&(c+="|"),c+=String(b[d](a));return c}}var A,B,C,D=[],E=(m.from?m.from.data:null)||p,F=j.isString(E)?a.data(E):null,G={},H=0;return q()}}),f("scene/index",["require","exports","module","../core/changeset","./build"],function(a){var b=a("../core/changeset"),c=a("./build");return function(a){function d(d){return arguments.length?(e=c(a,d,a._defs.marks,f={}),a.addListener(e),f.fire=function(c){c||(c=b.create({},!0)),a.graph.propagate(c,e)},f.scale=function(a,b){if(!a.scale)return b;var c=f.items[0].scale(a.scale);return c?a.invert?c.invert(b):c(b):b},f):f}var e=null,f=null;return d}}),f("core/Model",["require","exports","module","./Datasource","./Signal","./Node","./graph","./changeset","../scene/index","../util/index"],function(a){function b(){this._stamp=0,this._rank=0,this._defs={},this._data={},this._signals={},this._predicates={},this.Datasource=e(this),this.Signal=f(this),this.Node=g(this),this.graph=h(this),this.scene=j(this),this._node=new this.Node}function c(a){var b=this;return k.isArray(a)?a.map(function(a){b._signals[a]}):this._signals[a]}function d(a){var b=this,c={};return k.isArray(a)?(a.forEach(function(a){c[a]=b._predicates[a]}),c):this._predicates[a]}var e=a("./Datasource"),f=a("./Signal"),g=a("./Node"),h=a("./graph"),i=a("./changeset"),j=a("../scene/index"),k=a("../util/index");return b.prototype.data=function(a,b,c){return 1===arguments.length?this._data[a]:this._data[a]=new this.Datasource(a,c).pipeline(b)},b.prototype.signal=function(a,b){return 1===arguments.length?c.call(this,a):this._signals[a]=new this.Signal(a,b)},b.prototype.signalValues=function(a){var b,c,d,e={};if(!k.isArray(a))return this._signals[a].value();for(b=0,c=a.length;c>b;++b)d=a[b],e[d]=this._signals[d].value();return e},b.prototype.signalRef=function(a){k.isArray(a)||(a=k.field(a));var b=this.signal(a.shift()).value();if(a.length>0){var c=Function("s","return s["+a.map(k.str).join("][")+"]");b=c.call(null,b)}return b},b.prototype.predicate=function(a,b){return 1===arguments.length?d.call(this,a):this._predicates[a]=b},b.prototype.addListener=function(a){this._node.addListener(a)},b.prototype.fire=function(a){a||(a=i.create({})),this.graph.propagate(a,this._node)},b}),f("parse/events",[],function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return _b!==b&&(_b>b&&(_b=0,ac={line:1,column:1,seenCR:!1}),c(ac,_b,b),_b=b),ac}function d(a){bc>Zb||(Zb>bc&&(bc=Zb,cc=[]),cc.push(a))}function e(d,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=c(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==d?d:h(e,j),e,j,f,i.line,i.column)}function f(){var a;return a=g()}function g(){var b,c,e,f,i,j;return b=Zb,c=h(),c!==u?(e=r(),e!==u?(44===a.charCodeAt(Zb)?(f=y,Zb++):(f=u,0===dc&&d(z)),f!==u?(i=r(),i!==u?(j=g(),j!==u?($b=b,c=A(c,j),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b===u&&(b=Zb,c=h(),c!==u&&($b=b,c=B(c)),b=c),b}function h(){var b,c,e,f,g,j,k,l,m,n,o,p,q,s;return b=Zb,91===a.charCodeAt(Zb)?(c=C,Zb++):(c=u,0===dc&&d(D)),c!==u?(e=r(),e!==u?(f=i(),f!==u?(g=r(),g!==u?(44===a.charCodeAt(Zb)?(j=y,Zb++):(j=u,0===dc&&d(z)),j!==u?(k=r(),k!==u?(l=i(),l!==u?(m=r(),m!==u?(93===a.charCodeAt(Zb)?(n=E,Zb++):(n=u,0===dc&&d(F)),n!==u?(o=r(),o!==u?(62===a.charCodeAt(Zb)?(p=G,Zb++):(p=u,0===dc&&d(H)),p!==u?(q=r(),q!==u?(s=h(),s!==u?($b=b,c=I(f,l,s),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b===u&&(b=i()),b}function i(){var a,b,c,d;if(a=Zb,b=j(),b!==u){if(c=[],d=n(),d!==u)for(;d!==u;)c.push(d),d=n();else c=x;c!==u?($b=a,b=J(b,c),a=b):(Zb=a,a=x)}else Zb=a,a=x;return a===u&&(a=Zb,b=j(),b!==u&&($b=a,b=K(b)),a=b),a}function j(){var b,c,e,f;if(b=Zb,c=k(),c===u&&(c=l()),c===u&&(c=L),c!==u?(e=m(),e!==u?($b=b,c=M(c,e),b=c):(Zb=b,b=x)):(Zb=b,b=x),b===u){if(b=Zb,c=[],N.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(O)),e!==u)for(;e!==u;)c.push(e),N.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(O));else c=x;c!==u&&($b=b,c=P(c)),b=c,b===u&&(b=Zb,40===a.charCodeAt(Zb)?(c=Q,Zb++):(c=u,0===dc&&d(R)),c!==u?(e=g(),e!==u?(41===a.charCodeAt(Zb)?(f=S,Zb++):(f=u,0===dc&&d(T)),f!==u?($b=b,c=U(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x))}return b}function k(){var b,c,e,f;return b=Zb,46===a.charCodeAt(Zb)?(c=V,Zb++):(c=u,0===dc&&d(W)),c!==u?(e=q(),e!==u?(58===a.charCodeAt(Zb)?(f=X,Zb++):(f=u,0===dc&&d(Y)),f!==u?($b=b,c=Z(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function l(){var b,c,e,f;return b=Zb,35===a.charCodeAt(Zb)?(c=$,Zb++):(c=u,0===dc&&d(_)),c!==u?(e=q(),e!==u?(58===a.charCodeAt(Zb)?(f=X,Zb++):(f=u,0===dc&&d(Y)),f!==u?($b=b,c=ab(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function m(){var b;return a.substr(Zb,9)===bb?(b=bb,Zb+=9):(b=u,0===dc&&d(cb)),b===u&&(a.substr(Zb,7)===db?(b=db,Zb+=7):(b=u,0===dc&&d(eb)),b===u&&(a.substr(Zb,5)===fb?(b=fb,Zb+=5):(b=u,0===dc&&d(gb)),b===u&&(a.substr(Zb,8)===hb?(b=hb,Zb+=8):(b=u,0===dc&&d(ib)),b===u&&(a.substr(Zb,5)===jb?(b=jb,Zb+=5):(b=u,0===dc&&d(kb)),b===u&&(a.substr(Zb,7)===lb?(b=lb,Zb+=7):(b=u,0===dc&&d(mb)),b===u&&(a.substr(Zb,8)===nb?(b=nb,Zb+=8):(b=u,0===dc&&d(ob)),b===u&&(a.substr(Zb,5)===pb?(b=pb,Zb+=5):(b=u,0===dc&&d(qb)),b===u&&(a.substr(Zb,10)===rb?(b=rb,Zb+=10):(b=u,0===dc&&d(sb)),b===u&&(a.substr(Zb,9)===tb?(b=tb,Zb+=9):(b=u,0===dc&&d(ub)),b===u&&(a.substr(Zb,8)===vb?(b=vb,Zb+=8):(b=u,0===dc&&d(wb)),b===u&&(a.substr(Zb,9)===xb?(b=xb,Zb+=9):(b=u,0===dc&&d(yb)),b===u&&(a.substr(Zb,10)===zb?(b=zb,Zb+=10):(b=u,0===dc&&d(Ab)))))))))))))),b}function n(){var b,c,e,f,g,h,i,j,k,l,m;return b=Zb,91===a.charCodeAt(Zb)?(c=C,Zb++):(c=u,0===dc&&d(D)),c!==u?(e=r(),e!==u?(f=o(),f!==u?(g=q(),g!==u?(h=r(),h!==u?(i=p(),i!==u?(j=r(),j!==u?(k=q(),k!==u?(l=r(),l!==u?(93===a.charCodeAt(Zb)?(m=E,Zb++):(m=u,0===dc&&d(F)),m!==u?($b=b,c=Bb(f,g,i,k),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function o(){var b;return a.substr(Zb,2)===Cb?(b=Cb,Zb+=2):(b=u,0===dc&&d(Db)),b===u&&(a.substr(Zb,2)===Eb?(b=Eb,Zb+=2):(b=u,0===dc&&d(Fb)),b===u&&(a.substr(Zb,2)===Gb?(b=Gb,Zb+=2):(b=u,0===dc&&d(Hb)),b===u&&(a.substr(Zb,2)===Ib?(b=Ib,Zb+=2):(b=u,0===dc&&d(Jb))))),b}function p(){var b;return a.substr(Zb,2)===Kb?(b=Kb,Zb+=2):(b=u,0===dc&&d(Lb)),b===u&&(a.substr(Zb,2)===Mb?(b=Mb,Zb+=2):(b=u,0===dc&&d(Nb)),b===u&&(62===a.charCodeAt(Zb)?(b=G,Zb++):(b=u,0===dc&&d(H)),b===u&&(a.substr(Zb,2)===Ob?(b=Ob,Zb+=2):(b=u,0===dc&&d(Pb)),b===u&&(60===a.charCodeAt(Zb)?(b=Qb,Zb++):(b=u,0===dc&&d(Rb)),b===u&&(a.substr(Zb,2)===Sb?(b=Sb,Zb+=2):(b=u,0===dc&&d(Tb))))))),b}function q(){var b,c,e;if(b=Zb,c=[],Ub.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(Vb)),e!==u)for(;e!==u;)c.push(e),Ub.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(Vb));else c=x;return c!==u&&($b=b,c=Wb(c)),b=c}function r(){var b,c;for(b=[],Xb.test(a.charAt(Zb))?(c=a.charAt(Zb),Zb++):(c=u,0===dc&&d(Yb));c!==u;)b.push(c),Xb.test(a.charAt(Zb))?(c=a.charAt(Zb),Zb++):(c=u,0===dc&&d(Yb));return b}var s,t=arguments.length>1?arguments[1]:{},u={},v={start:f},w=f,x=u,y=",",z={type:"literal",value:",",description:'","'},A=function(a,b){return[a].concat(b)},B=function(a){return[a]},C="[",D={type:"literal",value:"[",description:'"["'},E="]",F={type:"literal",value:"]",description:'"]"'},G=">",H={type:"literal",value:">",description:'">"'},I=function(a,b,c){return{start:a,end:b,middle:c}},J=function(a,b){return a.filters=b,a},K=function(a){return a},L=null,M=function(a,b){return{event:b,target:a}},N=/^[:a-zA-z0-9_\-]/,O={type:"class",value:"[:a-zA-z0-9_\\-]",description:"[:a-zA-z0-9_\\-]"},P=function(a){return{signal:a.join("")}},Q="(",R={type:"literal",value:"(",description:'"("'},S=")",T={type:"literal",value:")",description:'")"'},U=function(a){return{stream:a}},V=".",W={type:"literal",value:".",description:'"."'},X=":",Y={type:"literal",value:":",description:'":"'},Z=function(a){return{type:"class",value:a}},$="#",_={type:"literal",value:"#",description:'"#"'},ab=function(a){return{type:"id",value:a}},bb="mousedown",cb={type:"literal",value:"mousedown",description:'"mousedown"'},db="mouseup",eb={type:"literal",value:"mouseup",description:'"mouseup"'},fb="click",gb={type:"literal",value:"click",description:'"click"'},hb="dblclick",ib={type:"literal",value:"dblclick",description:'"dblclick"'},jb="wheel",kb={type:"literal",value:"wheel",description:'"wheel"'},lb="keydown",mb={type:"literal",value:"keydown",description:'"keydown"'},nb="keypress",ob={type:"literal",value:"keypress",description:'"keypress"'},pb="keyup",qb={type:"literal",value:"keyup",description:'"keyup"'},rb="mousewheel",sb={type:"literal",value:"mousewheel",description:'"mousewheel"'},tb="mousemove",ub={type:"literal",value:"mousemove",description:'"mousemove"'},vb="mouseout",wb={type:"literal",value:"mouseout",description:'"mouseout"'},xb="mouseover",yb={type:"literal",value:"mouseover",description:'"mouseover"'},zb="mouseenter",Ab={type:"literal",value:"mouseenter",description:'"mouseenter"'},Bb=function(a,b,c,d){return a+b+c+d},Cb="e.",Db={type:"literal",value:"e.",description:'"e."'},Eb="i.",Fb={type:"literal",value:"i.",description:'"i."'},Gb="d.",Hb={type:"literal",value:"d.",description:'"d."'},Ib="p.",Jb={type:"literal",value:"p.",description:'"p."'},Kb="==",Lb={type:"literal",value:"==",description:'"=="'},Mb="!=",Nb={type:"literal",value:"!=",description:'"!="'},Ob=">=",Pb={type:"literal",value:">=",description:'">="'},Qb="<",Rb={type:"literal",value:"<",description:'"<"'},Sb="<=",Tb={type:"literal",value:"<=",description:'"<="'},Ub=/^['"a-zA-Z0-9_\-]/,Vb={type:"class",value:"['\"a-zA-Z0-9_\\-]",description:"['\"a-zA-Z0-9_\\-]"},Wb=function(a){return a.join("")},Xb=/^[ \t\r\n]/,Yb={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},Zb=0,$b=0,_b=0,ac={line:1,column:1,seenCR:!1},bc=0,cc=[],dc=0;if("startRule"in t){if(!(t.startRule in v))throw new Error("Can't start parsing from rule \""+t.startRule+'".');w=v[t.startRule]}if(s=w(),s!==u&&Zb===a.length)return s;throw s!==u&&Zb<a.length&&d({type:"end",description:"end of input"}),e(null,cc,bc)}return a(b,Error),{SyntaxError:b,parse:c}}),f("parse/streams",["require","exports","module","d3","../core/changeset","./events","./expr","../util/index"],function(a){var b=a("d3"),c=a("../core/changeset"),d=a("./events"),e=a("./expr"),f=a("../util/index"),g="start",h="middle",i="end";return function(a){function j(a,b,c,d){var f=new n.Node(function(b){var f=e.eval(n,c.fn,null,null,null,null,c.signals);return d.scale&&(f=n.scene().scale(d,f)),a.value(f),b.signals[a.name()]=1,b.touch=!0,b});f._deps.signals=[b.signal],f.addListener(a.node()),n.signal(b.signal).addListener(f)}function k(a,b,c,d){var g=b.filters||[],h=b.target;h&&g.push("i."+h.type+"=="+f.str(h.value)),p[b.event]=p[b.event]||[],p[b.event].push({signal:a,exp:c,filters:g.map(function(a){return e(n,a)}),spec:d}),q[b.event]=q[b.event]||new n.Node,q[b.event].addListener(a.node())}function l(a,b,c,d){var f=a.name(),l=e(n,"true"),o={};o[g]=n.signal(f+g,!1),o[h]=n.signal(f+h,!1),o[i]=n.signal(f+i,!1);var p=new n.Node(function(b){return o[g].value()===!0&&o[i].value()===!1?b.signals[f+g]?n.graph.doNotPropagate:(a.value(o[h].value()),b.signals[f]=1,b):(o[i].value()===!0&&(o[g].value(!1),o[i].value(!1)),n.graph.doNotPropagate)});p.addListener(a.node()),[g,h,i].forEach(function(a){var e=a==h?c:l,f=a==h?d:{};b[a].event?k(o[a],b[a],e,f):b[a].signal?j(o[a],b[a],e,f):b[a].stream&&m(o[a],b[a],e,f),o[a].addListener(p)})}function m(a,b,c,d){b.forEach(function(b){b.event?k(a,b,c,d):b.signal?j(a,b,c,d):b.start?l(a,b,c,d):b.stream&&m(a,b.stream,c,d)})}var n=a.model(),o=n._defs.signals,p={},q={};(o||[]).forEach(function(a){var b=n.signal(a.name);a.expr||(a.streams||[]).forEach(function(a){var c=d.parse(a.type),f=e(n,a.expr);m(b,c,f,a)})}),f.keys(p).forEach(function(d){var f=p[d],g=q[d];a.on(d,function(d,h){var i,j,k,l,m,o=c.create({},!0),p=a.padding(),q=!1,r={};for(d.preventDefault(),b.event=d,l=b.mouse(a._el),r.x=l[0]-p.left,r.y=l[1]-p.top,h=h||{},m=h.datum||{},k=0;k<f.length;k++)j=f[k],q=j.filters.some(function(a){return!e.eval(n,a.fn,m,d,h,r,a.signals)}),q||(i=e.eval(n,j.exp.fn,m,d,h,r,j.exp.signals),j.spec.scale&&(i=n.scene().scale(j.spec,i)),j.signal.value(i),o.signals[j.signal.name()]=1);n.graph.propagate(o,g)})})}}),f("canvas/marks",["require","exports","module","../core/Bounds","../util/bounds","../util/index","../util/config","./path"],function(a){function b(a,b){var c=b.x||0,d=b.y||0,e=b.innerRadius||0,f=b.outerRadius||0,g=(b.startAngle||0)-Math.PI/2,h=(b.endAngle||0)-Math.PI/2;a.beginPath(),0===e?a.moveTo(c,d):a.arc(c,d,e,g,h,0),a.arc(c,d,f,h,g,1),a.closePath()}function c(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=E(D.area(b)));F(a,e)}function d(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=E(D.line(b)));F(a,e)}function e(a,b){if(null!=b.path){var c=b.pathCache||(b.pathCache=E(b.path));return F(a,c,b.x,b.y)}}function f(a,b){a.beginPath();var c,d,e,f,g=null!=b.size?b.size:100,h=b.x,i=b.y;if(null==b.shape||"circle"===b.shape)return c=Math.sqrt(g/Math.PI),a.arc(h,i,c,0,2*Math.PI,0),void a.closePath();switch(b.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,a.moveTo(h-d,i-c),a.lineTo(h-c,i-c),a.lineTo(h-c,i-d),a.lineTo(h+c,i-d),a.lineTo(h+c,i-c),a.lineTo(h+d,i-c),a.lineTo(h+d,i+c),a.lineTo(h+c,i+c),a.lineTo(h+c,i+d),a.lineTo(h-c,i+d),a.lineTo(h-c,i+c),a.lineTo(h-d,i+c);break;case"diamond":f=Math.sqrt(g/(2*H)),e=f*H,a.moveTo(h,i-f),a.lineTo(h+e,i),a.lineTo(h,i+f),a.lineTo(h-e,i);break;case"square":d=Math.sqrt(g),c=d/2,a.rect(h-c,i-c,d,d);break;case"triangle-down":e=Math.sqrt(g/G),f=e*G/2,a.moveTo(h,i+f),a.lineTo(h+e,i-f),a.lineTo(h-e,i-f);break;case"triangle-up":e=Math.sqrt(g/G),f=e*G/2,a.moveTo(h,i-f),a.lineTo(h+e,i+f),a.lineTo(h-e,i+f)}a.closePath()}function g(a,b){var c=b[0],e=c.strokeWidth,f=c.strokeCap;a.lineWidth=null!=e?e:C.render.lineWidth,a.lineCap=null!=f?f:C.render.lineCap,d(a,b)}function h(a,b){var c=b.x||0,d=b.y||0,e=null!=b.x2?b.x2:c,f=null!=b.y2?b.y2:d,g=b.strokeWidth,h=b.strokeCap;a.lineWidth=null!=g?g:C.render.lineWidth,a.lineCap=null!=h?h:C.render.lineCap,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f)}function i(a,b,c,d){var e,f,g,h=c.fill,i=c.stroke;a(b,d),e=null==c.opacity?1:c.opacity,0!=e&&(h||i)&&(h&&(b.globalAlpha=e*(null==c.fillOpacity?1:c.fillOpacity),b.fillStyle=r(b,c,h),b.fill()),i&&(g=null!=(g=c.strokeWidth)?g:C.render.lineWidth,g>0&&(b.globalAlpha=e*(null==c.strokeOpacity?1:c.strokeOpacity),b.strokeStyle=r(b,c,i),b.lineWidth=g,b.lineCap=null!=(f=c.strokeCap)?f:C.render.lineCap,b.vgLineDash(c.strokeDash||null),b.vgLineDashOffset(c.strokeDashOffset||0),b.stroke())))}function j(a,b,c,d){var e,f,g;for(e=0,f=c.items.length;f>e;++e)g=c.items[e],(!d||d.intersects(g.bounds))&&i(a,b,g,g)}function k(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m,n=b.items,o=0,p=n.length;p>o;++o)d=n[o],(!c||c.intersects(d.bounds))&&(j=d.x||0,k=d.y||0,l=d.width||0,m=d.height||0,g=null==d.opacity?1:d.opacity,0!=g&&((e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=r(a,d,e),a.fillRect(j,k,l,m)),(f=d.stroke)&&(i=null!=(i=d.strokeWidth)?i:C.render.lineWidth,i>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(a,d,f),a.lineWidth=i,a.lineCap=null!=(h=d.strokeCap)?h:C.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.strokeRect(j,k,l,m)))))}function l(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(i=d.x||0,j=d.y||0,k=null!=d.x2?d.x2:i,l=null!=d.y2?d.y2:j,f=null==d.opacity?1:d.opacity,0!=f&&(e=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:C.render.lineWidth,h>0&&(a.globalAlpha=f*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(a,d,e),a.lineWidth=h,a.lineCap=null!=(g=d.strokeCap)?g:C.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),a.stroke())))}function m(a,b,c){if(b.items.length)for(var d,e=this,f=b.items,g=0,h=f.length;h>g;++g)if(d=f[g],!c||c.intersects(d.bounds)){d.image&&d.image.url===d.url||(d.image=e.loadImage(d.url),d.image.url=d.url);var i,j,k,l,m;k=d.width||d.image&&d.image.width||0,l=d.height||d.image&&d.image.height||0,i=(d.x||0)-("center"===d.align?k/2:"right"===d.align?k:0),j=(d.y||0)-("middle"===d.baseline?l/2:"bottom"===d.baseline?l:0),d.image.loaded&&(a.globalAlpha=null!=(m=d.opacity)?m:1,a.drawImage(d.image,i,j,k,l))}}function n(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(a.font=B.fontString(d),a.textAlign=d.align||"left",a.textBaseline=d.baseline||"alphabetic",g=null==d.opacity?1:d.opacity,0!=g&&(i=d.x||0,j=d.y||0,(k=d.radius)&&(l=(d.theta||0)-Math.PI/2,i+=k*Math.cos(l),j+=k*Math.sin(l)),d.angle?(a.save(),a.translate(i,j),a.rotate(d.angle*Math.PI/180),i=d.dx||0,j=d.dy||0):(i+=d.dx||0,j+=d.dy||0),(e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=r(a,d,e),a.fillText(d.text,i,j)),(f=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:1,h>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(d,f),a.lineWidth=h,a.strokeText(d.text,i,j))),d.angle&&a.restore()))}function o(a){return function(b,c,d){j(a,b,c,d)}}function p(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.items[0].bounds))&&i(a,b,c.items[0],c.items)}}function q(a,b,c){if(b.items.length){var d,e,f,g,h,i,j,l,m,n=b.items,o=this;for(k(a,b,c),i=0,j=n.length;j>i;++i){for(d=n[i],e=d.axisItems||[],f=d.legendItems||[],g=d.x||0,h=d.y||0,a.save(),a.translate(g,h),d.clip&&(a.beginPath(),a.rect(0,0,d.width||0,d.height||0),a.clip()),c&&c.translate(-g,-h),l=0,m=e.length;m>l;++l)"back"===e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=d.items.length;m>l;++l)o.draw(a,d.items[l],c);for(l=0,m=e.length;m>l;++l)"back"!==e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=f.length;m>l;++l)o.draw(a,f[l],c);c&&c.translate(g,h),a.restore()}}}function r(a,b,c){return c.id?s(a,c,b.bounds):c}function s(a,b,c){var d,e,f=c.width(),g=c.height(),h=c.x1+b.x1*f,i=c.y1+b.y1*g,j=c.x1+b.x2*f,k=c.y1+b.y2*g,l=a.createLinearGradient(h,i,j,k),m=b.stops;for(d=0,e=m.length;e>d;++d)l.addColorStop(m[d].offset,m[d].color);return l}function t(a,b,c,d,e,f){if(0===b.items.length||b.bounds&&!b.bounds.contains(e,f))return!1;var g,h,i,j,k,l,m,n=b.items,o=this;for(l=n.length;--l>=0;){for(h=n[l],j=h.x||0,k=h.y||0,a.save(),a.translate(j,k),m=h.items.length;--m>=0;)if(g=h.items[m],g.interactive!==!1&&(i=o.pick(g,c,d,e-j,f-k)))return a.restore(),i;a.restore()}return b.interactive?u(J.group,a,b,c,d,e,f):!1}function u(a,b,c,d,e,f,g){if(!c.items.length)return!1;var h,i,j;for(1!==b._ratio&&(d*=b._ratio,e*=b._ratio),j=c.items.length;--j>=0;)if(h=c.items[j],i=h.bounds,(!i||i.contains(f,g))&&i&&a(b,h,d,e,f,g))return h;return!1}function v(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),J.area(a,h,c,d)?h[0]:!1)}function w(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),J.line(a,h,c,d)?h[0]:!1)}function x(a){return function(b,c,d,e,f,g){return u(a,b,c,d,e,f,g)}}function y(a,b,c,d,e,f){if(!b.fontSize)return!1;if(!b.angle)return!0;var g=A.text(b,I,!0),h=-b.angle*Math.PI/180,i=Math.cos(h),j=Math.sin(h),c=b.x,d=b.y,k=i*e-j*f+(c-c*i+d*j),l=j*e+i*f+(d-c*j-d*i);return g.contains(k,l)}var z=a("../core/Bounds"),A=a("../util/bounds"),B=a("../util/index"),C=a("../util/config"),D=a("./path"),E=D.parse,F=D.render,G=(Math.PI/2,Math.sqrt(3)),H=Math.tan(30*Math.PI/180),I=new z,J={text:y,rect:function(){return!0},image:function(){return!0},group:function(a,b){return b.fill||b.stroke},rule:function(a,b,c,d){return a.isPointInStroke?(h(a,b),a.isPointInStroke(c,d)):!1},line:function(a,b,c,d){return a.isPointInStroke?(g(a,b),a.isPointInStroke(c,d)):!1},arc:function(a,c,d,e){return b(a,c),a.isPointInPath(d,e)},area:function(a,b,d,e){return c(a,b),a.isPointInPath(d,e)},path:function(a,b,c,d){return e(a,b),a.isPointInPath(c,d)},symbol:function(a,b,c,d){return f(a,b),a.isPointInPath(c,d)}};return{draw:{group:q,area:p(c),line:p(d),arc:o(b),path:o(e),symbol:o(f),rect:k,rule:l,text:n,image:m,drawOne:p,drawAll:o},pick:{group:t,area:v,line:w,arc:x(J.arc),path:x(J.path),symbol:x(J.symbol),rect:x(J.rect),rule:x(J.rule),text:x(J.text),image:x(J.image),pickAll:u}}}),f("canvas/Handler",["require","exports","module","d3","../util/index","./marks"],function(a){function b(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var c=a("d3"),d=a("../util/index"),e=a("./marks"),f=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},g=f.prototype;g.initialize=function(a,b,d){this._el=c.select(a).node(),this._canvas=c.select(a).select("canvas.marks").node(),this._padding=b,this._obj=d||null;var e=this._canvas,f=this;return h.forEach(function(a){e.addEventListener(a,function(b){g[a].call(f,b)})}),this},g.padding=function(a){return this._padding=a,this},g.model=function(a){return arguments.length?(this._model=a,this):this._model},g.handlers=function(){var a=this._handlers;return d.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])};var h=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return h.forEach(function(a){g[a]=function(b){this.fire(a,b)}}),h.push("mousemove"),h.push("mouseout"),g.mousemove=function(a){var b=this._padding,c=a.target.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=this._active,g=this.pick(this._model.scene(),d,e,d-b.left,e-b.top);return g===f?void this.fire("mousemove",a):(f&&this.fire("mouseout",a),this._active=g,void(g&&this.fire("mouseover",a)))},g.mouseout=function(a){this._active&&this.fire("mouseout",a),this._active=null},g.DOMMouseScroll=function(a){this.fire("mousewheel",a)},g.fire=function(a,b){var c=this._active,d=this._handlers[a];if(d)for(var e=0,f=d.length;f>e;++e)d[e].handler.call(this._obj,b,c)},g.on=function(a,c){var d=b(a),e=this._handlers;return e=e[d]||(e[d]=[]),e.push({type:a,handler:c}),this},g.off=function(a,c){var d=b(a),e=this._handlers[d];if(e){for(var f=e.length;--f>=0;)e[f].type===a&&(c&&e[f].handler!==c||e.splice(f,1));return this}},g.context=function(){return this._canvas.getContext("2d")},g.pick=function(a,b,c,d,f){var g=this.context(),h=a.marktype,i=e.pick[h];return i.call(this,g,a,b,c,d,f)},f}),f("canvas/Renderer",["require","exports","module","d3","../core/Bounds","../util/load","../util/config","./marks"],function(a){function b(a,b){var c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.setAttribute("width",f*e),a.setAttribute("height",g*e),a.style.width=f+"px",a.style.height=g+"px"}return e}function c(a){if(!a.vgLineDash){var b=[];a.setLineDash?(a.vgLineDash=function(a){this.setLineDash(a||b)},a.vgLineDashOffset=function(a){this.lineDashOffset=a}):void 0!==a.webkitLineDash?(a.vgLineDash=function(a){this.webkitLineDash=a||b},a.vgLineDashOffset=function(a){this.webkitLineDashOffset=a}):void 0!==a.mozDash?(a.vgLineDash=function(a){this.mozDash=a},a.vgLineDashOffset=function(){}):(a.vgLineDash=function(){},a.vgLineDashOffset=function(){})}}function d(a,b){for(var c=new h(b);null!=(a=a.mark.group);)c.translate(a.x||0,a.y||0);return c}function e(a){return a?util.array(a).reduce(function(a,b){return a.union(d(b,b.bounds)).union(d(b,b["bounds:prev"]))},new h):null}function f(a,b){var c=null;return b&&(c=new h(b).round(),a.beginPath(),a.rect(c.x1,c.y1,c.width(),c.height()),a.clip()),c}var g=a("d3"),h=a("../core/Bounds"),i=(a("../util/load"),a("../util/config")),j=a("./marks"),k=function(){this._ctx=null,this._el=null,this._imgload=0},l=k.prototype;return l.initialize=function(a,b,c,d){if(this._el=a,!a)return this;var e=g.select(a).selectAll("canvas.marks").data([1]);return e.enter().append("canvas").attr("class","marks"),e.exit().remove(),this.resize(b,c,d)},l.resize=function(a,d,e){if(this._width=a,this._height=d,this._padding=e,this._el){var f=g.select(this._el).select("canvas.marks");f.attr("width",a+e.left+e.right).attr("height",d+e.top+e.bottom);var h;this._ctx=f.node().getContext("2d"),this._ctx._ratio=h=b(f.node(),this._ctx)||1,this._ctx.setTransform(h,0,0,h,h*e.left,h*e.top)}return c(this._ctx),this},l.context=function(a){return a?(this._ctx=a,this):this._ctx},l.element=function(){return this._el},l.pendingImages=function(){return this._imgload},l.render=function(a,b){var c,d=this._ctx,g=this._padding,h=this._width+g.left+g.right,i=this._height+g.top+g.bottom,j=null;this._scene=a,d.save(),j=f(d,e(b)),d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,j),b&&(d.restore(),d.save(),c=f(d,e(b)),j.encloses(c)||(d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,c))),d.restore(),this._scene=null},l.draw=function(a,b,c){var d=b.marktype,e=j.draw[d];e.call(this,a,b,c)},l.renderAsync=function(a){var b=this;b._async_id&&clearTimeout(b._async_id),b._async_id=setTimeout(function(){b.render(a),delete b._async_id},50)},l.loadImage=function(a){var b,c=this,d=c._scene,e=null;return c._imgload+=1,i.isNode||(e=new Image,b=i.baseURL+a,e.onload=function(){util.log("LOAD IMAGE: "+b),e.loaded=!0,c._imgload-=1,c.renderAsync(d)},e.src=b),e},k}),f("canvas/index",["require","exports","module","./Handler","./Renderer"],function(a){return{Handler:a("./Handler"),Renderer:a("./Renderer")}}),f("svg/Handler",["require","exports","module","../util/index"],function(b){function c(a){var b=this;return function(c){var d=c.target,e=d.__data__;e&&(e=e.mark?e:e[0]),a.call(b._obj,c,e)}}function d(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var e=b("../util/index"),f=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},g=f.prototype;return g.initialize=function(b,c,d){return this._el=a.select(b).node(),this._svg=a.select(b).select("svg.marks").node(),this._padding=c,this._obj=d||null,this},g.padding=function(a){return this._padding=a,this
},g.model=function(a){return arguments.length?(this._model=a,this):this._model},g.handlers=function(){var a=this._handlers;return e.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])},g.on=function(b,e){var f=d(b),g=this._handlers,h=a.select(this._svg).node(),i={type:b,handler:e,svg:c.call(this,e)};return g=g[f]||(g[f]=[]),g.push(i),h.addEventListener(f,i.svg),this},g.off=function(b,c){var e=d(b),f=this._handlers[e],g=a.select(this._svg).node();if(f){for(var h=f.length;--h>=0;)f[h].type===b&&(c&&f[h].handler!==c||(g.removeEventListener(e,f[h].svg),f.splice(h,1)));return this}},f}),f("svg/marks",["require","exports","module","d3","../util/index","../util/config"],function(a){function b(a){return a.x||0}function c(a){return a.y||0}function d(a){return a.y+a.height||0}function e(a){return null==a.size?100:a.size}function f(a){return a.shape||"circle"}function g(a){var b,c,d,e,f,g=a.mark?a:a.length?a[0]:null;if(null!==g)for(b=0,c=I.length;c>b;++b)d=I[b],e=H[d],f=g[d],null==f?"fill"===e?this.style.setProperty(e,"none",null):this.style.removeProperty(e):(f.id&&(J.current._defs.gradient[f.id]=f,f="url(#"+f.id+")"),this.style.setProperty(e,f+"",null))}function h(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",A(a))}function i(a){if(a.length){var b=a[0];B.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",B(a))}}function j(a){if(a.length){var b=a[0];C.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",C(a))}}function k(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),null!=a.path&&this.setAttribute("d",a.path)}function l(a){this.setAttribute("x",a.x||0),this.setAttribute("y",a.y||0),this.setAttribute("width",a.width||0),this.setAttribute("height",a.height||0)}function m(a){var b=a.x||0,c=a.y||0;this.setAttribute("x1",b),this.setAttribute("y1",c),this.setAttribute("x2",null!=a.x2?a.x2:b),this.setAttribute("y2",null!=a.y2?a.y2:c)}function n(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",D(a))}function o(a){var b=a.width||a.image&&a.image.width||0,c=a.height||a.image&&a.image.height||0,d=a.x-("center"===a.align?b/2:"right"===a.align?b:0),e=a.y-("middle"===a.baseline?c/2:"bottom"===a.baseline?c:0),f=z.baseURL+a.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",f),this.setAttribute("x",d),this.setAttribute("y",e),this.setAttribute("width",b),this.setAttribute("height",c)}function p(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:z.render.fontSize)+"px "+(a.font||z.render.font)}function q(a){var b=a.x||0,c=a.y||0,d=a.dx||0,e=a.dy||0,f=a.angle||0,g=a.radius||0,h=G[a.align||"left"],i="top"===a.baseline?".9em":"middle"===a.baseline?".35em":0;if(g){var j=(a.theta||0)-Math.PI/2;b+=g*Math.cos(j),c+=g*Math.sin(j)}this.setAttribute("x",b+d),this.setAttribute("y",c+e),this.setAttribute("text-anchor",h),f?this.setAttribute("transform","rotate("+f+" "+b+","+c+")"):this.removeAttribute("transform"),i?this.setAttribute("dy",i):this.removeAttribute("dy"),this.textContent=a.text,this.style.setProperty("font",p(a),null)}function r(a){var b=a.x||0,c=a.y||0;if(this.setAttribute("transform","translate("+b+","+c+")"),a.clip){var d={width:a.width||0,height:a.height||0},e=a.clip_id||(a.clip_id="clip"+F++);J.current._defs.clipping[e]=d,this.setAttribute("clip-path","url(#"+e+")")}}function s(a){var b=a.width||0,c=a.height||0;this.setAttribute("width",b),this.setAttribute("height",c)}function t(a){var b="type-"+a.type;return a.name&&(b+=" "+a.name),b}function u(a,b,c){return function(d,e,f){v(d,e,f,"mark_",a,b,c)}}function v(a,b,c,d,e,f,h){var i=h?[b.items]:b.items,j=b.interactive===!1?"none":null,k=a.node().childNodes,l="g"!==e,m=(m=k[c+1])?x.select(m):a.append("g").attr("id","g"+ ++E).attr("class",t(b.def)),n=m.attr("id"),o="#"+n+" > "+e,p=m.selectAll(o).data(i),q=p.enter().append(e);return l?(m.style("pointer-events",j),q.each(function(a){a.mark?a._svg=this:a.length&&(a[0]._svg=this)})):q.append("rect").attr("class","background").style("pointer-events",j),p.exit().remove(),p.each(f),l?p.each(g):m.selectAll(o+" > rect.background").each(s).each(g),m}function w(a,b,c,d){var e,f,g,h=v(a,b,c,d||"group_","g",r),i=h.node().childNodes,j=i.length;for(e=0;j>e;++e){var k=i[e].__data__.items,l=i[e].__data__.legendItems||[],m=i[e].__data__.axisItems||[],n=x.select(i[e]),o=0;for(f=0,g=m.length;g>f;++f)"back"===m[f].def.layer&&w.call(this,n,m[f],o++,"axis_");for(f=0,g=k.length;g>f;++f)this.draw(n,k[f],o++);for(f=0,g=m.length;g>f;++f)"back"!==m[f].def.layer&&w.call(this,n,m[f],o++,"axis_");for(f=0,g=l.length;g>f;++f)w.call(this,n,l[f],o++,"legend_")}}var x=a("d3"),y=a("../util/index"),z=a("../util/config"),A=x.svg.arc(),B=x.svg.area().x(b).y1(c).y0(d),C=x.svg.line().x(b).y(c),D=x.svg.symbol().type(f).size(e),E=0,F=0,G={left:"start",center:"middle",right:"end"},H={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},I=y.keys(H),J={update:{group:l,area:i,line:j,arc:h,path:k,symbol:n,rect:l,rule:m,text:q,image:o},nested:{area:!0,line:!0},style:g,draw:{group:w,area:u("path",i,!0),line:u("path",j,!0),arc:u("path",h),path:u("path",k),symbol:u("path",n),rect:u("rect",l),rule:u("line",m),text:u("text",q),image:u("image",o),draw:u},current:null};return J}),f("svg/Renderer",["require","exports","module","../util/index","./marks"],function(b){var c=b("../util/index"),d=b("./marks"),e=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},f=e.prototype;return f.initialize=function(b,c,d,e){return this._el=b,a.select(b).select("svg.marks").remove(),this._svg=a.select(b).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(c,d,e)},f.resize=function(a,b,c){return this._width=a,this._height=b,this._padding=c,this._svg.attr("width",a+c.left+c.right).attr("height",b+c.top+c.bottom),this._ctx.attr("transform","translate("+c.left+","+c.top+")"),this},f.context=function(){return this._ctx},f.element=function(){return this._el},f.updateDefs=function(){var b,d,e=this._svg,f=this._defs,g=c.keys(f.gradient),h=c.keys(f.clipping),i=e.select("defs");return 0===g.length&&0==h.length?void i.remove():(i.empty()&&(i=e.insert("defs",":first-child")),b=i.selectAll("linearGradient").data(g,c.identity),b.enter().append("linearGradient").attr("id",c.identity),b.exit().remove(),b.each(function(b){var c=f.gradient[b],d=a.select(this);d.attr({x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),stop=d.selectAll("stop").data(c.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})}),d=i.selectAll("clipPath").data(h,c.identity),d.enter().append("clipPath").attr("id",c.identity),d.exit().remove(),void d.each(function(b){var c=f.clipping[b],d=a.select(this).selectAll("rect").data([1]);d.enter().append("rect"),d.attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height)}))},f.render=function(a,b){d.current=this,b?this.renderItems(c.array(b)):this.draw(this._ctx,a,-1),this.updateDefs(),delete d.current},f.renderItems=function(a){var b,c,e,f,g;for(f=0,g=a.length;g>f;++f)b=a[f],c=b._svg,e=b.mark.marktype,b=d.nested[e]?b.mark.items:b,d.update[e].call(c,b),d.style.call(c,b)},f.draw=function(a,b,c){var e=b.marktype,f=d.draw[e];f.call(this,a,b,c)},e}),f("svg/index",["require","exports","module","./Handler","./Renderer"],function(a){return{Handler:a("./Handler"),Renderer:a("./Renderer")}}),f("scene/transition",["require","exports","module","../core/tuple","../util/bounds","../util/constants"],function(b){function c(b,c){this.duration=b||500,this.ease=c&&a.ease(c)||a.ease("cubic-in-out"),this.updates={next:null}}function d(a){for(var b,c,d,e,g,h,i=this.updates,j=i,k=j.next,l=this.duration,m=!0;null!=k;j=k,k=j.next)if(b=k.item,c=b.delay||0,d=(a-c)/l,0>d)m=!1;else{for(d>1&&(d=1),e=k.ease(d),g=0,h=k.length;h>g;++g)b[k[g].property]=k[g](e);b.touch(),f.item(b),1===d?(k.remove&&b.remove(),j.next=k.next,k=j):m=!1}return this.callback(),m}var e=b("../core/tuple"),f=b("../util/bounds"),g=b("../util/constants"),h=c.prototype,i={text:1,url:1};return h.interpolate=function(b,c,d){var f,h,j,k,l=null;for(f in c)h=b[f],j=c[f],h!==j&&(i[f]||void 0===h?e.set(b,f,j,d):"number"!=typeof h||isFinite(h)?(k=a.interpolate(h,j),k.property=f,(l||(l=[])).push(k)):e.set(b,f,j,d));return null===l&&b.status===g.EXIT&&(l=[]),null!=l&&(l.item=b,l.ease=b.mark.ease||this.ease,l.next=this.updates.next,this.updates.next=l),this},h.start=function(b){for(var c=this,e=c.updates,f=e.next;null!=f;e=f,f=e.next)f.item.status===g.EXIT&&(f.remove=!0);c.callback=b,a.timer(function(a){return d.call(c,a)})},c}),f("core/View",["require","exports","module","d3","../parse/streams","../canvas/index","../svg/index","../scene/transition","../util/config","../util/index","../core/changeset"],function(a){var b=a("d3"),c=a("../parse/streams"),d=a("../canvas/index"),e=a("../svg/index"),f=a("../scene/transition"),g=a("../util/config"),h=a("../util/index"),i=a("../core/changeset"),j=function(a,b,c){this._el=null,this._model=null,this._width=this.__width=b||500,this._height=this.__height=c||300,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=d,a&&this.initialize(a)},k=j.prototype;return k.model=function(a){return arguments.length?(this._model!==a&&(this._model=a,this._handler&&this._handler.model(a)),this):this._model},k.data=function(a){var b=this.model();return arguments.length?(h.keys(a).forEach(function(c){b.data(c).add(a[c])}),this):b.data()},k.width=function(a){return arguments.length?(this.__width!==a&&(this._width=this.__width=a,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__width},k.height=function(a){return arguments.length?(this.__height!==a&&(this._height=this.__height=a,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__height},k.padding=function(a){return arguments.length?(this._padding!==a&&(h.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,a),this._handler.padding(a))),this):this._padding},k.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this.model().scene().bounds,d=g.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,h=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:h,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+h)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},k.viewport=function(a){return arguments.length?(this._viewport!==a&&(this._viewport=a,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},k.renderer=function(a){return arguments.length?("canvas"===a&&(a=d),"svg"===a&&(a=e),this._io!==a&&(this._io=a,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},k.initialize=function(a){var d,e=this,f=e._width,g=e._height,h=e._padding;return b.select(a).select("div.vega").remove(),this._el=a=b.select(a).append("div").attr("class","vega").style("position","relative").node(),e._viewport&&b.select(a).style("width",(e._viewport[0]||f)+"px").style("height",(e._viewport[1]||g)+"px").style("overflow","auto"),e._renderer=(e._renderer||new this._io.Renderer).initialize(a,f,g,h),d=e._handler,e._handler=(new this._io.Handler).initialize(a,h,e).model(e._model),d?d.handlers().forEach(function(a){e._handler.on(a.type,a.handler)}):c(this),this},k.update=function(a){a=a||{};var b=this,c=a.duration?new f(a.duration,a.ease):null,d=i.create({});return c&&(d.trans=c),b._build||(b._renderNode=new b._model.Node(function(a){h.debug(a,["rendering"]);var c=b._model.scene();return a.trans?a.trans.start(function(a){b._renderer.render(c,a)}):b._renderer.render(c),a}),b._renderNode._router=!0,b._renderNode._type="renderer",b._model.scene(b._renderNode),b._build=!0),b._model.fire(d),b.autopad(a)},k.on=function(){return this._handler.on.apply(this._handler,arguments),this},k.off=function(){return this._handler.off.apply(this._handler,arguments),this},j.factory=function(a){return function(b){b=b||{};var c=a._defs,d=(new j).model(a).width(c.width).height(c.height).padding(c.padding).renderer(b.renderer||"canvas");return b.el&&d.initialize(b.el),b.data&&d.data(b.data),d}},j}),f("parse/padding",["require","exports","module","../util/index"],function(a){var b=a("../util/index");return function(a){if(null==a)return"auto";if(b.isString(a))return"strict"===a?"strict":"auto";if(b.isObject(a))return a;var c=b.isNumber(a)?a:20;return{top:c,left:c,right:c,bottom:c}}}),f("parse/marks",["require","exports","module","./mark"],function(a){var b=a("./mark");return function(a,c,d,e){return{type:"group",width:d,height:e,scales:c.scales||[],axes:c.axes||[],marks:(c.marks||[]).map(function(c){return b(a,c)})}}}),f("parse/signals",["require","exports","module","./expr"],function(a){var b=a("./expr");return function(a,c){return(c||[]).forEach(function(d){var e,f,g=a.signal(d.name,d.init);d.expr&&(f=b(a,d.expr),e=new a.Node(function(e){var h=b.eval(a,f.fn,null,null,null,null,f.signals);return c.scale&&(h=a.scene().scale(c,h)),g.value(h),e.signals[d.name]=1,e}),e._deps.signals=f.signals,f.signals.forEach(function(b){a.signal(b).addListener(e)}),g.node(e))}),c}}),f("parse/predicates",["require","exports","module","../util/index"],function(a){var b=a("../util/index");return function(a,c){function d(a,c){var d=b.field(a),e="signals["+d.map(b.str).join("][")+"]";return c[d.shift()]=1,e}function e(c){var e=[],f=[],g={},h={};return b.array(c).forEach(function(c,i){var j="o"+i,k="";if(void 0!==c.value)k=b.str(c.value);else if(c.arg)k="args["+b.str(c.arg)+"]";else if(c.signal)k=d(c.signal,g);else if(c.predicate){var l=a.predicate(c.predicate);l.signals.forEach(function(a){g[a]=1}),l.data.forEach(function(a){h[a]=1}),b.keys(c.input).forEach(function(a){var e=c.input[a];k+="args["+b.str(a)+"] = ",e.signal?k+=d(e.signal,g):e.arg&&(k+="args["+b.str(e.arg)+"]"),k+=", "}),k+="predicates["+b.str(c.predicate)+"](args, db, signals, predicates)"}e.push(j),f.push(j+"=("+k+")")}),{code:"var "+e.join(", ")+";\n"+f.join(";\n")+";\n",signals:b.keys(g),data:b.keys(h)}}function f(a){var b=e(a.operands);return"="==a.type&&(a.type="=="),{code:b.code+"return "+["o0","o1"].join(a.type)+";",signals:b.signals,data:b.data}}function g(a){for(var b=e(a.operands),c=[],d=0,f=a.operands.length;c.push("o"+d++)<f;);return"and"==a.type?a.type="&&":"or"==a.type&&(a.type="||"),{code:b.code+"return "+c.join(a.type)+";",signals:b.signals,data:b.data}}function h(a){var c=[a.item];a.range&&c.push.apply(c,a.range),a.scale&&c.push(a.scale);var d=e(c),f=d.code;if(a.data){var g=b.field(a.field).map(b.str);f+="var where = function(d) { return d["+g.join("][")+"] == o0 };\n",f+="return db["+b.str(a.data)+"].filter(where).length > 0;"}else a.range&&(a.scale&&(f+="o1 = o3(o1);\no2 = o3(o2);\n"),f+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:f,signals:d.signals,data:d.data.concat(a.data?[a.data]:[])}}var i={"=":f,"==":f,"!=":f,">":f,">=":f,"<":f,"<=":f,and:g,"&&":g,or:g,"||":g,"in":h};return(c||[]).forEach(function(b){var c=i[b.type](b),d=Function("args","db","signals","predicates",c.code);d.signals=c.signals,d.data=c.data,a.predicate(b.name,d)}),c}}),f("parse/interactors",["require","exports","module","../util/load","../util/index","../util/constants"],function(a){var b=a("../util/load"),c=a("../util/index"),d=a("../util/constants");return function(a,e,f){function g(a){return function(b,d){if(b)c.error("LOADING FAILED: "+a.url);else{var e=c.isObject(d)?d:JSON.parse(d);h(a.name,e)}0==--q&&i()}}function h(a,b){r={},s={},e.signals=c.array(e.signals),e.predicates=c.array(e.predicates),e.signals.push.apply(e.signals,l(a,b.signals)),e.predicates.push.apply(e.predicates,m(a,b.predicates)),o(a,b.marks)}function i(){c.keys(t).length>0&&j(e.marks),f()}function j(a){var b,e,f,g;for(a=c.array(a),f=0,g=a.length;g>f;f++)b=a[f],(e=t[b.type])?(a[f]=c.duplicate(e),b.from&&(a[f].from=b.from),b.properties&&[d.ENTER,d.UPDATE,d.EXIT].forEach(function(d){a[f].properties[d]=c.extend(e.properties[d],b.properties[d])})):b.marks&&j(b.marks)}function k(a,b){return c.isString(b)?b+":"+a:(c.keys(b).forEach(function(c){a=a.replace(c,b[c])}),a)}function l(a,b){return b=c.array(b),b.forEach(function(b){b.name=r[b.name]=k(b.name,a),(b.streams||[]).forEach(function(a){a.type=k(a.type,r),a.expr=k(a.expr,r)})}),b}function m(a,b){return b=c.array(b),b.forEach(function(b){b.name=s[b.name]=k(b.name,a),[b.operands,b.range].forEach(function(a){(a||[]).forEach(function(a){a.signal?a.signal=k(a.signal,r):a.predicate&&n(a)})})}),b}function n(a){a.predicate=s[a.predicate],c.keys(a.input).forEach(function(b){var c=a.input[b];c.signal&&(c.signal=k(c.signal,r))})}function o(a,b){(b||[]).forEach(function(b){p(b.properties.enter),p(b.properties.update),p(b.properties.exit),t[k(b.name,a)]=b})}function p(a){c.keys(a).forEach(function(b){var c=a[b];c.signal?c.signal=k(c.signal,r):c.rule&&c.rule.forEach(function(a){a.signal&&(a.signal=k(a.signal,r)),a.predicate&&n(a)})})}var q=0,r={},s={},t={};return(e.interactors||[]).forEach(function(a){a.url&&(q+=1,b(a.url,g(a)))}),0===q&&setTimeout(i,1),e}}),f("parse/spec",["require","exports","module","../core/Model","../core/View","../parse/padding","../parse/marks","../parse/signals","../parse/predicates","../parse/data","../parse/interactors","../core/tuple","../util/index"],function(a){var b=a("../core/Model"),c=a("../core/View"),d=a("../parse/padding"),e=a("../parse/marks"),f=a("../parse/signals"),g=a("../parse/predicates"),h=a("../parse/data"),i=a("../parse/interactors"),j=(a("../core/tuple"),a("../util/index"));return function(a,k,l){a=j.duplicate(a),l=l||c.factory;var m=a.width||500,n=a.height||500,o=a.viewport||null,p=new b;i(p,a,function(){p._defs={width:m,height:n,viewport:o,padding:d(a.padding),signals:f(p,a.signals),predicates:g(p,a.predicates),marks:e(p,a,m,n),data:h(p,a.data,function(){k(l(p))})}})}}),f("d3",[],function(){return a}),f("topojson",[],function(){return b}),{parse:{spec:e("parse/spec")},util:e("util/index"),config:e("util/config")}});