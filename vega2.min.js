!function(a,b){if("function"==typeof define&&define.amd)define(["d3","topojson"],b);else if("object"==typeof exports)module.exports=b(require("d3"),require("topojson"));else{var c="undefined"==typeof topojson?null:topojson;a.vg=b(d3,c)}}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,e=function(a,c,d){c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("../node_modules/almond/almond",function(){}),e("util/constants",["require","exports","module"],function(){return{DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNALS:"signals",GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",MARK:"mark",AXIS:"axis"}}),e("dataflow/changeset",["require","exports","module","../util/constants"],function(a){function b(a,b){var c={};return d(a,c),c.add=[],c.mod=[],c.rem=[],c.reflow=b,c}function c(a){function b(a){a._prev=void 0===a._prev?void 0:e.SENTINEL}a.add.forEach(b),a.mod.forEach(b)}function d(a,b){b.stamp=a?a.stamp:0,b.sort=a?a.sort:null,b.facet=a?a.facet:null,b.trans=a?a.trans:null,f.forEach(function(c){b[c]=a?a[c]:{}})}var e=a("../util/constants"),f=[e.DATA,e.FIELDS,e.SCALES,e.SIGNALS];return{create:b,copy:d,finalize:c}}),e("util/config",["require","exports","module","d3"],function(a,b,c){var d=a("d3"),e={};return e.debug=!1,e.isNode="undefined"!=typeof c&&this.exports!==c,e.domainWhiteList=!1,e.safeMode=!1,e.baseURL="",e.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',e.autopadInset=5,e.scale={time:d.time.scale,utc:d.time.scale.utc},e.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},e.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},e.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},e.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},e.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e}),e("util/index",["require","exports","module","./config"],function(a){function b(a){return a.replace(h,"$1\\'")}function c(a,b,c){var d=0,e=a.split(i);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function d(a){console.log(a)}var e=a("./config"),f={},g=Object.prototype.toString;f.isObject=function(a){return a===Object(a)},f.isFunction=function(a){return"[object Function]"==g.call(a)},f.isString=function(a){return"[object String]"==g.call(a)},f.isArray=Array.isArray||function(a){return"[object Array]"==g.call(a)},f.isNumber=function(a){return"[object Number]"==g.call(a)},f.isBoolean=function(a){return"[object Boolean]"==g.call(a)},f.isTree=function(a){return a&&a.__vgtree__},f.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},f.number=function(a){return+a},f["boolean"]=function(a){return!!a},f.identity=function(a){return a},f["true"]=function(){return!0},f.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},f.duplicate=function(a){return JSON.parse(JSON.stringify(a))},f.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},f.accessor=function(a){var b;return f.isFunction(a)||null==a?a:f.isString(a)&&(b=f.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},f.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=f.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),f.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},f.cmp=function(a,b){return b>a?-1:a>b?1:0},f.numcmp=function(a,b){return a-b},f.array=function(a){return null!=a?f.isArray(a)?a:[a]:[]},f.values=function(a){return f.isObject(a)&&!f.isArray(a)&&a.values?f.isFunction(a.values)?a.values():a.values:a},f.tuple_ids=function(a){return a.reduce(function(a,b){return a[b._id]=1,a},{})},f.str=function(a){return f.isArray(a)?"["+a.map(f.str)+"]":f.isObject(a)?JSON.stringify(a):f.isString(a)?"'"+b(a)+"'":a};var h=/(^|[^\\])'/g;f.keys=function(a){var b=[];for(var c in a)b.push(c);return b},f.unique=function(a,b,c){if(!f.isArray(a)||0==a.length)return[];b=b||f.identity,c=c||[];for(var d,e=0,g=a.length;g>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},f.minIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),d>e&&(d=e,c=g);return c},f.maxIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),e>d&&(d=e,c=g);return c},f.truncate=function(a,b,d,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(d){case"left":return f+(e?c(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?c(a,i):a.slice(0,i))+f+(e?c(a,j,1):a.slice(g-j));default:return(e?c(a,h):a.slice(0,h))+f}};var i=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;return f.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:e.render.fontSize)+"px "+(a.font||e.render.font)},f.log=function(a){d("[Vega Log] "+a)},f.error=function(a){a="[Vega Err] "+a,d(a),"undefined"!=typeof alert&&alert(a)},f.debug=function(a,b){if(e.debug){var c=Function.prototype.bind.call(console.log,console);b.unshift(a.stamp||-1),a.add&&b.push(a.add.length,a.mod.length,a.rem.length,!!a.reflow),c.apply(console,b)}},f}),e("dataflow/tuple",["require","exports","module","../util/index","../util/constants"],function(a){function b(a,b){var c=Object.create(f.isObject(a)?a:{data:a});return c._id=++h,c._prev=void 0!==b?b||g.SENTINEL:void 0,c}function c(a,b,c){var e=a[b];e!==c&&(d(a,b),a[b]=c)}function d(a,b){void 0!==a._prev&&(a._prev=a._prev===g.SENTINEL?{}:a._prev,a._prev[b]=a[b])}function e(){h=1}var f=a("../util/index"),g=a("../util/constants"),h=1;return{create:b,set:c,prev:d,reset:e}}),e("dataflow/Node",["require","exports","module","../util/index","../util/constants"],function(a){function b(a){a&&this.init(a)}var c=a("../util/index"),d=a("../util/constants"),e=[d.DATA,d.FIELDS,d.SCALES,d.SIGNALS],f=b.prototype;return f.init=function(a){return this._graph=a,this._rank=++a._rank,this._stamp=0,this._listeners=[],this._deps={data:[],fields:[],scales:[],signals:[]},this._isRouter=!1,this._isCollector=!1,this._needsPrev=!1,this},f.clone=function(){var a=new b(this._graph);return a.evaluate=this.evaluate,a._deps=this._deps,a._isRouter=this._isRouter,a._isCollector=this._isCollector,a},f.rank=function(){return this._rank},f.last=function(a){return arguments.length?(this._stamp=a,this):this._stamp},f.dependency=function(a,b){var d=this._deps[a];if(1===arguments.length)return d;if(null===b)for(;d.length>0;)d.pop();else d.push.apply(d,c.array(b));return this},f.router=function(a){return arguments.length?(this._isRouter=!!a,this):this._isRouter},f.collector=function(a){return arguments.length?(this._isCollector=!!a,this):this._isCollector},f.prev=function(a){return arguments.length?(this._needsPrev=!!a,this):this._needsPrev},f.addListener=function(a){if(!(a instanceof b))throw"Listener is not a Node";if(-1===this._listeners.indexOf(a)){if(this._listeners.push(a),this._rank>a._rank)for(var c=[a];c.length;){var d=c.splice(0,1)[0];d._rank=++this._graph._rank,c=c.concat(d._listeners)}return this}},f.removeListener=function(a){for(var b=!1,c=0,d=this._listeners.length;d>c&&!b;c++)this._listeners[c]===a&&(this._listeners.splice(c,1),b=!0);return b},f.disconnect=function(){for(;this._listeners.length>0;)this._listeners.pop()},f.evaluate=function(a){return a},f.reevaluate=function(a){var b=this,c=!1;return e.some(function(d){return c=c||b._deps[d].some(function(b){return!!a[d][b]})})},b}),e("dataflow/Collector",["require","exports","module","./Node","./changeset","../util/index","../util/constants"],function(a){function b(a){return c.prototype.init.call(this,a),this._data=[],this.router(!0).collector(!0)}var c=a("./Node"),d=a("./changeset"),e=a("../util/index"),f=(a("../util/constants"),b.prototype=new c);return f.data=function(){return this._data},f.evaluate=function(a){if(e.debug(a,["collecting"]),a.reflow)return a=d.create(a),a.mod=this._data.slice(),a;if(a.rem.length){var b=a.rem.reduce(function(a,b){return a[b._id]=1,a},{});this._data=this._data.filter(function(a){return 1!==b[a._id]})}return a.add.length&&(this._data=this._data.length?this._data.concat(a.add):a.add),a.sort&&this._data.sort(a.sort),a},b}),e("dataflow/Datasource",["require","exports","module","./changeset","./tuple","./Node","./Collector","../util/index","../util/constants"],function(a){function b(a,b,d){this._graph=a,this._name=b,this._data=[],this._source=null,this._facet=d,this._input=c.create(),this._output=null,this._pipeline=null,this._collector=null,this._needsPrev=!1}var c=a("./changeset"),d=a("./tuple"),e=a("./Node"),f=a("./Collector"),g=a("../util/index"),h=a("../util/constants"),i=b.prototype;return i.source=function(a){return arguments.length?(this._source=this._graph.data(a),this):this._source},i.add=function(a){var b=this._input.add,c=this._needsPrev?null:void 0;return b.push.apply(b,g.array(a).map(function(a){return d.create(a,c)})),this},i.remove=function(a){var b=this._data.filter(a);return this._input.rem.push.apply(this._input.rem,b),this},i.update=function(a,b,c){{var e=this._input.mod;this._needsPrev?null:void 0}return this._input.fields[b]=1,this._data.filter(a).forEach(function(a){var f=a[b],g=c(a);f!==g&&(void 0===a._prev&&void 0!==f&&(a._prev=h.SENTINEL),d.prev(a,b),a.__proto__[b]=g,e.indexOf(a)<0&&e.push(a))}),this},i.values=function(a){return arguments.length?(this._input.rem=this._data.slice(),a&&this.add(a),this):this._collector?this._collector.data():this._data},i.last=function(){return this._output},i.fire=function(a){a&&(this._input=a),this._graph.propagate(this._input,this._pipeline[0])},i.pipeline=function(a){var b=this;a.length&&(b._collector=new f(this._graph),a.push(b._collector));var d=new e(this._graph).router(!0).collector(!0);d.evaluate=function(a){g.debug(a,["input",b._name]);var d=b._input,e=c.create(a);if(e.facet=b._facet,a.reflow)e.mod=b._source?b._source.values().slice():b._data.slice();else{var d=b._input,f=g.tuple_ids(d.rem);b._data=b._data.filter(function(a){return 1!==f[a._id]}).concat(d.add),b._input=c.create(),e.add=d.add,e.mod=d.mod,e.rem=d.rem}return e},a.unshift(d);var h=new e(this._graph).router(!0).collector(!0);return h.evaluate=function(a){g.debug(a,["output",b._name]);var d=c.create(a,!0);return b._facet&&(b._facet.values=b.values(),a.facet=null),b._output=a,d.data[b._name]=1,d},a.push(h),this._pipeline=a,this._graph.connect(b._pipeline),this},i.addListener=function(a){if(a instanceof b){var c=this,d=a;a=new e(this._graph),a.evaluate=function(a){return d._input=c._output,a},a.addListener(d._pipeline[0])}this._pipeline[this._pipeline.length-1].addListener(a)},i.removeListener=function(a){this._pipeline[this._pipeline.length-1].removeListener(a)},b}),e("dataflow/Signal",["require","exports","module","./Node","./changeset","../util/index"],function(a){function b(a,b,d){return c.prototype.init.call(this,a),this._name=b,this._value=d,this}var c=a("./Node"),d=a("./changeset"),e=(a("../util/index"),b.prototype=new c);return e.name=function(){return this._name},e.value=function(a){return arguments.length?(this._value=a,this):this._value},e.fire=function(a){a||(a=d.create(null,!0)),a.signals[this._name]=1,this._graph.propagate(a,this)},b}),e("dataflow/Graph",["require","exports","module","d3","./Datasource","./Signal","./changeset","../util/index","../util/constants"],function(a){function b(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}}function c(a){var b=this;return h.isArray(a)?a.map(function(a){b._signals[a]}):this._signals[a]}function d(a,b){var c,d,e,f;for(e=0,f=a.length;f>e;++e)c=a[e],c.collector()&&(d=c),b(c,d,e)}var e=a("d3"),f=a("./Datasource"),g=a("./Signal"),h=(a("./changeset"),a("../util/index")),i=a("../util/constants"),j=b.prototype;j.data=function(a,b,c){return 1===arguments.length?this._data[a]:this._data[a]=new f(this,a,c).pipeline(b)},j.signal=function(a,b){return 1===arguments.length?c.call(this,a):this._signals[a]=new g(this,a,b)},j.signalValues=function(a){var b=this;return h.isArray(a)?a.reduce(function(a,c){return a[c]=b._signals[c].value(),a},{}):this._signals[a].value()},j.signalRef=function(a){h.isArray(a)||(a=h.field(a));var b=this.signal(a.shift()).value();if(a.length>0){var c=Function("s","return s["+a.map(h.str).join("][")+"]");b=c.call(null,b)}return b};var k=e.bisector(function(a,b){return a.node==b.node?a.pulse.reflow?-1:1:b.rank-a.rank});return j.propagate=function(a,b){var c,d,e,f,g,i,j,l=[];if(l.enq=function(a){var b=k.left(this,a);this.splice(b,0,a)},a.stamp)throw"Pulse already has a non-zero stamp";for(a.stamp=++this._stamp,l.enq({node:b,pulse:a,rank:b.rank()});l.length>0;)if(c=l.pop(),e=c.node,f=c.pulse,g=c.rank,d=e._listeners,g==e.rank()){var m=f.reflow&&e.last()>=f.stamp;if(!m){var n=!!f.add.length||!!f.rem.length||e.router();if(n=n||!m,n=n||e.reevaluate(f),n&&(a=e.evaluate(f),e.last(a.stamp)),a!==this.doNotPropagate||!n)for(i=0,j=d.length;j>i;i++)l.enq({node:d[i],pulse:a,rank:d[i]._rank})}}else h.debug(f,["Rank mismatch",g,e.rank()]),l.enq({node:e,pulse:f,rank:e.rank()})},j.connect=function(a){h.debug({},["connecting"]);var b=this;return d(a,function(c,d,e){var f=c.dependency(i.DATA),g=c.dependency(i.SIGNALS);f.length>0&&f.forEach(function(a){var e=b.data(a);e.addListener(d),e._needsPrev=e._needsPrev||c.prev()}),g.length>0&&g.forEach(function(a){b.signal(a).addListener(d)}),e>0&&a[e-1].addListener(a[e])}),a},j.disconnect=function(a){h.debug({},["disconnecting"]);var b=this;return d(a,function(a,c){var d=a.dependency(i.DATA),e=a.dependency(i.SIGNALS);d.length>0&&d.forEach(function(a){b.data(a).removeListener(c)}),e.length>0&&e.forEach(function(a){b.signal(a).removeListener(c)}),a.disconnect()}),a},b}),e("scene/Encoder",["require","exports","module","../dataflow/Node","../util/index","../util/constants"],function(a){function b(a,b){var c=b.def.properties||{},e=c.update;return d.prototype.init.call(this,a.graph),this._model=a,this._mark=b,e&&(this.dependency(f.DATA,e.data),this.dependency(f.SCALES,e.scales),this.dependency(f.SIGNALS,e.signals)),this}function c(a,b,c){var d=this._model,e=a.encode,f=this._graph.signalValues(a.signals||[]),g=(a.data||[]).reduce(function(a,b){return a[b]=d.data(b).values(),a},{});e.call(e,b,b.mark.group||b,c,g,f,d.predicates())}var d=a("../dataflow/Node"),e=a("../util/index"),f=a("../util/constants"),g={},h=b.prototype=new d;return h.evaluate=function(a){e.debug(a,["encoding",this._mark.def.type]);var b,d,h=this._mark.items,i=this._mark.def.properties||{},j=i.enter,k=i.update,l=i.exit;for(b=0;b<h.length;++b)d=h[b],d.status===f.ENTER&&(j&&c.call(this,j,d,a.trans,a.stamp),d.status=f.UPDATE),d.status!==f.EXIT&&k&&c.call(this,k,d,a.trans,a.stamp),d.status===f.EXIT&&(l&&c.call(this,l,d,a.trans,a.stamp),a.trans&&!l?a.trans.interpolate(d,g):a.trans||h[b--].remove());return a},b}),e("core/Bounds",["require","exports","module"],function(){var a=function(a){this.clear(),a&&this.union(a)},b=a.prototype;return b.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},b.set=function(a,b,c,d){return this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},b.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},b.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},b.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},b.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},b.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this.x1,i=this.x2,j=this.y1,k=this.y2;return this.clear().add(d*h-e*j+f,e*h+d*j+g).add(d*h-e*k+f,e*h+d*k+g).add(d*i-e*j+f,e*i+d*j+g).add(d*i-e*k+f,e*i+d*k+g)},b.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},b.encloses=function(a){return a&&this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2},b.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},b.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},b.width=function(){return this.x2-this.x1},b.height=function(){return this.y2-this.y1},a}),e("render/canvas/path",["require","exports","module","d3","../../core/Bounds"],function(a){function b(a){var b,c,d,e=[];a=a.slice().replace(o[0],"###$1").split(o[1]).slice(1);for(var f,g,h=0,i=a.length;i>h;h++){b=a[h],c=b.slice(1).trim().replace(o[2],"$1###-").split(o[3]),g=[b.charAt(0)];for(var f=0,j=c.length;j>f;f++)d=parseFloat(c[f]),isNaN(d)||g.push(d);var k=g[0].toLowerCase(),l=n[k];if(g.length-1>l)for(var m=1,p=g.length;p>m;m+=l)e.push([g[0]].concat(g.slice(m,m+l)));else e.push(g)}return e}function c(a,b,c,d,g,h,i){for(var j=d[0],k=d[1],l=d[2],m=d[3],n=d[4],o=d[5],p=d[6],q=e(o,p,j,k,m,n,l,b,c),r=0;r<q.length;r++){var s=f.apply(null,q[r]);a.bezierCurveTo.apply(a,s),g.add(s[0]-h,s[1]-i),g.add(s[2]-h,s[3]-i),g.add(s[4]-h,s[5]-i)}}function d(a,b,c,d){for(var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=e(l,m,g,h,j,k,i,a,b),o=0;o<n.length;o++){var p=f.apply(null,n[o]);d.add(p[0],p[1]),d.add(p[2],p[3]),d.add(p[4],p[5])}}function e(a,b,c,d,e,f,g,h,i){if(k=r.call(arguments),p[k])return p[k];var j=g*(Math.PI/180),l=Math.sin(j),m=Math.cos(j);c=Math.abs(c),d=Math.abs(d);var n=m*(h-a)*.5+l*(i-b)*.5,o=m*(i-b)*.5-l*(h-a)*.5,q=n*n/(c*c)+o*o/(d*d);q>1&&(q=Math.sqrt(q),c*=q,d*=q);var s=m/c,t=l/c,u=-l/d,v=m/d,w=s*h+t*i,x=u*h+v*i,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;0>B&&(B=0);var C=Math.sqrt(B);f==e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1==f?H+=2*Math.PI:H>0&&0==f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,l,m]}return p[k]=J}function f(a,b,c,d,e,f,g,h){if(k=r.call(arguments),q[k])return q[k];var i=h*e,j=-g*f,l=g*e,m=h*f,n=Math.cos(c),o=Math.sin(c),p=Math.cos(d),s=Math.sin(d),t=.5*(d-c),u=Math.sin(.5*t),v=8/3*u*u/Math.sin(t),w=a+n-v*o,x=b+o+v*n,y=a+p,z=b+s,A=y+v*s,B=z-v*p;return q[k]=[i*w+j*x,l*w+m*x,i*A+j*B,l*A+m*B,i*y+j*z,l*y+m*z]}function g(a,b,d,e){var f,g,h,i,j,k=null,l=0,n=0,o=0,p=0,q=new m;void 0==d&&(d=0),void 0==e&&(e=0),a.beginPath();for(var r=0,s=b.length;s>r;++r){switch(f=b[r],f[0]){case"l":l+=f[1],n+=f[2],a.lineTo(l+d,n+e),q.add(l,n);break;case"L":l=f[1],n=f[2],a.lineTo(l+d,n+e),q.add(l,n);break;case"h":l+=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"H":l=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"v":n+=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"V":n=f[1],a.lineTo(l+d,n+e),q.add(l,n);break;case"m":l+=f[1],n+=f[2],a.moveTo(l+d,n+e),q.add(l,n);break;case"M":l=f[1],n=f[2],a.moveTo(l+d,n+e),q.add(l,n);break;case"c":g=l+f[5],h=n+f[6],o=l+f[3],p=n+f[4],a.bezierCurveTo(l+f[1]+d,n+f[2]+e,o+d,p+e,g+d,h+e),q.add(l+f[1],n+f[2]),q.add(o,p),q.add(g,h),l=g,n=h;break;case"C":l=f[5],n=f[6],o=f[3],p=f[4],a.bezierCurveTo(f[1]+d,f[2]+e,o+d,p+e,l+d,n+e),q.add(f[1],f[2]),q.add(o,p),q.add(l,n);break;case"s":g=l+f[3],h=n+f[4],o=2*l-o,p=2*n-p,a.bezierCurveTo(o+d,p+e,l+f[1]+d,n+f[2]+e,g+d,h+e),q.add(o,p),q.add(l+f[1],n+f[2]),q.add(g,h),o=l+f[1],p=n+f[2],l=g,n=h;break;case"S":g=f[3],h=f[4],o=2*l-o,p=2*n-p,a.bezierCurveTo(o+d,p+e,f[1]+d,f[2]+e,g+d,h+e),l=g,n=h,q.add(f[1],f[2]),q.add(o,p),q.add(g,h),o=f[1],p=f[2];break;case"q":g=l+f[3],h=n+f[4],o=l+f[1],p=n+f[2],a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,q.add(o,p),q.add(g,h);break;case"Q":g=f[3],h=f[4],a.quadraticCurveTo(f[1]+d,f[2]+e,g+d,h+e),l=g,n=h,o=f[1],p=f[2],q.add(o,p),q.add(g,h);break;case"t":g=l+f[1],h=n+f[2],null===k[0].match(/[QqTt]/)?(o=l,p=n):"t"===k[0]?(o=2*l-i,p=2*n-j):"q"===k[0]&&(o=2*l-o,p=2*n-p),i=o,j=p,a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,o=l+f[1],p=n+f[2],q.add(o,p),q.add(g,h);break;case"T":g=f[1],h=f[2],o=2*l-o,p=2*n-p,a.quadraticCurveTo(o+d,p+e,g+d,h+e),l=g,n=h,q.add(o,p),q.add(g,h);break;case"a":c(a,l+d,n+e,[f[1],f[2],f[3],f[4],f[5],f[6]+l+d,f[7]+n+e],q,d,e),l+=f[6],n+=f[7];break;case"A":c(a,l+d,n+e,[f[1],f[2],f[3],f[4],f[5],f[6]+d,f[7]+e],q,d,e),l=f[6],n=f[7];break;case"z":case"Z":a.closePath()}k=f}return q.translate(d,e)}function h(a,b){for(var c,e,f,g,h,i=null,j=0,k=0,l=0,m=0,n=0,o=a.length;o>n;++n){switch(c=a[n],c[0]){case"l":j+=c[1],k+=c[2],b.add(j,k);break;case"L":j=c[1],k=c[2],b.add(j,k);break;case"h":j+=c[1],b.add(j,k);break;case"H":j=c[1],b.add(j,k);break;case"v":k+=c[1],b.add(j,k);break;case"V":k=c[1],b.add(j,k);break;case"m":j+=c[1],k+=c[2],b.add(j,k);break;case"M":j=c[1],k=c[2],b.add(j,k);break;case"c":e=j+c[5],f=k+c[6],l=j+c[3],m=k+c[4],b.add(j+c[1],k+c[2]),b.add(l,m),b.add(e,f),j=e,k=f;break;case"C":j=c[5],k=c[6],l=c[3],m=c[4],b.add(c[1],c[2]),b.add(l,m),b.add(j,k);break;case"s":e=j+c[3],f=k+c[4],l=2*j-l,m=2*k-m,b.add(l,m),b.add(j+c[1],k+c[2]),b.add(e,f),l=j+c[1],m=k+c[2],j=e,k=f;break;case"S":e=c[3],f=c[4],l=2*j-l,m=2*k-m,j=e,k=f,b.add(c[1],c[2]),b.add(l,m),b.add(e,f),l=c[1],m=c[2];break;case"q":e=j+c[3],f=k+c[4],l=j+c[1],m=k+c[2],j=e,k=f,b.add(l,m),b.add(e,f);break;case"Q":e=c[3],f=c[4],j=e,k=f,l=c[1],m=c[2],b.add(l,m),b.add(e,f);break;case"t":e=j+c[1],f=k+c[2],null===i[0].match(/[QqTt]/)?(l=j,m=k):"t"===i[0]?(l=2*j-g,m=2*k-h):"q"===i[0]&&(l=2*j-l,m=2*k-m),g=l,h=m,j=e,k=f,l=j+c[1],m=k+c[2],b.add(l,m),b.add(e,f);break;case"T":e=c[1],f=c[2],l=2*j-l,m=2*k-m,j=e,k=f,b.add(l,m),b.add(e,f);break;case"a":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6]+j,c[7]+k],b),j+=c[6],k+=c[7];break;case"A":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6],c[7]],b),j=c[6],k=c[7];break;case"z":case"Z":}i=c}return b}function i(a){var b=a[0],c=l.svg.area().x(function(a){return a.x}).y1(function(a){return a.y}).y0(function(a){return a.y+a.height});return b.interpolate&&c.interpolate(b.interpolate),null!=b.tension&&c.tension(b.tension),c(a)}function j(a){var b=a[0],c=l.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return b.interpolate&&c.interpolate(b.interpolate),null!=b.tension&&c.tension(b.tension),c(a)}var k,l=a("d3"),m=a("../../core/Bounds"),n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},o=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],p={},q={},r=Array.prototype.join;return{parse:b,render:g,bounds:h,area:i,line:j}}),e("util/bounds",["require","exports","module","../core/Bounds","../render/canvas/path","./index","./config"],function(b){function c(){return B||(B=a.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node().getContext("2d"))}function d(a,b,c){return null==b?c.set(0,0,0,0):(v(b,c),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&c.expand(a.strokeWidth)),c}function e(a,b){var c=a.path?a.pathCache||(a.pathCache=u(a.path)):null;return d(a,c,b)}function f(a,b){var c=a.mark.items,a=c[0],e=a.pathCache||(a.pathCache=u(w(c)));return d(c[0],e,b)}function g(a,b){var c=a.mark.items,a=c[0],e=a.pathCache||(a.pathCache=u(x(c)));return d(c[0],e,b)}function h(a,b){var c=a.x||0,d=a.y||0,e=c+a.width||0,f=d+a.height||0;return b.set(c,d,e,f),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function i(a,b){var c=a.width||0,d=a.height||0,e=(a.x||0)-("center"===a.align?c/2:"right"===a.align?c:0),f=(a.y||0)-("middle"===a.baseline?d/2:"bottom"===a.baseline?d:0);return b.set(e,f,e+c,f+d)}function j(a,b){var c,d;return b.set(c=a.x||0,d=a.y||0,null!=a.x2?a.x2:c,null!=a.y2?a.y2:d),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function k(a,b){var c,d,e,f,g,h,i,j,k,l=a.x||0,m=a.y||0,n=a.innerRadius||0,o=a.outerRadius||0,p=(a.startAngle||0)-y,q=(a.endAngle||0)-y,r=1/0,s=-1/0,t=1/0,u=-1/0,v=[p,q],w=p-p%y;for(d=0;4>d&&q>w;++d,w+=y)v.push(w);for(d=0,e=v.length;e>d;++d)c=v[d],f=Math.cos(c),h=n*f,j=o*f,g=Math.sin(c),i=n*g,k=o*g,r=Math.min(r,h,j),s=Math.max(s,h,j),t=Math.min(t,i,k),u=Math.max(u,i,k);return b.set(l+r,m+t,l+s,m+u),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function l(a,b){var c,d,e,f,g=null!=a.size?a.size:100,h=a.x||0,i=a.y||0;switch(a.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,b.set(h-d,i-c,h+d,i+c);break;case"diamond":f=Math.sqrt(g/(2*A)),e=f*A,b.set(h-e,i-f,h+e,i+f);break;case"square":d=Math.sqrt(g),c=d/2,b.set(h-c,i-c,h+c,i+c);break;case"triangle-down":e=Math.sqrt(g/z),f=e*z/2,b.set(h-e,i-f,h+e,i+f);break;case"triangle-up":e=Math.sqrt(g/z),f=e*z/2,b.set(h-e,i-f,h+e,i+f);break;default:c=Math.sqrt(g/Math.PI),b.set(h-c,i-c,h+c,i+c)}return a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function m(a,b,d){var e,f,g=(a.x||0)+(a.dx||0),h=(a.y||0)+(a.dy||0),i=a.fontSize||t.render.fontSize,j=a.align,k=a.baseline,l=a.radius||0,m=c();return m.font=s.fontString(a),m.textAlign=j||"left",m.textBaseline=k||"alphabetic",e=m.measureText(a.text||"").width,l&&(f=(a.theta||0)-Math.PI/2,g+=l*Math.cos(f),h+=l*Math.sin(f)),"center"===j?g-=e/2:"right"===j&&(g-=e),"top"===k?h+=i/5:"bottom"===k?h-=i:"middle"===k?h=h-i/2+i/10:h-=4*i/5,b.set(g,h,g+e,h+i),a.angle&&!d&&b.rotate(a.angle*Math.PI/180,a.x||0,a.y||0),b.expand(d?0:1)}function n(a,b,c){var d,e,f=a.axisItems||[],g=a.legendItems||[];for(d=0,e=f.length;e>d;++d)b.union(f[d].bounds);for(d=0,e=a.items.length;e>d;++d)b.union(a.items[d].bounds);if(c){for(d=0,e=g.length;e>d;++d)b.union(g[d].bounds);null!=a.width&&null!=a.height&&b.add(a.width,a.height),null!=a.x&&null!=a.y&&b.add(0,0)}return b.translate(a.x||0,a.y||0),b}function o(a,b,c){b=b||C[a.mark.marktype],a.bounds_prev||(a["bounds:prev"]=new q);var d=a.bounds,e=a["bounds:prev"];return d&&e.clear().union(d),a.bounds=b(a,d?d.clear():new q,c),d||e.clear().union(a.bounds),a.bounds}function p(a,b,c){b=b||a.bounds&&a.bounds.clear()||new q;var d,e,f=a.marktype,g=C[f],h=a.items;if("area"===f||"line"===f)h.length&&(h[0].bounds=g(h[0],b));else for(d=0,e=h.length;e>d;++d)b.union(o(h[d],g,c));a.bounds=b}var q=b("../core/Bounds"),r=b("../render/canvas/path"),s=b("./index"),t=b("./config"),u=r.parse,v=r.bounds,w=r.area,x=r.line,y=Math.PI/2,z=Math.sqrt(3),A=Math.tan(30*Math.PI/180),B=null,C={group:n,symbol:l,image:i,rect:h,rule:j,arc:k,text:m,path:e,area:f,line:g};return{mark:p,item:o,text:m,group:n}}),e("scene/Bounder",["require","exports","module","../dataflow/Node","../util/bounds","../util/constants","../util/index"],function(a){function b(a,b){return this._mark=b,c.prototype.init.call(this,a.graph)}var c=a("../dataflow/Node"),d=a("../util/bounds"),e=a("../util/constants"),f=a("../util/index"),g=b.prototype=new c;return g.evaluate=function(a){return f.debug(a,["bounds",this._mark.marktype]),d.mark(this._mark),this._mark.marktype===e.GROUP&&d.mark(this._mark,null,!1),a.reflow=!0,a},b}),e("scene/Item",["require","exports","module"],function(){function a(a){this.mark=a}var b=a.prototype;return b.hasPropertySet=function(a){var b=this.mark.def.properties;return b&&null!=b[a]},b.cousin=function(a,b){if(0===a)return this;a=a||-1;var c=this.mark,d=c.group,e=null==b?c.items.indexOf(this):b,f=d.items.indexOf(c)+a;return d.items[f].items[e]},b.sibling=function(a){if(0===a)return this;a=a||-1;var b=this.mark,c=b.items.indexOf(this)+a;return b.items[c]},b.remove=function(){var a=this,b=a.mark.items,c=b.indexOf(a);return c>=0&&(c===b.length-1?b.pop():b.splice(c,1)),a},b.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},a}),e("parse/expr",["require","exports","module","../util/index"],function(a){function b(a,b){var g,h,i,j,k,l,m,n=b.split(f),o={},p={};for(k=0,l=0,i=0,j=n.length;j>i;++i){var g=n[i];"'"!==g?'"'!==g?l||k||(d[g]&&(n[i]=d[g]),e[g]&&(h=n[i+1])&&"("===h[0]&&(n[i]=e[g]),":"==n[i+1]&&(m=g+":"+n[i+2],a.signal((m=c.field(m))[0])&&(o[m[0]]=1,h=c.field(n[i+2]),n[i]="sg['"+n[i],n[i+2]=n[i+2].replace(h[0],h[0]+"']"),i+=2)),a.signal((h=c.field(g))[0])&&(o[h[0]]=1,n[i]=n[i].replace(h[0],"sg["+c.str(h[0])+"]")),"d"==h[0]&&(p[h.splice(1).join("")]=1)):k||(l=!l):l||(k=!k)
}return{fn:Function("d","e","i","p","sg","return ("+n.join("")+");"),signals:c.keys(o),fields:c.keys(p)}}var c=a("../util/index"),d={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},e={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",date:"Date.parse"},f=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return b.eval=function(a,b,d,e,f,g,h){return h=a.signalValues(c.array(h)),b.call(null,d,e,f,g,h)},b}),e("transforms/Parameter",["require","exports","module","../parse/expr","../util/index","../util/constants"],function(a){function b(a,b){this._name=a,this._type=b,this._stamp=0,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}var c=a("../parse/expr"),d=a("../util/index"),e=a("../util/constants"),f=/array/i,g=/data/i,h=/field/i,i=/expr/i,j=b.prototype;return j._get=function(){var a=f.test(this._type),b=g.test(this._type),c=h.test(this._type);return b?a?{names:this._value,sources:this._accessors}:{name:this._value[0],source:this._accessors[0]}:c?a?{fields:this._value,accessors:this._accessors}:{field:this._value[0],accessor:this._accessors[0]}:a?this._value:this._value[0]},j.get=function(a){var b,c,e,f,i,j=g.test(this._type),k=h.test(this._type);if(!this._resolution)return this._get();if(j)return this._accessors=this._value.map(function(b){return a.data(b)}),this._get();for(b in this._signals)e=this._signals[b],c=a.signal(b),f=c.value(),i=c.last(),k&&(this._accessors[e]=this._stamp<=i?d.accessor(f):this._accessors[e]),this._value[e]=f,this._stamp=Math.max(this._stamp,i);return this._get()},j.set=function(a,b){var f=this,j=i.test(this._type),k=g.test(this._type),l=h.test(this._type);return this._value=d.array(b).map(function(b,g){if(d.isString(b)){if(j){var h=c(a._graph,b);return a.dependency(e.FIELDS,h.fields),a.dependency(e.SIGNALS,h.signals),h.fn}return l?(f._accessors[g]=d.accessor(b),a.dependency(e.FIELDS,b)):k&&(f._resolution=!0,a.dependency(e.DATA,b)),b}return void 0!==b.value?b.value:void 0!==b.field?(f._accessors[g]=d.accessor(b.field),a.dependency(e.FIELDS,b.field),b.field):void 0!==b.signal?(f._resolution=!0,f._signals[b.signal]=g,a.dependency(e.SIGNALS,b.signal),b.signal):b}),a},b}),e("transforms/Transform",["require","exports","module","../dataflow/Node","./Parameter","../util/index","../util/constants"],function(a){function b(a){return a&&c.prototype.init.call(this,a),this}var c=a("../dataflow/Node"),d=a("./Parameter"),e=(a("../util/index"),a("../util/constants"));b.addParameters=function(a,b){var c;for(var e in b)c=b[e],a[e]=new d(e,c.type),c["default"]&&a[e].set(c["default"])};var f=b.prototype=new c;return f.clone=function(){var a=c.prototype.clone.call(this);a.transform=this.transform;for(var b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},f.transform=function(a){return a},f.evaluate=function(a){var b=this.dependency(e.SIGNALS).some(function(b){return!!a.signals[b]});return this.transform(a,b)},f.output=function(a){for(var b in this._output)void 0!==a[b]&&(this._output[b]=a[b]);return this},b}),e("util/quickselect",[],function(){return function(a,b){function c(a,c){var d=b[a];b[a]=b[c],b[c]=d}for(var d,e,f,g=0,h=b.length-1;h>g;){for(f=b[a],c(a,h),e=d=g;h>e;++e)b[e]<f&&c(e,d++);if(c(h,d),d===a)break;a>d?g=d+1:h=d-1}return b[a]}}),e("transforms/measures",["require","exports","module","../dataflow/tuple","../util/quickselect"],function(a){function b(a){return function(b){var c=Object.create(a);return c.out=b||a.name,c.idx||(c.idx=0),c}}function c(a){function b(a,c){return(c.req||[]).forEach(function(c){a[c]||b(a,a[c]=h[c]())}),a}var c=a.reduce(b,a.reduce(function(a,b){return a[b.name]=b,a},{})),d=[];for(var e in c)d.push(c[e]);return d.sort(function(a,b){return a.idx-b.idx}),d}function d(a){var b=c(a),d="this.flag = this.ADD; this.tuple = t;",h="",i="",j="var t = this.tuple;";return b.forEach(function(a){d+=a.init,h+=a.add,i+=a.rem}),a.forEach(function(a){j+="this.tpl.set(t,'"+a.out+"',"+a.set+");"}),h+="this.flag |= this.MOD;",i+="this.flag |= this.MOD;",j+="return t;",d=Function("t",d),d.prototype.ADD=1,d.prototype.MOD=2,d.prototype.add=Function("v",h),d.prototype.rem=Function("v",i),d.prototype.set=Function("stamp",j),d.prototype.mod=e,d.prototype.tpl=f,d.prototype.sel=g,d}function e(a,b){void 0!==b&&b!==a&&(this.rem(b),this.add(a))}var f=a("../dataflow/tuple"),g=a("../util/quickselect"),h={count:b({name:"count",init:"this.cnt = 0;",add:"this.cnt += 1;",rem:"this.cnt -= 1;",set:"this.cnt"}),sum:b({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),avg:b({name:"avg",init:"this.avg = 0;",add:"var d = v - this.avg; this.avg += d / this.cnt;",rem:"var d = v - this.avg; this.avg -= d / this.cnt;",set:"this.avg",req:["count"],idx:1}),"var":b({name:"var",init:"this.dev = 0;",add:"this.dev += d * (v - this.avg);",rem:"this.dev -= d * (v - this.avg);",set:"this.dev / (this.cnt-1)",req:["avg"],idx:2}),varp:b({name:"varp",init:"",add:"",rem:"",set:"this.dev / this.cnt",req:["var"],idx:3}),stdev:b({name:"stdev",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / (this.cnt-1))",req:["var"],idx:4}),stdevp:b({name:"stdevp",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / this.cnt)",req:["var"],idx:5}),median:b({name:"median",init:"this.val = [];",add:"this.val.push(v);",rem:"this.val[this.val.indexOf(v)] = this.val[this.val.length-1];this.val.length = this.val.length - 1;",set:"this.sel(~~(this.cnt/2), this.val)",req:["count"],idx:6}),min:b({name:"min",init:"",add:"",rem:"",set:"this.sel(0, this.val)",req:["median"]}),max:b({name:"max",init:"",add:"",rem:"",set:"this.sel(this.val.length-1, this.val)",req:["median"]})};return h.create=d,h}),e("transforms/Aggregate",["require","exports","module","./Transform","../dataflow/tuple","../dataflow/changeset","./measures","../util/index"],function(a){function b(a){return e.prototype.init.call(this,a),e.addParameters(this,{on:{type:"field"}}),this._output={count:"count",avg:"avg",min:"min",max:"max",sum:"sum",mean:"mean","var":"var",stdev:"stdev",varp:"varp",stdevp:"stdevp",median:"median"},this._Measures=null,this._cache={},this.prev(!0)}function c(a,b){for(var c in this._cache)a.facet||b.rem.push(this._cache[c].set(a.stamp)),this._cache[c]=null}function d(a){var b,c=a.facet?a.facet.key:"",d=this._cache[c];return d||(b=a.facet||f.create(null,null),this._cache[c]=d=new this._Measures(b)),d}var e=a("./Transform"),f=a("../dataflow/tuple"),g=a("../dataflow/changeset"),h=a("./measures"),i=a("../util/index"),j=b.prototype=new e;return j.stats={set:function(a,b){return a._Measures=h.create(b.map(function(b){return h[b](a._output[b])})),a}},j.transform=function(a,b){i.debug(a,["aggregating"]);var e,f,h=a.facet?a.facet.key:"",j=a.facet?a:g.create(),k=this.on.get().accessor;return b&&c.call(this,a,j),e=d.call(this,a),a.add.forEach(function(a){e.add(k(a))}),a.mod.forEach(function(a){var b;a._prev&&void 0!==(b=k(a._prev))&&e.mod(k(a),b)}),a.rem.forEach(function(a){var b;e.rem(a._prev&&void 0!==(b=k(a._prev))?b:k(a))}),f=e.set(a.stamp),a.facet?a:(0===e.cnt?(e.flag===e.MOD&&j.rem.push(f),this._cache[h]=null):e.flag&e.ADD?j.add.push(f):e.flag&e.MOD&&j.mod.push(f),e.flag=0,j)},b}),e("util/bins",["require","exports","module"],function(){function a(a,b){for(var c=0,d=a.length;d>c;){var e=c+d>>>1;a[e]<b?c=e+1:d=e}return c}function b(b){b=b||{};var c,d,e,f,g=b.maxbins||1024,h=b.base||10,i=b.div||[5,2],j=b.minstep||0,k=Math.log(h),l=Math.ceil(Math.log(g)/k),m=b.min,n=b.max,o=n-m,p=Math.max(j,Math.pow(h,Math.round(Math.log(o)/k)-l)),q=Math.ceil(o/p);if(null!=b.step)p=b.step;else if(b.steps)e=a(b.steps,o/g),e===b.steps.length&&--e,p=b.steps[e];else{do p*=h,q=Math.ceil(o/p);while(q>g);for(e=0;e<i.length;++e)d=p/i[e],d>=j&&g>=o/d&&(p=d,q=Math.ceil(o/p))}return d=Math.log(p),c=d>=0?0:~~(-d/k)+1,f=(0>m?-1:1)*Math.pow(h,-c-1),m=Math.min(m,Math.floor(m/p+f)*p),n=Math.ceil(n/p)*p,{start:m,stop:n,step:p,unit:c}}return b}),e("transforms/Bin",["require","exports","module","./Transform","../util/index","../util/bins","../dataflow/tuple"],function(a){function b(a){return c.prototype.init.call(this,a),c.addParameters(this,{on:{type:"field"},min:{type:"value"},max:{type:"value"},step:{type:"value"},maxbins:{type:"value","default":20}}),this._output={bin:"bin"},this}var c=a("./Transform"),d=(a("../util/index"),a("../util/bins")),e=a("../dataflow/tuple"),f=b.prototype=new c;return f.transform=function(a){function b(b){var d=c.on.get().accessor(b);d=null==d?null:g.start+g.step*~~((d-g.start)/g.step),e.set(b,f,d,a.stamp)}var c=this,f=this._output.bin,g=d({min:this.min.get(),max:this.max.get(),step:this.step.get(),maxbins:this.maxbins.get()});return a.add.forEach(b),a.mod.forEach(b),a.rem.forEach(b),a},b}),e("transforms/Facet",["require","exports","module","./Transform","../dataflow/tuple","../dataflow/changeset","../util/index"],function(a){function b(a){return e.prototype.init.call(this,a),e.addParameters(this,{keys:{type:"array<field>"}}),this._cells={},this._pipeline=[],this.router(!0).prev(!0)}function c(a,b){var c,d;for(c in this._cells)d=this._cells[c],b.rem.push(d.t),d["delete"]()}function d(a,b){var c=this,d=this.keys.get(this._graph).accessors,e=d.reduce(function(c,d){var e=null;return b&&a._prev&&void 0!==(e=d(a._prev))?(c.push(e),c):(c.push(d(a)),c)},[]),g=e.join("|");if(this._cells[g])return this._cells[g];var j=this._pipeline.map(function(a){return a.clone()}),b=void 0!==a._prev?null:void 0,k=f.create({keys:e,key:g},b),l=this._graph.data("vg_"+k._id,j,k);this.addListener(j[0]);var m=function(){h.debug({},["deleting cell",g]),c.removeListener(j[0]),c._graph.disconnect(j),delete c._cells[g]};return this._cells[g]={t:k,s:i,ds:l,"delete":m,count:0}}var e=a("./Transform"),f=a("../dataflow/tuple"),g=a("../dataflow/changeset"),h=a("../util/index"),i=1,j=2,k=b.prototype=new e;return k.pipeline=function(a){return arguments.length?(this._pipeline=a,this):this._pipeline},k.transform=function(a,b){h.debug(a,["faceting"]);var e,f,k,l=this,m=g.create(a);b&&c.call(this,a,m),a.add.forEach(function(a){var b=d.call(l,a);b.count+=1,b.s|=j,b.ds._input.add.push(a)}),a.mod.forEach(function(a){var b=d.call(l,a),c=d.call(l,a,!0);b!==c&&(c.count-=1,c.s|=j,c.ds._input.rem.push(a)),b.s&i?(b.count+=1,b.ds._input.add.push(a)):b.ds._input.mod.push(a),b.s|=j}),a.rem.forEach(function(a){var b=d.call(l,a);b.count-=1,b.s|=j,b.ds._input.rem.push(a)});for(e in this._cells)f=this._cells[e],k=f.t,g.copy(a,f.ds._input),0===f.count?(f.s===j&&m.rem.push(k),f["delete"]()):f.s&i?m.add.push(k):f.s&j&&m.mod.push(k),f.s=0;return m},b}),e("transforms/Filter",["require","exports","module","./Transform","../dataflow/changeset","../parse/expr","../util/index","../util/constants"],function(a){function b(a){return d.prototype.init.call(this,a),d.addParameters(this,{test:{type:"expr"}}),this._skip={},this}function c(a){return f.eval(this._graph,this.test.get(this._graph),a,null,null,null,this.dependency(h.SIGNALS))}var d=a("./Transform"),e=a("../dataflow/changeset"),f=a("../parse/expr"),g=a("../util/index"),h=a("../util/constants"),i=b.prototype=new d;return i.transform=function(a){g.debug(a,["filtering"]);var b=e.create(a),d=this._skip,f=this;return a.rem.forEach(function(a){1!==d[a._id]?b.rem.push(a):d[a._id]=0}),a.add.forEach(function(a){c.call(f,a)?b.add.push(a):d[a._id]=1}),a.mod.forEach(function(a){var e=c.call(f,a),g=1===d[a._id];e&&g?(d[a._id]=0,b.add.push(a)):e&&!g?b.mod.push(a):!e&&g||(b.rem.push(a),d[a._id]=1)}),b},b}),e("transforms/Fold",["require","exports","module","./Transform","../util/index","../dataflow/tuple","../dataflow/changeset"],function(a){function b(a){return f.prototype.init.call(this,a),f.addParameters(this,{on:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).prev(!0)}function c(a,b){for(var c in this._cache)b.rem.push.apply(b.rem,this._cache[c]);this._cache={}}function d(a,b,c){var d=this._cache[a._id]||(this._cache[a._id]=Array(c));return d[b]||(d[b]=h.create(a,a._prev))}function e(a,b,c,e){for(var f,g,i,j=0,k=a.length,l=b.length;k>j;++j)for(g=a[j],f=0;l>f;++f)i=d.call(this,g,f,l),h.set(i,this._output.key,b[f]),h.set(i,this._output.value,c[f](g)),e.push(i)}var f=a("./Transform"),g=a("../util/index"),h=a("../dataflow/tuple"),i=a("../dataflow/changeset"),j=b.prototype=new f;return j.transform=function(a,b){g.debug(a,["folding"]);var d=this,f=this.on.get(this._graph),h=f.fields,j=f.accessors,k=i.create(a);return b&&c.call(this,a,k),e.call(this,a.add,h,j,k.add,a.stamp),e.call(this,a.mod,h,j,k.mod,a.stamp),a.rem.forEach(function(a){k.rem.push.apply(k.rem,d._cache[a._id]),d._cache[a._id]=null}),(a.add.length||a.rem.length||h.some(function(b){return!!a.fields[b]}))&&(k.fields[this._output.key]=1,k.fields[this._output.value]=1),k},b}),e("transforms/Formula",["require","exports","module","./Transform","../dataflow/tuple","../parse/expr","../util/index","../util/constants"],function(a){function b(a){return d.prototype.init.call(this,a),d.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this}function c(a,b){var c=f.eval(this._graph,this.expr.get(this._graph),a,null,null,null,this.dependency(h.SIGNALS));e.set(a,b,c)}var d=a("./Transform"),e=a("../dataflow/tuple"),f=a("../parse/expr"),g=a("../util/index"),h=a("../util/constants"),i=b.prototype=new d;return i.transform=function(a){g.debug(a,["formulating"]);var b=this,d=this.field.get(this._graph);return a.add.forEach(function(e){c.call(b,e,d,a.stamp)}),a.mod.forEach(function(e){c.call(b,e,d,a.stamp)}),a.fields[d]=1,a},b}),e("transforms/Sort",["require","exports","module","./Transform","../parse/expr","../util/index"],function(a){function b(a){return c.prototype.init.call(this,a),c.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var c=a("./Transform"),d=(a("../parse/expr"),a("../util/index")),e=b.prototype=new c;return e.transform=function(a){return d.debug(a,["sorting"]),(a.add.length||a.mod.length||a.rem.length)&&(a.sort=d.comparator(this.by.get(this._graph).fields)),a},b}),e("transforms/Unique",["require","exports","module","d3","./Transform","../dataflow/changeset","../dataflow/tuple","../util/index","../util/constants"],function(a){function b(a){return f.prototype.init.call(this,a),f.addParameters(this,{on:{type:"field"},as:{type:"value"}}),this._cache={},this.router(!0).prev(!0)}function c(a,b){var c;for(var c in this._cache)b.rem.push(this._cache[c].tuple);this._cache={}}function d(a,b,c){var d,e;void 0===(d=b[a])?(e={},e[c]=a,b[a]={count:1,tuple:h.create(e,null),state:j}):(d.count+=1,d.state|=k)}function e(a,b){var c=b[a];c.count-=1,c.state|=k}var f=(a("d3"),a("./Transform")),g=a("../dataflow/changeset"),h=a("../dataflow/tuple"),i=a("../util/index"),j=(a("../util/constants"),1),k=2,l=b.prototype=new f;return l.transform=function(a,b){i.debug(a,["uniques"]);var f,h,l,m=g.create(a),n=this.on.get(this._graph),o=n.accessor,p=this.as.get(this._graph),q=this._cache;b&&c.call(this,a,m),a.add.forEach(function(a){d(o(a),q,p)}),a.mod.forEach(function(a){var b,c=o(a);a._prev&&void 0!==(b=o(a._prev))&&c!==b&&e(b,q),d(c,q,p)}),a.rem.forEach(function(a){var b;a._prev&&void 0!==(b=o(a._prev))?e(b,q):e(o(a),q)});for(var f in q)h=q[f],l=h.tuple,0===h.count?(h.state===k&&m.rem.push(l),delete q[f]):h.state&j?m.add.push(l):h.state&k&&m.mod.push(l),h.state=0;return m},b}),e("transforms/Zip",["require","exports","module","./Transform","../dataflow/Collector","../util/index"],function(a){function b(a){return d.prototype.init.call(this,a),d.addParameters(this,{"with":{type:"data"},as:{type:"value"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"value"}}),this._map={},this._collector=new e(a),this._lastJoin=0,this.prev(!0)}function c(a){return this._map[a]||(this._map[a]=[])}var d=a("./Transform"),e=a("../dataflow/Collector"),f=a("../util/index"),g=b.prototype=new d;return g.transform=function(a){var b=this["with"].get(this._graph),d=b.source,e=d.last(),g=d.values(),h=this.key.get(this._graph),i=this.withKey.get(this._graph),j=this.as.get(this._graph),k=this["default"].get(this._graph),l=c.bind(this);if(f.debug(a,["zipping",b.name]),i.field)e&&e.stamp>this._lastJoin&&(e.add.forEach(function(a){var b=l(i.accessor(a));b[0]&&(b[0][j]=a),b[1]=a}),e.rem.forEach(function(a){var b=l(i.accessor(a));b[0]&&(b[0][j]=k),b[1]=null}),e.fields[i.field]&&e.mod.forEach(function(a){var b;if(a._prev&&void 0!==(b=i.accessor(a._prev))){var c=l(b);c[0]&&(c[0][j]=k),c[1]=null;var d=l(i.accessor(a));d[0]&&(d[0][j]=a),d[1]=a}}),this._lastJoin=e.stamp),a.add.forEach(function(a){var b=l(h.accessor(a));a[j]=b[1]||k,b[0]=a}),a.rem.forEach(function(a){l(h.accessor(a))[0]=null}),a.fields[h.field]&&a.mod.forEach(function(a){var b;if(a._prev&&void 0!==(b=h.accessor(a._prev))){l(b)[0]=null;var c=l(h.accessor(a));a[j]=c[1]||k,c[0]=a}});else{if(0==a.add.length&&0==a.rem.length&&0==e.add.length&&0==e.rem.length)return a;this._collector.evaluate(a);var m,n=this._collector.data(),o=g.length;for(m=0;m<n.length;m++)n[m][j]=g[m%o]}return a},b}),e("transforms/index",["require","exports","module","./Aggregate","./Bin","./Facet","./Filter","./Fold","./Formula","./Sort","./Unique","./Zip"],function(a){return{aggregate:a("./Aggregate"),bin:a("./Bin"),facet:a("./Facet"),filter:a("./Filter"),fold:a("./Fold"),formula:a("./Formula"),sort:a("./Sort"),unique:a("./Unique"),zip:a("./Zip")}}),e("parse/transforms",["require","exports","module","../util/index","../transforms/index"],function(a){var b=a("../util/index"),c=a("../transforms/index");return function d(a,e){var f=new c[e.type](a.graph);if("facet"==e.type){var g=(e.transform||[]).map(function(b){return d(a,b)});f.pipeline(g)}return e.output&&f.output(e.output),b.keys(e).forEach(function(a){"type"!==a&&"output"!==a&&("transform"!==a||"facet"!==e.type)&&f[a].set(f,e[a])}),f}}),e("parse/modify",["require","exports","module","../dataflow/Node","../dataflow/tuple","../util/index","../util/constants"],function(a){var b=a("../dataflow/Node"),c=a("../dataflow/tuple"),d=a("../util/index"),e=a("../util/constants"),f=function(a,b,c,d){for(var e=c.length-1;e>=0;--e)c[e][a]==b&&d.push.apply(d,c.splice(e,1))};return function(a,g,h){var i=a.graph,j=g.signal?d.field(g.signal):null,k=j?j[0]:null,l=g.predicate?a.predicate(g.predicate):null,m=null===l,n=new b(i);return n.evaluate=function(b){if(null!==l){var k={};(l.data||[]).forEach(function(b){k[b]=a.data(b).values()}),m=l({},k,i.signalValues(l.signals||[]),a._predicates)}if(d.debug(b,[g.type+"ing",m]),!m)return b;var n={},o=j?i.signalRef(g.signal):null,p=a.data(h.name),q=p._needsPrev?null:void 0,r=null;if(n[g.field]=o,g.type==e.ADD)r=c.create(n,q),b.add.push(r),p._data.push(r);else if(g.type==e.REMOVE)f(g.field,o,b.add,b.rem),f(g.field,o,b.mod,b.rem),p._data=p._data.filter(function(a){return a[g.field]!==o});else if(g.type==e.TOGGLE){var s=[],t=[];f(g.field,o,b.rem,s),f(g.field,o,b.add,t),f(g.field,o,b.mod,t),0==s.length&&0==t.length&&s.push(c.create(n)),b.add.push.apply(b.add,s),p._data.push.apply(p._data,s),b.rem.push.apply(b.rem,t),p._data=p._data.filter(function(a){return-1===t.indexOf(a)})}else g.type==e.CLEAR&&(b.rem.push.apply(b.rem,b.add),b.rem.push.apply(b.rem,b.mod),b.add=[],b.mod=[],p._data=[]);return b.fields[g.field]=1,b},k&&n.dependency(e.SIGNALS,k),l&&n.dependency(e.SIGNALS,l.signals),n}}),e("util/load",["require","exports","module","./index","./config"],function(b){function c(a){return h.test(a)}function d(b,c){return f.log("LOAD: "+b),e(b)?void a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)}):void f.error("URL is not whitelisted: "+b)}function e(a){if(!g.domainWhiteList)return!0;var b=document.createElement("a");b.href=a;var c=b.hostname.toLowerCase();return g.domainWhiteList.some(function(a){return a===c||c.lastIndexOf("."+a)===c.length-a.length-1})}var f=b("./index"),g=b("./config"),h=/^[A-Za-z]+\:\/\//;return function(a,b){var e=c(a)?a:g.baseURL+a;d(e,b)}}),e("util/read",["require","exports","module","./index"],function(c){function d(a,b){var c=b&&b.type||"json";return a=h[c](a,b),b&&b.parse&&e(a,b.parse),a}function e(a,b){var c=g.keys(b),d=c.map(function(a){return i[b[a]]}),e=g.isTree(a);f(e?[a]:a,c,d,e)}function f(a,b,c,d){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);d&&f.values&&e(f,b,c,!0)}}var g=c("./index"),h={},i={number:g.number,"boolean":g["boolean"],date:Date.parse};return h.json=function(a,b){var c=g.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=g.accessor(b.property)(c)),c},h.csv=function(b){var c=a.csv.parse(b);return c},h.tsv=function(b){var c=a.tsv.parse(b);return c},h.topojson=function(a,c){if(null==b)return g.error("TopoJSON library not loaded."),[];var d=g.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(g.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(g.error("Invalid TopoJSON object: "+c.mesh),[]):g.error("Missing TopoJSON feature or mesh parameter."),e},h.treejson=function(a,b){return a=g.isObject(a)?a:JSON.parse(a),g.tree(a,b.children)},d.formats=h,d.parse=e,d}),e("parse/data",["require","exports","module","./transforms","./modify","../util/index","../util/load","../util/read"],function(a){var b=a("./transforms"),c=a("./modify"),d=a("../util/index"),e=a("../util/load"),f=a("../util/read"),g=function(a,b,c){function h(b){return function(e,g){e?d.error("LOADING FAILED: "+b.url):a.data(b.name).values(f(g.toString(),b.format)),0===--i&&c()}}var i=0;return(b||[]).forEach(function(b){b.url&&(i+=1,e(b.url,h(b))),g.datasource(a,b)}),0===i&&setTimeout(c,1),b};return g.datasource=function(a,d){var e=(d.transform||[]).map(function(c){return b(a,c)}),g=(d.modify||[]).map(function(b){return c(a,b,d)}),h=a.data(d.name,g.concat(e));return d.values?h.values(f(d.values,d.format)):d.source&&(h.source(d.source),a.data(d.source).addListener(h)),h},g}),e("scene/Builder",["require","exports","module","../dataflow/Node","../dataflow/Collector","./Encoder","./Bounder","./Item","../parse/data","../dataflow/tuple","../dataflow/changeset","../util/index","../util/constants"],function(a){function b(){return arguments.length?this.init.apply(this,arguments):this}function c(){var a=[this._from,this._def.type,Date.now()].join("_"),b={name:a,source:this._from,transform:this._def.from.transform,modify:this._def.from.modify};this._from=a,this._ds=m.datasource(this._model,b);var c=this._ds.source().last(),d=o.create(c);d.add=c.add,d.mod=c.mod,d.rem=c.rem,d.stamp=null,this._ds.fire(d)}function d(a){var b=n.create(new l(this._mark));return b.datum=a,this._def.width&&n.set(b,"width",this._def.width),this._def.height&&n.set(b,"height",this._def.height),b}function e(a){var b,c,e,f,h,i=g(this._def.key||"_id"),j=o.create(a),k=a.add,l=a.mod,m=a.rem,p=a.stamp;for(b=0,e=k.length;e>b;++b)c=i(h=k[b]),f=d.call(this,h,p),n.set(f,"key",c),f.status=q.ENTER,this._map[c]=f,this._items.push(f),j.add.push(f);for(b=0,e=l.length;e>b;++b)f=this._map[c=i(h=l[b])],n.set(f,"key",c),f.datum=h,f.status=q.UPDATE,j.mod.push(f);for(b=0,e=m.length;e>b;++b)f=this._map[c=i(m[b])],f.status=q.EXIT,j.rem.push(f),this._map[c]=null;return this._items.sort(function(b,c){return a.sort?a.sort(b.datum,c.datum):b.datum._id-c.datum._id}),j}function f(a,b){var c,e,f,h,i,j=g(this._def.key),k=this._items.splice(0),l=o.create(a);for(c=0,f=k.length;f>c;++c)h=k[c],h.status=q.EXIT,j&&(this._map[h.key]=h);for(c=0,f=b.length;f>c;++c)i=b[c],e=c,h=j?this._map[e=j(i)]:k[c],h?(this._items.push(h),l.mod.push(h),n.set(h,"key",e),h.datum=i,h.status=q.UPDATE):(this._items.push(h=d.call(this,i,a.stamp)),l.add.push(h),n.set(h,"key",e),h.status=q.ENTER);for(c=0,f=k.length;f>c;++c)h=k[c],h.status===q.EXIT&&(n.set(h,"key",j?h.key:this._items.length),this._items.unshift(h),l.rem.unshift(h));return l}function g(a){if(null==a)return null;var b=p.array(a).map(p.accessor);return function(a){for(var c="",d=0,e=b.length;e>d;++d)d>0&&(c+="|"),c+=String(b[d](a));return c}}var h=a("../dataflow/Node"),i=a("../dataflow/Collector"),j=a("./Encoder"),k=a("./Bounder"),l=a("./Item"),m=a("../parse/data"),n=a("../dataflow/tuple"),o=a("../dataflow/changeset"),p=a("../util/index"),q=a("../util/constants"),r=b.prototype=new h;return r.init=function(a,b,d,e,f,g){return h.prototype.init.call(this,a.graph).router(!0).collector(!0),this._model=a,this._def=d,this._mark=e,this._from=(d.from?d.from.data:null)||g,this._ds=p.isString(this._from)?a.data(this._from):null,this._map={},this._items=[],this._lastBuild=0,e.def=d,e.marktype=d.type,e.interactive=!(d.interactive===!1),e.items=this._items,d.from&&(d.from.transform||d.from.modify)&&c.call(this),this._parent=f,this._encoder=new j(this._model,this._mark),this._bounder=new k(this._model,this._mark),this._collector=new i(this._model.graph),this._renderer=b,this._ds&&(this.dependency(q.DATA,this._from),this._encoder.dependency(q.DATA,this._from)),this.connect()},r.evaluate=function(a){p.debug(a,["building",this._from,this._def.type]);var b,c,d,g=this._encoder.reevaluate(a);return this._ds?(b=o.create(a),g&&(b.mod=this._items.slice()),(c=this._ds.last())?c.stamp<=this._lastBuild?b:(this._lastBuild=c.stamp,e.call(this,c)):(b.reflow=!0,b)):(d=p.isFunction(this._def.from)?this._def.from():[q.SENTINEL],f.call(this,a,d))},r._pipeline=function(){return[this,this._encoder,this._collector,this._bounder,this._renderer]},r.connect=function(){var a=this;return this._model.graph.connect(this._pipeline()),this._encoder.dependency(q.SCALES).forEach(function(b){a._parent.scale(b).addListener(a)}),this._parent&&this._bounder.addListener(this._parent._collector),this},r.disconnect=function(){var a=this;return this._model.graph.disconnect(this._pipeline()),this._encoder.dependency(q.SCALES).forEach(function(b){a._parent.scale(b).removeListener(a)}),this},b}),e("parse/scale",["require","exports","module","d3","../util/config","../util/index","../util/constants"],function(a){function b(a,b,f){var g=c(b,f.scale(b.name)),h=g.type===p?d:e,i=j(a,b,f),k=m.values(f.datum);return h(a,b,g,i,k),g}function c(a,b){var c=a.type||o;if(!b||c!==b.type){var d=l.scale[c]||k.scale[c];d||m.error("Unrecognized scale type: "+c),(b=d()).type=b.type||c,b.scaleName=a.name}return b}function d(a,b,c,d,e){var g,i,j,k,l=!1;m.isObject(b.range)&&!m.isArray(b.range)&&(l=!0,k=b.range.fields||m.array(b.range),d=f(a,k,e)),i=b.sort&&!l,g=h(a,b,e,i),g&&c.domain(g),j="string"==typeof d[0],j||d.length>2||1===d.length||l?c.range(d):b.points?c.rangePoints(d,b.padding||0):b.round||void 0===b.round?c.rangeRoundBands(d,b.padding||0):c.rangeBands(d,b.padding||0)}function e(a,b,c,d,e){var f,g;f=b.type===t?h(a,b,e,!1):i(a,b,e),c.domain(f),"height"===b.range&&(d=d.reverse()),c[b.round&&c.rangeRound?"rangeRound":"range"](d),b.exponent&&b.type===r&&c.exponent(b.exponent),b.clamp&&c.clamp(!0),b.nice&&(b.type===s?(g=k.time[b.nice],g||m.error("Unrecognized interval: "+g),c.nice(g)):c.nice())}function f(a,b,c){return b.reduce(function(b,d){var e=m.values(a.data(d.data)||c),f=m.accessor(m.isString(d.field)?d.field:"data."+m.accessor(d.field.group)(c));return m.unique(e,f,b)},[])}function g(a,b){return b.signal?a.graph.signalRef(b.signal):b}function h(a,b,c,d){var e,h,i=b.domain;return m.isArray(i)?(e=d?i.slice():i,e=e.map(g.bind(null,a))):m.isObject(i)&&(h=i.fields||m.array(i),e=f(a,h,c)),e&&d&&e.sort(m.cmp),e}function i(a,b,c){function d(b,d,e,f){var g=m.values(a.data(b.data)||c),i=m.array(b.field).map(function(a){return m.isString(a)?a:"data."+m.accessor(a.group)(c)});i.forEach(function(a){a=m.accessor(a),d&&(h[0]=k.min([h[0],k.min(g,a)])),e&&(h[f]=k.max([h[f],k.max(g,a)]))})}var e,f,h=[null,null];return void 0!==b.domain&&(m.isArray(b.domain)?h=b.domain.slice().map(g.bind(null,a)):m.isObject(b.domain)?(e=b.domain.fields||m.array(b.domain),e.forEach(function(a){d(a,1,1,1)})):h=b.domain),f=h.length-1,void 0!==b.domainMin&&(m.isObject(b.domainMin)?b.domainMin.signal?h[0]=g(a,b.domainMin):(h[0]=null,e=b.domainMin.fields||m.array(b.domainMin),e.forEach(function(a){d(a,1,0,f)})):h[0]=b.domainMin),void 0!==b.domainMax&&(m.isObject(b.domainMax)?b.domainMax.signal?h[f]=g(a,b.domainMax):(h[f]=null,e=b.domainMax.fields||m.array(b.domainMax),e.forEach(function(a){d(a,0,1,f)})):h[f]=b.domainMax),b.type===q||b.type===s||!b.zero&&void 0!==b.zero||(h[0]=Math.min(0,h[0]),h[f]=Math.max(0,h[f])),h}function j(a,b,c){var d=[null,null];if(void 0!==b.range)if("string"==typeof b.range)if(u[b.range])d=[0,c[b.range]];else{if(!l.range[b.range])return m.error("Unrecogized range: "+b.range),d;d=l.range[b.range]}else if(m.isArray(b.range))d=b.range.map(g.bind(null,a));else{if(m.isObject(b.range))return null;d=[0,b.range]}if(void 0!==b.rangeMin&&(d[0]=b.rangeMin.signal?g(a,b.rangeMin):b.rangeMin),void 0!==b.rangeMax&&(d[d.length-1]=b.rangeMax.signal?g(a,b.rangeMax):b.rangeMax),void 0!==b.reverse){var e=b.reverse;m.isObject(e)&&(e=m.accessor(e.field)(c.datum)),e&&(d=d.reverse())}return d}var k=a("d3"),l=a("../util/config"),m=a("../util/index"),n=a("../util/constants"),o=n.LINEAR,p=n.ORDINAL,q=n.LOG,r=n.POWER,s=n.TIME,t=n.QUANTILE,u={width:1,height:1};return b}),e("scene/scale",["require","exports","module","../dataflow/Node","../parse/scale","../util/index","../dataflow/changeset"],function(a){var b=a("../dataflow/Node"),c=a("../parse/scale"),d=a("../util/index"),e=a("../dataflow/changeset"),f="ordinal";return function g(a,h){function i(){var a=[];return["domain","range"].forEach(function(b){d.isArray(h[b])&&h[b].forEach(function(b){b.signal&&a.push(b.signal)}),h[b+"Min"]&&h[b+"Min"].signal&&a.push(h[b+"Min"].signal),h[b+"Max"]&&h[b+"Max"].signal&&a.push(h[b+"Max"].signal)}),a.map(function(a){return d.field(a)[0]})}function j(b,c){var d=a.data(k.data||"vg_"+b.datum._id),e=d?d.last():null,g=e?!!e.add.length||!!e.rem.length:!1;return k.field&&(g=g||e.fields[k.field]),g=g||e?!!e.sort&&h.type===f:!1,g=g||l.reevaluate(c),c.scales[h.name]=1,g}function g(b){d.debug({},["rescaling",b.datum._id]);var e=h.name,f=c(a,h,b);b.scale(e+":prev",b.scale(e)||f),b.scale(e,f);var g=l._deps.data,i=k.data?!1:"vg_"+b.datum._id;i&&-1===g.indexOf(i)&&g.push(i)}var k=h.domain||{},l=new b(a.graph);return l.evaluate=function(a){return d.debug(a,["scaling",h.name]),a.add.forEach(g),a.mod.forEach(function(b){j(b,a)&&g(b)}),e.create(a,!0)},k.data&&l._deps.data.push(k.data),k.field&&l._deps.fields.push(k.field),l._deps.signals=i(),l}}),e("parse/properties",["require","exports","module","../dataflow/tuple","../util/index","../util/config"],function(a){function b(a,b,f){var i,j,k,l,m="",n=h.keys(f),o={},p={signals:{},scales:{},data:{}};for(m+="var o = trans ? {} : item;\n",i=0,j=n.length;j>i;++i)l=f[k=n[i]],m+=i>0?"\n  ":"  ",l.rule?(l=d(a,k,l.rule),m+="\n  "+l.code):(l=e(k,l),m+="this.tpl.set(o, "+h.str(k)+", "+l.val+");"),o[k]=!0,["signals","scales","data"].forEach(function(a){null!=l[a]&&h.array(l[a]).forEach(function(b){p[a][b]=1})});o.x2&&(o.x?(m+="\n  if (o.x > o.x2) { var t = o.x;this.tpl.set(o, 'x', o.x2);this.tpl.set(o, 'x2', t); };",m+="\n  this.tpl.set(o, 'width', (o.x2 - o.x));"):m+=o.width?"\n  this.tpl.set(o, 'x', (o.x2 - o.width));":"\n  this.tpl.set(o, 'x', o.x2);"),o.y2&&(o.y?(m+="\n  if (o.y > o.y2) { var t = o.y;this.tpl.set(o, 'y', o.y2);this.tpl.set(o, 'y2', t);};",m+="\n  this.tpl.set(o, 'height', (o.y2 - o.y));"):m+=o.height?"\n  this.tpl.set(o, 'y', (o.y2 - o.height));":"\n  this.tpl.set(o, 'y', o.y2);"),c(b,o)&&(m+="\n  item.touch();"),m+="\n  if (trans) trans.interpolate(item, o);";try{var q=Function("item","group","trans","db","signals","predicates",m);return q.tpl=g,{encode:q,signals:h.keys(p.signals),scales:h.keys(p.scales),data:h.keys(p.data)}}catch(r){h.error(r),h.log(m)}}function c(a,b){return b.path||("area"===a||"line"===a)&&(b.x||b.x2||b.width||b.y||b.y2||b.height||b.tension||b.interpolate)
}function d(a,b,c){var d=[],f=[],g=[],i=[],j="";return(c||[]).forEach(function(k,l){var m,n=k.predicate,o=a.predicate(n),p=[],q=b+"_arg"+l;h.keys(k.input).forEach(function(a){var b=e(l,k.input[a]);p.push(h.str(a)+": "+b.val),d.concat(b.signals),f.concat(b.scales)}),m=e(b,k),d.concat(m.signals),f.concat(m.scales),n?(d.push.apply(d,o.signals),g.push.apply(g,o.data),i.push(q+" = {"+p.join(", ")+"}"),j+="if(predicates["+h.str(n)+"]("+q+", db, signals, predicates)) {\n    this.tpl.set(o, "+h.str(b)+", "+m.val+");\n",j+=c[l+1]?"  } else ":"  }"):j+="{\n    this.tpl.set(o, "+h.str(b)+", "+m.val+");\n  }"}),j="var "+i.join(",\n      ")+";\n  "+j,{code:j,signals:d,scales:f,data:g}}function e(a,b){if(null==b)return null;var c="fill"===a||"stroke"===a,d=null;if(c){if(b.c)return f("hcl",b.h,b.c,b.l);if(b.h||b.s)return f("hsl",b.h,b.s,b.l);if(b.l||b.a)return f("lab",b.l,b.a,b.b);if(b.r||b.g||b.b)return f("rgb",b.r,b.g,b.b)}var e=null;if(void 0!==b.value&&(e=h.str(b.value)),void 0!==b.signal){var g=h.field(b.signal);e="signals["+g.map(h.str).join("][")+"]",d=g.shift()}if(null!=b.group){var i="group.datum";h.isString(b.group)&&(i=j[b.group]?"group."+b.group:"group.datum["+h.field(b.group).map(h.str).join("][")+"]")}if(null!=b.field?h.isString(b.field)?(e="item.datum["+h.field(b.field).map(h.str).join("][")+"]",null!=b.group&&(e="this.accessor("+e+")("+i+")")):e="this.accessor(group.datum["+h.field(b.field.group).map(h.str).join("][")+"])(item.datum.data)":null!=b.group&&(e=i),null!=b.scale){var k=h.isString(b.scale)?h.str(b.scale):(b.scale.group?"group":"item")+".datum["+h.str(b.scale.group||b.scale.field)+"]";k="group.scale("+k+")",b.invert&&(k+=".invert"),e=null!==e||b.band||b.mult||b.offset?k+(b.band?".rangeBand()":"("+(null!==e?e:"item.datum.data")+")"):k}return e="("+(b.mult?h.number(b.mult)+" * ":"")+e+")"+(b.offset?" + "+h.number(b.offset):""),{val:e,signals:d,scales:b.scale}}function f(a,b,c,d){var f=b?e("",b):i.color[a][0],g=c?e("",c):i.color[a][1],h=d?e("",d):i.color[a][2];return"(this.d3."+a+"("+[f,g,h].join(",")+') + "")'}var g=a("../dataflow/tuple"),h=a("../util/index"),i=a("../util/config"),j={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return b}),e("parse/mark",["require","exports","module","../util/index","./properties"],function(a){var b=a("../util/index"),c=a("./properties");return function d(a,e){var f=e.properties,g=e.marks;return b.keys(f).forEach(function(b){f[b]=c(a,e.type,f[b])}),e.delay&&(e.delay=c(a,e.type,{delay:e.delay})),g&&(e.marks=g.map(function(b){return d(a,b)})),e}}),e("scene/axis",["require","exports","module","../util/config","../dataflow/tuple","../util/index","../parse/mark"],function(b){function c(b){function c(){x.type=null}function e(a){var c,d,e;"ordinal"===a.type?(c={scale:a.scaleName,offset:.5+a.rangeBand()/2},d=c):(c={scale:a.scaleName,offset:.5},d={scale:a.scaleName+":prev",offset:.5}),e=f(a),Q.gridLines||(Q.gridLines=l()),Q.majorTicks||(Q.majorTicks=l()),Q.minorTicks||(Q.minorTicks=l()),Q.tickLabels||(Q.tickLabels=m()),Q.domain||(Q.domain=o()),Q.title||(Q.title=n()),Q.gridLines.properties.enter.stroke={value:p.axis.gridColor},h(u,Q.gridLines,d,c,1/0),h(u,Q.majorTicks,d,c,B),h(u,Q.minorTicks,d,c,C),g(u,Q.tickLabels,d,c,B,E),j(u,Q.domain,e,D),i(u,Q.title,e,w),r.extend(Q.gridLines.properties.update,K),r.extend(Q.majorTicks.properties.update,M),r.extend(Q.minorTicks.properties.update,N),r.extend(Q.tickLabels.properties.update,L),r.extend(Q.domain.properties.update,P),r.extend(Q.title.properties.update,O);var q=[Q.gridLines,Q.majorTicks,Q.minorTicks,Q.tickLabels,Q.domain,Q.title];r.extend(x,{type:"group",interactive:!1,properties:{enter:{encode:k,scales:[a.scaleName],signals:[],data:[]},update:{encode:k,scales:[a.scaleName],signals:[],data:[]}}}),x.marks=q.map(function(a){return s(b,a)})}var q,u=p.axis.orient,v=0,w=p.axis.titleOffset,x={},y="front",z=!1,A=null,B=p.axis.tickSize,C=p.axis.tickSize,D=p.axis.tickSize,E=p.axis.padding,F=null,G=null,H=null,I=0,J=[p.axis.ticks],K={},L={},M={},N={},O={},P={},Q={gridLines:null,majorTicks:null,minorTicks:null,tickLabels:null,domain:null,title:null},R={};return R.def=function(){x.type||e(q),H=G?"time"===q.type?a.time.format(G):a.format(G):null;var b=function(a){return{data:a}},c=null==F?q.ticks?q.ticks.apply(q,J):q.domain():F,f=d(q,c,I).map(b);c=c.map(b);var g=null==H?q.tickFormat?q.tickFormat.apply(q,J):String:H;c.forEach(function(a){a.label=g(a.data)});var h=A?[A].map(b):[];return x.marks[0].from=function(){return z?c:[]},x.marks[1].from=function(){return c},x.marks[2].from=function(){return f},x.marks[3].from=x.marks[1].from,x.marks[4].from=function(){return[1]},x.marks[5].from=function(){return h},x.offset=v,x.orient=u,x.layer=y,x},R.scale=function(a){return arguments.length?(q!==a&&(q=a,c()),R):q},R.orient=function(a){return arguments.length?(u!==a&&(u=a in t?a+"":p.axis.orient,c()),R):u},R.title=function(a){return arguments.length?(A!==a&&(A=a,c()),R):A},R.ticks=function(){return arguments.length?(J=arguments,R):J},R.tickValues=function(a){return arguments.length?(F=a,R):F},R.tickFormat=function(a){return arguments.length?(G!==a&&(G=a,c()),R):G},R.tickSize=function(a,b){if(!arguments.length)return B;var d=arguments.length-1,e=+a,f=d>1?+b:B,g=d>0?+arguments[d]:B;return(B!==e||C!==f||D!==g)&&c(),B=e,C=f,D=g,R},R.tickSubdivide=function(a){return arguments.length?(I=+a,R):I},R.offset=function(a){return arguments.length?(v=r.isObject(a)?a:+a,R):v},R.tickPadding=function(a){return arguments.length?(E!==+a&&(E=+a,c()),R):E},R.titleOffset=function(a){return arguments.length?(w!==+a&&(w=+a,c()),R):w},R.layer=function(a){return arguments.length?(y!==a&&(y=a,c()),R):y},R.grid=function(a){return arguments.length?(z!==a&&(z=a,c()),R):z},R.gridLineProperties=function(a){return arguments.length?(K!==a&&(K=a),R):K},R.majorTickProperties=function(a){return arguments.length?(M!==a&&(M=a),R):M},R.minorTickProperties=function(a){return arguments.length?(N!==a&&(N=a),R):N},R.tickLabelProperties=function(a){return arguments.length?(L!==a&&(L=a),R):L},R.titleProperties=function(a){return arguments.length?(O!==a&&(O=a),R):O},R.domainProperties=function(a){return arguments.length?(P!==a&&(P=a),R):P},R.reset=function(){c()},R}function d(a,b,c){if(d=[],c&&b.length>1){for(var d,f,g,h=e(a.domain()),i=-1,j=b.length,k=(b[1]-b[0])/++c;++i<j;)for(f=c;--f>0;)(g=+b[i]-f*k)>=h[0]&&d.push(g);for(--i,f=0;++f<c&&(g=+b[i]+f*k)<h[1];)d.push(g)}return d}function e(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function f(a){return a.rangeExtent?a.rangeExtent():e(a.range())}function g(a,b,c,d,e,f){e=Math.max(e,0)+f,("left"===a||"top"===a)&&(e*=-1),"top"===a||"bottom"===a?(r.extend(b.properties.enter,{x:c,y:{value:e}}),r.extend(b.properties.update,{x:d,y:{value:e},align:{value:"center"},baseline:{value:v[a]}})):(r.extend(b.properties.enter,{x:{value:e},y:c}),r.extend(b.properties.update,{x:{value:e},y:d,align:{value:u[a]},baseline:{value:"middle"}}))}function h(a,b,c,d,e){var f="left"===a||"top"===a?-1:1;e=1/0===e?"top"===a||"bottom"===a?{group:"mark.group.height",mult:-f}:{group:"mark.group.width",mult:-f}:{value:f*e},"top"===a||"bottom"===a?(r.extend(b.properties.enter,{x:c,y:{value:0},y2:e}),r.extend(b.properties.update,{x:d,y:{value:0},y2:e}),r.extend(b.properties.exit,{x:d})):(r.extend(b.properties.enter,{x:{value:0},x2:e,y:c}),r.extend(b.properties.update,{x:{value:0},x2:e,y:d}),r.extend(b.properties.exit,{y:d}))}function i(a,b,c,d){var e=~~((c[0]+c[1])/2),f="top"===a||"left"===a?-1:1;"bottom"===a||"top"===a?r.extend(b.properties.update,{x:{value:e},y:{value:f*d},angle:{value:0}}):r.extend(b.properties.update,{x:{value:f*d},y:{value:e},angle:{value:-90}})}function j(a,b,c,d){var e;("top"===a||"left"===a)&&(d=-1*d),e="bottom"===a||"top"===a?"M"+c[0]+","+d+"V0H"+c[1]+"V"+d:"M"+d+","+c[0]+"H0V"+c[1]+"H"+d,b.properties.update.path={value:e}}function k(a,b,c){var d=c?{}:a,e=a.mark.def.offset,f=a.mark.def.orient,g=b.width,h=b.height;switch(r.isObject(e)&&(e=-b.scale(e.scale)(e.value)),f){case"left":q.set(d,"x",-e),q.set(d,"y",0);break;case"right":q.set(d,"x",g+e),q.set(d,"y",0);break;case"bottom":q.set(d,"x",0),q.set(d,"y",h+e);break;case"top":q.set(d,"x",0),q.set(d,"y",-e);break;default:q.set(d,"x",0),q.set(d,"y",0)}c&&c.interpolate(a,d)}function l(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:p.axis.tickColor},strokeWidth:{value:p.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function m(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:p.axis.tickLabelColor},font:{value:p.axis.tickLabelFont},fontSize:{value:p.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function n(){return{type:"text",interactive:!0,properties:{enter:{font:{value:p.axis.titleFont},fontSize:{value:p.axis.titleFontSize},fontWeight:{value:p.axis.titleFontWeight},fill:{value:p.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function o(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:p.axis.axisColor},strokeWidth:{value:p.axis.axisWidth}},update:{}}}}var p=b("../util/config"),q=b("../dataflow/tuple"),r=b("../util/index"),s=b("../parse/mark"),t={top:1,right:1,bottom:1,left:1},u={bottom:"center",top:"center",left:"right",right:"left"},v={bottom:"top",top:"bottom",left:"middle",right:"middle"};return c}),e("parse/axes",["require","exports","module","../scene/axis","../util/config","../util/index"],function(a){function b(a,b,e,f){(b||[]).forEach(function(b,g){e[g]=e[g]||d(a),c(b,g,e[g],f)})}function c(a,b,c,d){void 0!==a.scale&&c.scale(d.scale(a.scale)),c.orient(a.orient||g[a.type]),c.offset(a.offset||0),c.layer(a.layer||"front"),c.grid(a.grid||!1),c.title(a.title||null),c.titleOffset(null!=a.titleOffset?a.titleOffset:e.axis.titleOffset),c.tickValues(a.values||null),c.tickFormat(a.format||null),c.tickSubdivide(a.subdivide||0),c.tickPadding(a.tickPadding||e.axis.padding);var h=[];if(void 0!==a.tickSize)for(var i=0;3>i;++i)h.push(a.tickSize);else{var j=e.axis.tickSize;h=[j,j,j]}if(null!=a.tickSizeMajor&&(h[0]=a.tickSizeMajor),null!=a.tickSizeMinor&&(h[1]=a.tickSizeMinor),null!=a.tickSizeEnd&&(h[2]=a.tickSizeEnd),h.length&&c.tickSize.apply(c,h),null!=a.ticks){var k=f.isArray(a.ticks)?a.ticks:[a.ticks];c.ticks.apply(c,k)}else c.ticks(e.axis.ticks);var l=a.properties;l&&l.ticks?(c.majorTickProperties(l.majorTicks?f.extend({},l.ticks,l.majorTicks):l.ticks),c.minorTickProperties(l.minorTicks?f.extend({},l.ticks,l.minorTicks):l.ticks)):(c.majorTickProperties(l&&l.majorTicks||{}),c.minorTickProperties(l&&l.minorTicks||{})),c.tickLabelProperties(l&&l.labels||{}),c.titleProperties(l&&l.title||{}),c.gridLineProperties(l&&l.grid||{}),c.domainProperties(l&&l.axis||{})}var d=a("../scene/axis"),e=a("../util/config"),f=a("../util/index"),g={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return b}),e("scene/GroupBuilder",["require","exports","module","../dataflow/Node","./Builder","./scale","../parse/axes","../util/index","../util/constants"],function(a){function b(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=d.bind(this),arguments.length?this.init.apply(this,arguments):this}function c(a){var b=this;return a.add.forEach(function(c){f.call(b,a,c),g.call(b,a,c)}),a.mod.forEach(function(a){b._children[a._id].forEach(function(a){a.type==m.MARK&&void 0!==b._model.data(a.from)&&b._recursor.removeListener(a.builder)}),k(b._model,b._def.axes,a.axes,a),a.axes.forEach(function(a){a.def()})}),a.rem.forEach(function(a){b._children[a._id].forEach(function(a){b._recursor.removeListener(a.builder),a.builder.disconnect()}),delete b._children[a._id]}),a}function d(a,b){var c=this;if(2===arguments.length)return c._scales[a]=b,b;for(;null==b&&(b=c._scales[a],c=c.mark?c.mark.group:c._parent););return b}function e(a,b){l.debug(a,["building group",b]),b._scales=b._scales||{},b.scale=d.bind(b),b.items=b.items||[],this._children[b._id]=this._children[b._id]||[],b.axes=b.axes||[],b.axisItems=b.axisItems||[]}function f(a,c){l.debug(a,["building marks",this._def.marks]);var d,e,f,g,h,j=this._def.marks;for(f=0,g=j.length;g>f;++f)d=j[f],e="vg_"+c.datum._id,c.items[f]={group:c},h=d.type===m.GROUP?new b:new i,h.init(this._model,this._renderer,d,c.items[f],this,e),this._recursor.addListener(h),this._children[c._id].push({builder:h,from:(d.from||{}).data||e,type:m.MARK})}function g(a,c){var d=c.axes,e=c.axisItems,f=this;k(this._model,this._def.axes,d,c),d.forEach(function(a,d){var g=f._def.axes[d].scale,h=a.def(),j=null;e[d]={group:c,axisDef:h},j=h.type===m.GROUP?new b:new i,j.init(f._model,f._renderer,h,e[d],f),j.dependency(m.SCALES,g),f._recursor.addListener(j),f._children[c._id].push({builder:j,type:m.AXIS,scale:g})})}var h=a("../dataflow/Node"),i=a("./Builder"),j=a("./scale"),k=a("../parse/axes"),l=a("../util/index"),m=a("../util/constants"),n=b.prototype=new i;return n.init=function(a,b,d){var e=this;this._scaler=new h(a.graph),(d.scales||[]).forEach(function(b){b=e.scale(b.name,j(a,b)),b.dependency(m.DATA).forEach(function(b){a.data(b).addListener(e)}),b.dependency(m.SIGNALS).forEach(function(b){a.graph.signal(b).addListener(e)}),e._scaler.addListener(b)}),this._recursor=new h(a.graph),this._recursor.evaluate=c.bind(this);var f=(d.axes||[]).reduce(function(a,b){return a[b.scale]=1,a},{});return this._recursor.dependency(m.SCALES,l.keys(f)),i.prototype.init.apply(this,arguments)},n._pipeline=function(){return[this,this._encoder,this._scaler,this._recursor,this._collector,this._bounder,this._renderer]},n.disconnect=function(){var a=this;return l.keys(a._children).forEach(function(b){a._children[b].forEach(function(b){a._recursor.removeListener(b.builder),b.builder.disconnect()})}),a._children={},i.prototype.disconnect.call(this)},n.evaluate=function(){var a=i.prototype.evaluate.apply(this,arguments),b=this;return a.add.forEach(function(c){e.call(b,a,c)}),a},b}),e("core/Model",["require","exports","module","../dataflow/Graph","../dataflow/Node","../scene/GroupBuilder","../dataflow/changeset","../util/index"],function(a){function b(){this._defs={},this._predicates={},this._scene=null,this.graph=new d,this._node=new e(this.graph),this._builder=null}function c(a){var b=this,c={};return h.isArray(a)?(a.forEach(function(a){c[a]=b._predicates[a]}),c):this._predicates[a]}var d=a("../dataflow/Graph"),e=a("../dataflow/Node"),f=a("../scene/GroupBuilder"),g=a("../dataflow/changeset"),h=a("../util/index"),i=b.prototype;return i.defs=function(a){return arguments.length?(this._defs=a,this):this._defs},i.data=function(){var a=this.graph.data.apply(this.graph,arguments);return arguments.length>1&&this._node.addListener(a._pipeline[0]),a},i.predicate=function(a,b){return 1===arguments.length?c.call(this,a):this._predicates[a]=b},i.predicates=function(){return this._predicates},i.scene=function(a){return arguments.length?(this._builder&&this._node.removeListener(this._builder.disconnect()),this._builder=new f(this,a,this._defs.marks,this._scene={}),this._node.addListener(this._builder),this):this._scene},i.scale=function(a,b){if(!a.scale)return b;var c=this._scene.items[0].scale(a.scale);return c?a.invert?c.invert(b):c(b):b},i.addListener=function(a){this._node.addListener(a)},i.removeListener=function(a){this._node.removeListener(a)},i.fire=function(a){a||(a=g.create()),this.graph.propagate(a,this._node)},b}),e("parse/events",[],function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return _b!==b&&(_b>b&&(_b=0,ac={line:1,column:1,seenCR:!1}),c(ac,_b,b),_b=b),ac}function d(a){bc>Zb||(Zb>bc&&(bc=Zb,cc=[]),cc.push(a))}function e(d,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=c(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==d?d:h(e,j),e,j,f,i.line,i.column)}function f(){var a;return a=g()}function g(){var b,c,e,f,i,j;return b=Zb,c=h(),c!==u?(e=r(),e!==u?(44===a.charCodeAt(Zb)?(f=y,Zb++):(f=u,0===dc&&d(z)),f!==u?(i=r(),i!==u?(j=g(),j!==u?($b=b,c=A(c,j),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b===u&&(b=Zb,c=h(),c!==u&&($b=b,c=B(c)),b=c),b}function h(){var b,c,e,f,g,j,k,l,m,n,o,p,q,s;return b=Zb,91===a.charCodeAt(Zb)?(c=C,Zb++):(c=u,0===dc&&d(D)),c!==u?(e=r(),e!==u?(f=i(),f!==u?(g=r(),g!==u?(44===a.charCodeAt(Zb)?(j=y,Zb++):(j=u,0===dc&&d(z)),j!==u?(k=r(),k!==u?(l=i(),l!==u?(m=r(),m!==u?(93===a.charCodeAt(Zb)?(n=E,Zb++):(n=u,0===dc&&d(F)),n!==u?(o=r(),o!==u?(62===a.charCodeAt(Zb)?(p=G,Zb++):(p=u,0===dc&&d(H)),p!==u?(q=r(),q!==u?(s=h(),s!==u?($b=b,c=I(f,l,s),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b===u&&(b=i()),b}function i(){var a,b,c,d;if(a=Zb,b=j(),b!==u){if(c=[],d=n(),d!==u)for(;d!==u;)c.push(d),d=n();else c=x;c!==u?($b=a,b=J(b,c),a=b):(Zb=a,a=x)}else Zb=a,a=x;return a===u&&(a=Zb,b=j(),b!==u&&($b=a,b=K(b)),a=b),a}function j(){var b,c,e,f;if(b=Zb,c=k(),c===u&&(c=l()),c===u&&(c=L),c!==u?(e=m(),e!==u?($b=b,c=M(c,e),b=c):(Zb=b,b=x)):(Zb=b,b=x),b===u){if(b=Zb,c=[],N.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(O)),e!==u)for(;e!==u;)c.push(e),N.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(O));else c=x;c!==u&&($b=b,c=P(c)),b=c,b===u&&(b=Zb,40===a.charCodeAt(Zb)?(c=Q,Zb++):(c=u,0===dc&&d(R)),c!==u?(e=g(),e!==u?(41===a.charCodeAt(Zb)?(f=S,Zb++):(f=u,0===dc&&d(T)),f!==u?($b=b,c=U(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x))}return b}function k(){var b,c,e,f;return b=Zb,46===a.charCodeAt(Zb)?(c=V,Zb++):(c=u,0===dc&&d(W)),c!==u?(e=q(),e!==u?(58===a.charCodeAt(Zb)?(f=X,Zb++):(f=u,0===dc&&d(Y)),f!==u?($b=b,c=Z(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function l(){var b,c,e,f;return b=Zb,35===a.charCodeAt(Zb)?(c=$,Zb++):(c=u,0===dc&&d(_)),c!==u?(e=q(),e!==u?(58===a.charCodeAt(Zb)?(f=X,Zb++):(f=u,0===dc&&d(Y)),f!==u?($b=b,c=ab(e),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function m(){var b;return a.substr(Zb,9)===bb?(b=bb,Zb+=9):(b=u,0===dc&&d(cb)),b===u&&(a.substr(Zb,7)===db?(b=db,Zb+=7):(b=u,0===dc&&d(eb)),b===u&&(a.substr(Zb,5)===fb?(b=fb,Zb+=5):(b=u,0===dc&&d(gb)),b===u&&(a.substr(Zb,8)===hb?(b=hb,Zb+=8):(b=u,0===dc&&d(ib)),b===u&&(a.substr(Zb,5)===jb?(b=jb,Zb+=5):(b=u,0===dc&&d(kb)),b===u&&(a.substr(Zb,7)===lb?(b=lb,Zb+=7):(b=u,0===dc&&d(mb)),b===u&&(a.substr(Zb,8)===nb?(b=nb,Zb+=8):(b=u,0===dc&&d(ob)),b===u&&(a.substr(Zb,5)===pb?(b=pb,Zb+=5):(b=u,0===dc&&d(qb)),b===u&&(a.substr(Zb,10)===rb?(b=rb,Zb+=10):(b=u,0===dc&&d(sb)),b===u&&(a.substr(Zb,9)===tb?(b=tb,Zb+=9):(b=u,0===dc&&d(ub)),b===u&&(a.substr(Zb,8)===vb?(b=vb,Zb+=8):(b=u,0===dc&&d(wb)),b===u&&(a.substr(Zb,9)===xb?(b=xb,Zb+=9):(b=u,0===dc&&d(yb)),b===u&&(a.substr(Zb,10)===zb?(b=zb,Zb+=10):(b=u,0===dc&&d(Ab)))))))))))))),b}function n(){var b,c,e,f,g,h,i,j,k,l,m;return b=Zb,91===a.charCodeAt(Zb)?(c=C,Zb++):(c=u,0===dc&&d(D)),c!==u?(e=r(),e!==u?(f=o(),f!==u?(g=q(),g!==u?(h=r(),h!==u?(i=p(),i!==u?(j=r(),j!==u?(k=q(),k!==u?(l=r(),l!==u?(93===a.charCodeAt(Zb)?(m=E,Zb++):(m=u,0===dc&&d(F)),m!==u?($b=b,c=Bb(f,g,i,k),b=c):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x)):(Zb=b,b=x),b}function o(){var b;return a.substr(Zb,2)===Cb?(b=Cb,Zb+=2):(b=u,0===dc&&d(Db)),b===u&&(a.substr(Zb,2)===Eb?(b=Eb,Zb+=2):(b=u,0===dc&&d(Fb)),b===u&&(a.substr(Zb,2)===Gb?(b=Gb,Zb+=2):(b=u,0===dc&&d(Hb)),b===u&&(a.substr(Zb,2)===Ib?(b=Ib,Zb+=2):(b=u,0===dc&&d(Jb))))),b}function p(){var b;return a.substr(Zb,2)===Kb?(b=Kb,Zb+=2):(b=u,0===dc&&d(Lb)),b===u&&(a.substr(Zb,2)===Mb?(b=Mb,Zb+=2):(b=u,0===dc&&d(Nb)),b===u&&(62===a.charCodeAt(Zb)?(b=G,Zb++):(b=u,0===dc&&d(H)),b===u&&(a.substr(Zb,2)===Ob?(b=Ob,Zb+=2):(b=u,0===dc&&d(Pb)),b===u&&(60===a.charCodeAt(Zb)?(b=Qb,Zb++):(b=u,0===dc&&d(Rb)),b===u&&(a.substr(Zb,2)===Sb?(b=Sb,Zb+=2):(b=u,0===dc&&d(Tb))))))),b}function q(){var b,c,e;if(b=Zb,c=[],Ub.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(Vb)),e!==u)for(;e!==u;)c.push(e),Ub.test(a.charAt(Zb))?(e=a.charAt(Zb),Zb++):(e=u,0===dc&&d(Vb));else c=x;return c!==u&&($b=b,c=Wb(c)),b=c}function r(){var b,c;for(b=[],Xb.test(a.charAt(Zb))?(c=a.charAt(Zb),Zb++):(c=u,0===dc&&d(Yb));c!==u;)b.push(c),Xb.test(a.charAt(Zb))?(c=a.charAt(Zb),Zb++):(c=u,0===dc&&d(Yb));return b}var s,t=arguments.length>1?arguments[1]:{},u={},v={start:f},w=f,x=u,y=",",z={type:"literal",value:",",description:'","'},A=function(a,b){return[a].concat(b)},B=function(a){return[a]},C="[",D={type:"literal",value:"[",description:'"["'},E="]",F={type:"literal",value:"]",description:'"]"'},G=">",H={type:"literal",value:">",description:'">"'},I=function(a,b,c){return{start:a,end:b,middle:c}},J=function(a,b){return a.filters=b,a},K=function(a){return a},L=null,M=function(a,b){return{event:b,target:a}},N=/^[:a-zA-z0-9_\-]/,O={type:"class",value:"[:a-zA-z0-9_\\-]",description:"[:a-zA-z0-9_\\-]"},P=function(a){return{signal:a.join("")}},Q="(",R={type:"literal",value:"(",description:'"("'},S=")",T={type:"literal",value:")",description:'")"'},U=function(a){return{stream:a}},V=".",W={type:"literal",value:".",description:'"."'},X=":",Y={type:"literal",value:":",description:'":"'},Z=function(a){return{type:"class",value:a}},$="#",_={type:"literal",value:"#",description:'"#"'},ab=function(a){return{type:"id",value:a}},bb="mousedown",cb={type:"literal",value:"mousedown",description:'"mousedown"'},db="mouseup",eb={type:"literal",value:"mouseup",description:'"mouseup"'},fb="click",gb={type:"literal",value:"click",description:'"click"'},hb="dblclick",ib={type:"literal",value:"dblclick",description:'"dblclick"'},jb="wheel",kb={type:"literal",value:"wheel",description:'"wheel"'},lb="keydown",mb={type:"literal",value:"keydown",description:'"keydown"'},nb="keypress",ob={type:"literal",value:"keypress",description:'"keypress"'},pb="keyup",qb={type:"literal",value:"keyup",description:'"keyup"'},rb="mousewheel",sb={type:"literal",value:"mousewheel",description:'"mousewheel"'},tb="mousemove",ub={type:"literal",value:"mousemove",description:'"mousemove"'},vb="mouseout",wb={type:"literal",value:"mouseout",description:'"mouseout"'},xb="mouseover",yb={type:"literal",value:"mouseover",description:'"mouseover"'},zb="mouseenter",Ab={type:"literal",value:"mouseenter",description:'"mouseenter"'},Bb=function(a,b,c,d){return a+b+c+d},Cb="e.",Db={type:"literal",value:"e.",description:'"e."'},Eb="i.",Fb={type:"literal",value:"i.",description:'"i."'},Gb="d.",Hb={type:"literal",value:"d.",description:'"d."'},Ib="p.",Jb={type:"literal",value:"p.",description:'"p."'},Kb="==",Lb={type:"literal",value:"==",description:'"=="'},Mb="!=",Nb={type:"literal",value:"!=",description:'"!="'},Ob=">=",Pb={type:"literal",value:">=",description:'">="'},Qb="<",Rb={type:"literal",value:"<",description:'"<"'},Sb="<=",Tb={type:"literal",value:"<=",description:'"<="'},Ub=/^['"a-zA-Z0-9_\-]/,Vb={type:"class",value:"['\"a-zA-Z0-9_\\-]",description:"['\"a-zA-Z0-9_\\-]"},Wb=function(a){return a.join("")},Xb=/^[ \t\r\n]/,Yb={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},Zb=0,$b=0,_b=0,ac={line:1,column:1,seenCR:!1},bc=0,cc=[],dc=0;if("startRule"in t){if(!(t.startRule in v))throw new Error("Can't start parsing from rule \""+t.startRule+'".');w=v[t.startRule]}if(s=w(),s!==u&&Zb===a.length)return s;throw s!==u&&Zb<a.length&&d({type:"end",description:"end of input"}),e(null,cc,bc)}return a(b,Error),{SyntaxError:b,parse:c}}),e("parse/streams",["require","exports","module","d3","../dataflow/Node","../dataflow/changeset","./events","./expr","../util/index","../util/constants"],function(a){var b=a("d3"),c=a("../dataflow/Node"),d=a("../dataflow/changeset"),e=a("./events"),f=a("./expr"),g=a("../util/index"),h=a("../util/constants"),i="start",j="middle",k="end";return function(a){function l(a,b,d,e){var g=new c(q);g.evaluate=function(b){var c=f.eval(q,d.fn,null,null,null,null,d.signals);return e.scale&&(c=p.scale(e,c)),a.value(c),b.signals[a.name()]=1,b.reflow=!0,b},g.dependency(h.SIGNALS,b.signal),g.addListener(a),q.signal(b.signal).addListener(g)}function m(a,b,d,e){var h=b.filters||[],i=b.target;i&&h.push("i."+i.type+"=="+g.str(i.value)),s[b.event]=s[b.event]||[],s[b.event].push({signal:a,exp:d,filters:h.map(function(a){return f(q,a)}),spec:e}),t[b.event]=t[b.event]||new c(q),t[b.event].addListener(a)}function n(a,b,d,e){var g=a.name(),h=f(q,"true"),n={};n[i]=q.signal(g+i,!1),n[j]=q.signal(g+j,!1),n[k]=q.signal(g+k,!1);var p=new c(q);p.evaluate=function(b){return n[i].value()===!0&&n[k].value()===!1?b.signals[g+i]?q.doNotPropagate:(a.value(n[j].value()),b.signals[g]=1,b):(n[k].value()===!0&&(n[i].value(!1),n[k].value(!1)),q.doNotPropagate)},p.addListener(a),[i,j,k].forEach(function(a){var c=a==j?d:h,f=a==j?e:{};b[a].event?m(n[a],b[a],c,f):b[a].signal?l(n[a],b[a],c,f):b[a].stream&&o(n[a],b[a],c,f),n[a].addListener(p)})}function o(a,b,c,d){b.forEach(function(b){b.event?m(a,b,c,d):b.signal?l(a,b,c,d):b.start?n(a,b,c,d):b.stream&&o(a,b.stream,c,d)})}var p=a.model(),q=p.graph,r=p.defs().signals,s={},t={};(r||[]).forEach(function(a){var b=q.signal(a.name);a.expr||(a.streams||[]).forEach(function(a){var c=e.parse(a.type),d=f(q,a.expr);o(b,c,d,a)})}),g.keys(s).forEach(function(c){var e=s[c],g=t[c];a.on(c,function(c,h){var i,j,k,l,m,n=d.create(null,!0),o=a.padding(),r=!1,s={};for(c.preventDefault(),b.event=c,l=b.mouse(a._el),s.x=l[0]-o.left,s.y=l[1]-o.top,h=h||{},m=h.datum||{},k=0;k<e.length;k++)j=e[k],r=j.filters.some(function(a){return!f.eval(q,a.fn,m,c,h,s,a.signals)}),r||(i=f.eval(q,j.exp.fn,m,c,h,s,j.exp.signals),j.spec.scale&&(i=p.scale(j.spec,i)),j.signal.value(i),n.signals[j.signal.name()]=1);q.propagate(n,g)})})}}),e("render/canvas/marks",["require","exports","module","../../core/Bounds","../../util/bounds","../../util/index","../../util/config","./path"],function(a){function b(a,b){var c=b.x||0,d=b.y||0,e=b.innerRadius||0,f=b.outerRadius||0,g=(b.startAngle||0)-Math.PI/2,h=(b.endAngle||0)-Math.PI/2;a.beginPath(),0===e?a.moveTo(c,d):a.arc(c,d,e,g,h,0),a.arc(c,d,f,h,g,1),a.closePath()}function c(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=E(D.area(b)));F(a,e)}function d(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=E(D.line(b)));F(a,e)}function e(a,b){if(null!=b.path){var c=b.pathCache||(b.pathCache=E(b.path));return F(a,c,b.x,b.y)}}function f(a,b){a.beginPath();var c,d,e,f,g=null!=b.size?b.size:100,h=b.x,i=b.y;if(null==b.shape||"circle"===b.shape)return c=Math.sqrt(g/Math.PI),a.arc(h,i,c,0,2*Math.PI,0),void a.closePath();switch(b.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,a.moveTo(h-d,i-c),a.lineTo(h-c,i-c),a.lineTo(h-c,i-d),a.lineTo(h+c,i-d),a.lineTo(h+c,i-c),a.lineTo(h+d,i-c),a.lineTo(h+d,i+c),a.lineTo(h+c,i+c),a.lineTo(h+c,i+d),a.lineTo(h-c,i+d),a.lineTo(h-c,i+c),a.lineTo(h-d,i+c);break;case"diamond":f=Math.sqrt(g/(2*H)),e=f*H,a.moveTo(h,i-f),a.lineTo(h+e,i),a.lineTo(h,i+f),a.lineTo(h-e,i);break;case"square":d=Math.sqrt(g),c=d/2,a.rect(h-c,i-c,d,d);break;case"triangle-down":e=Math.sqrt(g/G),f=e*G/2,a.moveTo(h,i+f),a.lineTo(h+e,i-f),a.lineTo(h-e,i-f);break;case"triangle-up":e=Math.sqrt(g/G),f=e*G/2,a.moveTo(h,i-f),a.lineTo(h+e,i+f),a.lineTo(h-e,i+f)}a.closePath()}function g(a,b){var c=b[0],e=c.strokeWidth,f=c.strokeCap;a.lineWidth=null!=e?e:C.render.lineWidth,a.lineCap=null!=f?f:C.render.lineCap,d(a,b)}function h(a,b){var c=b.x||0,d=b.y||0,e=null!=b.x2?b.x2:c,f=null!=b.y2?b.y2:d,g=b.strokeWidth,h=b.strokeCap;a.lineWidth=null!=g?g:C.render.lineWidth,a.lineCap=null!=h?h:C.render.lineCap,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f)}function i(a,b,c,d){var e,f,g,h=c.fill,i=c.stroke;a(b,d),e=null==c.opacity?1:c.opacity,0!=e&&(h||i)&&(h&&(b.globalAlpha=e*(null==c.fillOpacity?1:c.fillOpacity),b.fillStyle=r(b,c,h),b.fill()),i&&(g=null!=(g=c.strokeWidth)?g:C.render.lineWidth,g>0&&(b.globalAlpha=e*(null==c.strokeOpacity?1:c.strokeOpacity),b.strokeStyle=r(b,c,i),b.lineWidth=g,b.lineCap=null!=(f=c.strokeCap)?f:C.render.lineCap,b.vgLineDash(c.strokeDash||null),b.vgLineDashOffset(c.strokeDashOffset||0),b.stroke())))}function j(a,b,c,d){var e,f,g;for(e=0,f=c.items.length;f>e;++e)g=c.items[e],(!d||d.intersects(g.bounds))&&i(a,b,g,g)}function k(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m,n=b.items,o=0,p=n.length;p>o;++o)d=n[o],(!c||c.intersects(d.bounds))&&(j=d.x||0,k=d.y||0,l=d.width||0,m=d.height||0,g=null==d.opacity?1:d.opacity,0!=g&&((e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=r(a,d,e),a.fillRect(j,k,l,m)),(f=d.stroke)&&(i=null!=(i=d.strokeWidth)?i:C.render.lineWidth,i>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(a,d,f),a.lineWidth=i,a.lineCap=null!=(h=d.strokeCap)?h:C.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.strokeRect(j,k,l,m)))))}function l(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(i=d.x||0,j=d.y||0,k=null!=d.x2?d.x2:i,l=null!=d.y2?d.y2:j,f=null==d.opacity?1:d.opacity,0!=f&&(e=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:C.render.lineWidth,h>0&&(a.globalAlpha=f*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(a,d,e),a.lineWidth=h,a.lineCap=null!=(g=d.strokeCap)?g:C.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),a.stroke())))}function m(a,b,c){if(b.items.length)for(var d,e=this,f=b.items,g=0,h=f.length;h>g;++g)if(d=f[g],!c||c.intersects(d.bounds)){d.image&&d.image.url===d.url||(d.image=e.loadImage(d.url),d.image.url=d.url);var i,j,k,l,m;k=d.width||d.image&&d.image.width||0,l=d.height||d.image&&d.image.height||0,i=(d.x||0)-("center"===d.align?k/2:"right"===d.align?k:0),j=(d.y||0)-("middle"===d.baseline?l/2:"bottom"===d.baseline?l:0),d.image.loaded&&(a.globalAlpha=null!=(m=d.opacity)?m:1,a.drawImage(d.image,i,j,k,l))}}function n(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(a.font=B.fontString(d),a.textAlign=d.align||"left",a.textBaseline=d.baseline||"alphabetic",g=null==d.opacity?1:d.opacity,0!=g&&(i=d.x||0,j=d.y||0,(k=d.radius)&&(l=(d.theta||0)-Math.PI/2,i+=k*Math.cos(l),j+=k*Math.sin(l)),d.angle?(a.save(),a.translate(i,j),a.rotate(d.angle*Math.PI/180),i=d.dx||0,j=d.dy||0):(i+=d.dx||0,j+=d.dy||0),(e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=r(a,d,e),a.fillText(d.text,i,j)),(f=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:1,h>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=r(d,f),a.lineWidth=h,a.strokeText(d.text,i,j))),d.angle&&a.restore()))}function o(a){return function(b,c,d){j(a,b,c,d)}}function p(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.items[0].bounds))&&i(a,b,c.items[0],c.items)
}}function q(a,b,c){if(b.items.length){var d,e,f,g,h,i,j,l,m,n=b.items,o=this;for(k(a,b,c),i=0,j=n.length;j>i;++i){for(d=n[i],e=d.axisItems||[],f=d.legendItems||[],g=d.x||0,h=d.y||0,a.save(),a.translate(g,h),d.clip&&(a.beginPath(),a.rect(0,0,d.width||0,d.height||0),a.clip()),c&&c.translate(-g,-h),l=0,m=e.length;m>l;++l)"back"===e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=d.items.length;m>l;++l)o.draw(a,d.items[l],c);for(l=0,m=e.length;m>l;++l)"back"!==e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=f.length;m>l;++l)o.draw(a,f[l],c);c&&c.translate(g,h),a.restore()}}}function r(a,b,c){return c.id?s(a,c,b.bounds):c}function s(a,b,c){var d,e,f=c.width(),g=c.height(),h=c.x1+b.x1*f,i=c.y1+b.y1*g,j=c.x1+b.x2*f,k=c.y1+b.y2*g,l=a.createLinearGradient(h,i,j,k),m=b.stops;for(d=0,e=m.length;e>d;++d)l.addColorStop(m[d].offset,m[d].color);return l}function t(a,b,c,d,e,f){if(0===b.items.length||b.bounds&&!b.bounds.contains(e,f))return!1;var g,h,i,j,k,l,m,n=b.items,o=this;for(l=n.length;--l>=0;){for(h=n[l],j=h.x||0,k=h.y||0,a.save(),a.translate(j,k),m=h.items.length;--m>=0;)if(g=h.items[m],g.interactive!==!1&&(i=o.pick(g,c,d,e-j,f-k)))return a.restore(),i;a.restore()}return b.interactive?u(J.group,a,b,c,d,e,f):!1}function u(a,b,c,d,e,f,g){if(!c.items.length)return!1;var h,i,j;for(1!==b._ratio&&(d*=b._ratio,e*=b._ratio),j=c.items.length;--j>=0;)if(h=c.items[j],i=h.bounds,(!i||i.contains(f,g))&&i&&a(b,h,d,e,f,g))return h;return!1}function v(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),J.area(a,h,c,d)?h[0]:!1)}function w(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),J.line(a,h,c,d)?h[0]:!1)}function x(a){return function(b,c,d,e,f,g){return u(a,b,c,d,e,f,g)}}function y(a,b,c,d,e,f){if(!b.fontSize)return!1;if(!b.angle)return!0;var g=A.text(b,I,!0),h=-b.angle*Math.PI/180,i=Math.cos(h),j=Math.sin(h),c=b.x,d=b.y,k=i*e-j*f+(c-c*i+d*j),l=j*e+i*f+(d-c*j-d*i);return g.contains(k,l)}var z=a("../../core/Bounds"),A=a("../../util/bounds"),B=a("../../util/index"),C=a("../../util/config"),D=a("./path"),E=D.parse,F=D.render,G=(Math.PI/2,Math.sqrt(3)),H=Math.tan(30*Math.PI/180),I=new z,J={text:y,rect:function(){return!0},image:function(){return!0},group:function(a,b){return b.fill||b.stroke},rule:function(a,b,c,d){return a.isPointInStroke?(h(a,b),a.isPointInStroke(c,d)):!1},line:function(a,b,c,d){return a.isPointInStroke?(g(a,b),a.isPointInStroke(c,d)):!1},arc:function(a,c,d,e){return b(a,c),a.isPointInPath(d,e)},area:function(a,b,d,e){return c(a,b),a.isPointInPath(d,e)},path:function(a,b,c,d){return e(a,b),a.isPointInPath(c,d)},symbol:function(a,b,c,d){return f(a,b),a.isPointInPath(c,d)}};return{draw:{group:q,area:p(c),line:p(d),arc:o(b),path:o(e),symbol:o(f),rect:k,rule:l,text:n,image:m,drawOne:p,drawAll:o},pick:{group:t,area:v,line:w,arc:x(J.arc),path:x(J.path),symbol:x(J.symbol),rect:x(J.rect),rule:x(J.rule),text:x(J.text),image:x(J.image),pickAll:u}}}),e("render/canvas/Handler",["require","exports","module","d3","../../util/index","./marks"],function(a){function b(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var c=a("d3"),d=a("../../util/index"),e=a("./marks"),f=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},g=f.prototype;g.initialize=function(a,b,d){this._el=c.select(a).node(),this._canvas=c.select(a).select("canvas.marks").node(),this._padding=b,this._obj=d||null;var e=this._canvas,f=this;return h.forEach(function(a){e.addEventListener(a,function(b){g[a].call(f,b)})}),this},g.padding=function(a){return this._padding=a,this},g.model=function(a){return arguments.length?(this._model=a,this):this._model},g.handlers=function(){var a=this._handlers;return d.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])};var h=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return h.forEach(function(a){g[a]=function(b){this.fire(a,b)}}),h.push("mousemove"),h.push("mouseout"),g.mousemove=function(a){var b=this._padding,c=a.target.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=this._active,g=this.pick(this._model.scene(),d,e,d-b.left,e-b.top);return g===f?void this.fire("mousemove",a):(f&&this.fire("mouseout",a),this._active=g,void(g&&this.fire("mouseover",a)))},g.mouseout=function(a){this._active&&this.fire("mouseout",a),this._active=null},g.DOMMouseScroll=function(a){this.fire("mousewheel",a)},g.fire=function(a,b){var c=this._active,d=this._handlers[a];if(d)for(var e=0,f=d.length;f>e;++e)d[e].handler.call(this._obj,b,c)},g.on=function(a,c){var d=b(a),e=this._handlers;return e=e[d]||(e[d]=[]),e.push({type:a,handler:c}),this},g.off=function(a,c){var d=b(a),e=this._handlers[d];if(e){for(var f=e.length;--f>=0;)e[f].type===a&&(c&&e[f].handler!==c||e.splice(f,1));return this}},g.context=function(){return this._canvas.getContext("2d")},g.pick=function(a,b,c,d,f){var g=this.context(),h=a.marktype,i=e.pick[h];return i.call(this,g,a,b,c,d,f)},f}),e("render/canvas/Renderer",["require","exports","module","d3","../../core/Bounds","../../util/load","../../util/config","./marks"],function(a){function b(a,b){var c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.setAttribute("width",f*e),a.setAttribute("height",g*e),a.style.width=f+"px",a.style.height=g+"px"}return e}function c(a){if(!a.vgLineDash){var b=[];a.setLineDash?(a.vgLineDash=function(a){this.setLineDash(a||b)},a.vgLineDashOffset=function(a){this.lineDashOffset=a}):void 0!==a.webkitLineDash?(a.vgLineDash=function(a){this.webkitLineDash=a||b},a.vgLineDashOffset=function(a){this.webkitLineDashOffset=a}):void 0!==a.mozDash?(a.vgLineDash=function(a){this.mozDash=a},a.vgLineDashOffset=function(){}):(a.vgLineDash=function(){},a.vgLineDashOffset=function(){})}}function d(a,b){for(var c=new h(b);null!=(a=a.mark.group);)c.translate(a.x||0,a.y||0);return c}function e(a){return a?util.array(a).reduce(function(a,b){return a.union(d(b,b.bounds)).union(d(b,b["bounds:prev"]))},new h):null}function f(a,b){var c=null;return b&&(c=new h(b).round(),a.beginPath(),a.rect(c.x1,c.y1,c.width(),c.height()),a.clip()),c}var g=a("d3"),h=a("../../core/Bounds"),i=(a("../../util/load"),a("../../util/config")),j=a("./marks"),k=function(){this._ctx=null,this._el=null,this._imgload=0},l=k.prototype;return l.initialize=function(a,b,c,d){if(this._el=a,!a)return this;var e=g.select(a).selectAll("canvas.marks").data([1]);return e.enter().append("canvas").attr("class","marks"),e.exit().remove(),this.resize(b,c,d)},l.resize=function(a,d,e){if(this._width=a,this._height=d,this._padding=e,this._el){var f=g.select(this._el).select("canvas.marks");f.attr("width",a+e.left+e.right).attr("height",d+e.top+e.bottom);var h;this._ctx=f.node().getContext("2d"),this._ctx._ratio=h=b(f.node(),this._ctx)||1,this._ctx.setTransform(h,0,0,h,h*e.left,h*e.top)}return c(this._ctx),this},l.context=function(a){return a?(this._ctx=a,this):this._ctx},l.element=function(){return this._el},l.pendingImages=function(){return this._imgload},l.render=function(a,b){var c,d=this._ctx,g=this._padding,h=this._width+g.left+g.right,i=this._height+g.top+g.bottom,j=null;this._scene=a,d.save(),j=f(d,e(b)),d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,j),b&&(d.restore(),d.save(),c=f(d,e(b)),j.encloses(c)||(d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,c))),d.restore(),this._scene=null},l.draw=function(a,b,c){var d=b.marktype,e=j.draw[d];e.call(this,a,b,c)},l.renderAsync=function(a){var b=this;b._async_id&&clearTimeout(b._async_id),b._async_id=setTimeout(function(){b.render(a),delete b._async_id},50)},l.loadImage=function(a){var b,c=this,d=c._scene,e=null;return c._imgload+=1,i.isNode||(e=new Image,b=i.baseURL+a,e.onload=function(){util.log("LOAD IMAGE: "+b),e.loaded=!0,c._imgload-=1,c.renderAsync(d)},e.src=b),e},k}),e("render/canvas/index",["require","exports","module","./Handler","./Renderer"],function(a){return{Handler:a("./Handler"),Renderer:a("./Renderer")}}),e("render/svg/Handler",["require","exports","module","../../util/index"],function(b){function c(a){var b=this;return function(c){var d=c.target,e=d.__data__;e&&(e=e.mark?e:e[0]),a.call(b._obj,c,e)}}function d(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var e=b("../../util/index"),f=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},g=f.prototype;return g.initialize=function(b,c,d){return this._el=a.select(b).node(),this._svg=a.select(b).select("svg.marks").node(),this._padding=c,this._obj=d||null,this},g.padding=function(a){return this._padding=a,this},g.model=function(a){return arguments.length?(this._model=a,this):this._model},g.handlers=function(){var a=this._handlers;return e.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])},g.on=function(b,e){var f=d(b),g=this._handlers,h=a.select(this._svg).node(),i={type:b,handler:e,svg:c.call(this,e)};return g=g[f]||(g[f]=[]),g.push(i),h.addEventListener(f,i.svg),this},g.off=function(b,c){var e=d(b),f=this._handlers[e],g=a.select(this._svg).node();if(f){for(var h=f.length;--h>=0;)f[h].type===b&&(c&&f[h].handler!==c||(g.removeEventListener(e,f[h].svg),f.splice(h,1)));return this}},f}),e("render/svg/marks",["require","exports","module","d3","../../util/index","../../util/config"],function(a){function b(a){return a.x||0}function c(a){return a.y||0}function d(a){return a.y+a.height||0}function e(a){return null==a.size?100:a.size}function f(a){return a.shape||"circle"}function g(a){var b,c,d,e,f,g=a.mark?a:a.length?a[0]:null;if(null!==g)for(b=0,c=I.length;c>b;++b)d=I[b],e=H[d],f=g[d],null==f?"fill"===e?this.style.setProperty(e,"none",null):this.style.removeProperty(e):(f.id&&(J.current._defs.gradient[f.id]=f,f="url(#"+f.id+")"),this.style.setProperty(e,f+"",null))}function h(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",A(a))}function i(a){if(a.length){var b=a[0];B.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",B(a))}}function j(a){if(a.length){var b=a[0];C.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",C(a))}}function k(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),null!=a.path&&this.setAttribute("d",a.path)}function l(a){this.setAttribute("x",a.x||0),this.setAttribute("y",a.y||0),this.setAttribute("width",a.width||0),this.setAttribute("height",a.height||0)}function m(a){var b=a.x||0,c=a.y||0;this.setAttribute("x1",b),this.setAttribute("y1",c),this.setAttribute("x2",null!=a.x2?a.x2:b),this.setAttribute("y2",null!=a.y2?a.y2:c)}function n(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",D(a))}function o(a){var b=a.width||a.image&&a.image.width||0,c=a.height||a.image&&a.image.height||0,d=a.x-("center"===a.align?b/2:"right"===a.align?b:0),e=a.y-("middle"===a.baseline?c/2:"bottom"===a.baseline?c:0),f=z.baseURL+a.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",f),this.setAttribute("x",d),this.setAttribute("y",e),this.setAttribute("width",b),this.setAttribute("height",c)}function p(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:z.render.fontSize)+"px "+(a.font||z.render.font)}function q(a){var b=a.x||0,c=a.y||0,d=a.dx||0,e=a.dy||0,f=a.angle||0,g=a.radius||0,h=G[a.align||"left"],i="top"===a.baseline?".9em":"middle"===a.baseline?".35em":0;if(g){var j=(a.theta||0)-Math.PI/2;b+=g*Math.cos(j),c+=g*Math.sin(j)}this.setAttribute("x",b+d),this.setAttribute("y",c+e),this.setAttribute("text-anchor",h),f?this.setAttribute("transform","rotate("+f+" "+b+","+c+")"):this.removeAttribute("transform"),i?this.setAttribute("dy",i):this.removeAttribute("dy"),this.textContent=a.text,this.style.setProperty("font",p(a),null)}function r(a){var b=a.x||0,c=a.y||0;if(this.setAttribute("transform","translate("+b+","+c+")"),a.clip){var d={width:a.width||0,height:a.height||0},e=a.clip_id||(a.clip_id="clip"+F++);J.current._defs.clipping[e]=d,this.setAttribute("clip-path","url(#"+e+")")}}function s(a){var b=a.width||0,c=a.height||0;this.setAttribute("width",b),this.setAttribute("height",c)}function t(a){var b="type-"+a.type;return a.name&&(b+=" "+a.name),b}function u(a,b,c){return function(d,e,f){v(d,e,f,"mark_",a,b,c)}}function v(a,b,c,d,e,f,h){var i=h?[b.items]:b.items,j=b.interactive===!1?"none":null,k=a.node().childNodes,l="g"!==e,m=(m=k[c+1])?x.select(m):a.append("g").attr("id","g"+ ++E).attr("class",t(b.def)),n=m.attr("id"),o="#"+n+" > "+e,p=m.selectAll(o).data(i),q=p.enter().append(e);return l?(m.style("pointer-events",j),q.each(function(a){a.mark?a._svg=this:a.length&&(a[0]._svg=this)})):q.append("rect").attr("class","background").style("pointer-events",j),p.exit().remove(),p.each(f),l?p.each(g):m.selectAll(o+" > rect.background").each(s).each(g),m}function w(a,b,c,d){var e,f,g,h=v(a,b,c,d||"group_","g",r),i=h.node().childNodes,j=i.length;for(e=0;j>e;++e){var k=i[e].__data__.items,l=i[e].__data__.legendItems||[],m=i[e].__data__.axisItems||[],n=x.select(i[e]),o=0;for(f=0,g=m.length;g>f;++f)"back"===m[f].def.layer&&w.call(this,n,m[f],o++,"axis_");for(f=0,g=k.length;g>f;++f)this.draw(n,k[f],o++);for(f=0,g=m.length;g>f;++f)"back"!==m[f].def.layer&&w.call(this,n,m[f],o++,"axis_");for(f=0,g=l.length;g>f;++f)w.call(this,n,l[f],o++,"legend_")}}var x=a("d3"),y=a("../../util/index"),z=a("../../util/config"),A=x.svg.arc(),B=x.svg.area().x(b).y1(c).y0(d),C=x.svg.line().x(b).y(c),D=x.svg.symbol().type(f).size(e),E=0,F=0,G={left:"start",center:"middle",right:"end"},H={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},I=y.keys(H),J={update:{group:l,area:i,line:j,arc:h,path:k,symbol:n,rect:l,rule:m,text:q,image:o},nested:{area:!0,line:!0},style:g,draw:{group:w,area:u("path",i,!0),line:u("path",j,!0),arc:u("path",h),path:u("path",k),symbol:u("path",n),rect:u("rect",l),rule:u("line",m),text:u("text",q),image:u("image",o),draw:u},current:null};return J}),e("render/svg/Renderer",["require","exports","module","../../util/index","./marks"],function(b){var c=b("../../util/index"),d=b("./marks"),e=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},f=e.prototype;return f.initialize=function(b,c,d,e){return this._el=b,a.select(b).select("svg.marks").remove(),this._svg=a.select(b).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(c,d,e)},f.resize=function(a,b,c){return this._width=a,this._height=b,this._padding=c,this._svg.attr("width",a+c.left+c.right).attr("height",b+c.top+c.bottom),this._ctx.attr("transform","translate("+c.left+","+c.top+")"),this},f.context=function(){return this._ctx},f.element=function(){return this._el},f.updateDefs=function(){var b,d,e=this._svg,f=this._defs,g=c.keys(f.gradient),h=c.keys(f.clipping),i=e.select("defs");return 0===g.length&&0==h.length?void i.remove():(i.empty()&&(i=e.insert("defs",":first-child")),b=i.selectAll("linearGradient").data(g,c.identity),b.enter().append("linearGradient").attr("id",c.identity),b.exit().remove(),b.each(function(b){var c=f.gradient[b],d=a.select(this);d.attr({x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),stop=d.selectAll("stop").data(c.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})}),d=i.selectAll("clipPath").data(h,c.identity),d.enter().append("clipPath").attr("id",c.identity),d.exit().remove(),void d.each(function(b){var c=f.clipping[b],d=a.select(this).selectAll("rect").data([1]);d.enter().append("rect"),d.attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height)}))},f.render=function(a,b){d.current=this,b?this.renderItems(c.array(b)):this.draw(this._ctx,a,-1),this.updateDefs(),delete d.current},f.renderItems=function(a){var b,c,e,f,g;for(f=0,g=a.length;g>f;++f)b=a[f],c=b._svg,e=b.mark.marktype,b=d.nested[e]?b.mark.items:b,d.update[e].call(c,b),d.style.call(c,b)},f.draw=function(a,b,c){var e=b.marktype,f=d.draw[e];f.call(this,a,b,c)},e}),e("render/svg/index",["require","exports","module","./Handler","./Renderer"],function(a){return{Handler:a("./Handler"),Renderer:a("./Renderer")}}),e("scene/Transition",["require","exports","module","../dataflow/tuple","../util/bounds","../util/constants"],function(b){function c(b,c){this.duration=b||500,this.ease=c&&a.ease(c)||a.ease("cubic-in-out"),this.updates={next:null}}function d(a){for(var b,c,d,e,g,h,i=this.updates,j=i,k=j.next,l=this.duration,m=!0;null!=k;j=k,k=j.next)if(b=k.item,c=b.delay||0,d=(a-c)/l,0>d)m=!1;else{for(d>1&&(d=1),e=k.ease(d),g=0,h=k.length;h>g;++g)b[k[g].property]=k[g](e);b.touch(),f.item(b),1===d?(k.remove&&b.remove(),j.next=k.next,k=j):m=!1}return this.callback(),m}var e=b("../dataflow/tuple"),f=b("../util/bounds"),g=b("../util/constants"),h=c.prototype,i={text:1,url:1};return h.interpolate=function(b,c){var d,f,h,j,k=null;for(d in c)f=b[d],h=c[d],f!==h&&(i[d]||void 0===f?e.set(b,d,h):"number"!=typeof f||isFinite(f)?(j=a.interpolate(f,h),j.property=d,(k||(k=[])).push(j)):e.set(b,d,h));return null===k&&b.status===g.EXIT&&(k=[]),null!=k&&(k.item=b,k.ease=b.mark.ease||this.ease,k.next=this.updates.next,this.updates.next=k),this},h.start=function(b){for(var c=this,e=c.updates,f=e.next;null!=f;e=f,f=e.next)f.item.status===g.EXIT&&(f.remove=!0);c.callback=b,a.timer(function(a){return d.call(c,a)})},c}),e("core/View",["require","exports","module","d3","../dataflow/Node","../parse/streams","../render/canvas/index","../render/svg/index","../scene/Transition","../util/config","../util/index","../dataflow/changeset"],function(a){var b=a("d3"),c=a("../dataflow/Node"),d=a("../parse/streams"),e=a("../render/canvas/index"),f=a("../render/svg/index"),g=a("../scene/Transition"),h=a("../util/config"),i=a("../util/index"),j=a("../dataflow/changeset"),k=function(a,b,c){this._el=null,this._model=null,this._width=this.__width=b||500,this._height=this.__height=c||300,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=e,a&&this.initialize(a)},l=k.prototype;return l.model=function(a){return arguments.length?(this._model!==a&&(this._model=a,this._handler&&this._handler.model(a)),this):this._model},l.data=function(a){var b=this.model();return arguments.length?(i.keys(a).forEach(function(c){b.data(c).add(a[c])}),this):b.data()},l.width=function(a){return arguments.length?(this.__width!==a&&(this._width=this.__width=a,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__width},l.height=function(a){return arguments.length?(this.__height!==a&&(this._height=this.__height=a,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__height},l.padding=function(a){return arguments.length?(this._padding!==a&&(i.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,a),this._handler.padding(a))),this):this._padding},l.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this.model().scene().bounds,d=h.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},l.viewport=function(a){return arguments.length?(this._viewport!==a&&(this._viewport=a,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},l.renderer=function(a){return arguments.length?("canvas"===a&&(a=e),"svg"===a&&(a=f),this._io!==a&&(this._io=a,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},l.initialize=function(a){var c,e=this,f=e._width,g=e._height,h=e._padding;return b.select(a).select("div.vega").remove(),this._el=a=b.select(a).append("div").attr("class","vega").style("position","relative").node(),e._viewport&&b.select(a).style("width",(e._viewport[0]||f)+"px").style("height",(e._viewport[1]||g)+"px").style("overflow","auto"),e._renderer=(e._renderer||new this._io.Renderer).initialize(a,f,g,h),c=e._handler,e._handler=(new this._io.Handler).initialize(a,h,e).model(e._model),c?c.handlers().forEach(function(a){e._handler.on(a.type,a.handler)}):d(this),this},l.update=function(a){a=a||{};var b=this,d=a.duration?new g(a.duration,a.ease):null,e=j.create();return d&&(e.trans=d),b._build||(b._renderNode=new c(b._model.graph).router(!0),b._renderNode.evaluate=function(a){i.debug(a,["rendering"]);var c=b._model.scene();a.trans?a.trans.start(function(a){b._renderer.render(c,a)}):b._renderer.render(c);for(var d in a.data)j.finalize(b._model.data(d).last());return a},b._model.scene(b._renderNode),b._build=!0),b._model.fire(e),b.autopad(a)},l.on=function(){return this._handler.on.apply(this._handler,arguments),this},l.off=function(){return this._handler.off.apply(this._handler,arguments),this},k.factory=function(a){return function(b){b=b||{};var c=a.defs(),d=(new k).model(a).width(c.width).height(c.height).padding(c.padding).renderer(b.renderer||"canvas");return b.el&&d.initialize(b.el),b.data&&d.data(b.data),d}},k}),e("parse/padding",["require","exports","module","../util/index"],function(a){var b=a("../util/index");return function(a){if(null==a)return"auto";if(b.isString(a))return"strict"===a?"strict":"auto";if(b.isObject(a))return a;var c=b.isNumber(a)?a:20;return{top:c,left:c,right:c,bottom:c}}}),e("parse/marks",["require","exports","module","./mark"],function(a){var b=a("./mark");return function(a,c,d,e){return{type:"group",width:d,height:e,scales:c.scales||[],axes:c.axes||[],marks:(c.marks||[]).map(function(c){return b(a,c)})}}}),e("parse/signals",["require","exports","module","./expr","../util/constants"],function(a){var b=a("./expr"),c=a("../util/constants");return function(a,d){var e=a.graph;return(d||[]).forEach(function(f){var g,h=e.signal(f.name,f.init);f.expr&&(g=b(e,f.expr),h.evaluate=function(c){var i=b.eval(e,g.fn,null,null,null,null,g.signals);return d.scale&&(i=a.scale(d,i)),h.value(i),c.signals[f.name]=1,c},h.dependency(c.SIGNALS,g.signals),g.signals.forEach(function(a){e.signal(a).addListener(h)}))}),d}}),e("parse/predicates",["require","exports","module","../util/index"],function(a){var b=a("../util/index");return function(a,c){function d(a,c){var d=b.field(a),e="signals["+d.map(b.str).join("][")+"]";return c[d.shift()]=1,e}function e(c){var e=[],f=[],g={},h={};return b.array(c).forEach(function(c,i){var j="o"+i,k="";if(void 0!==c.value)k=b.str(c.value);else if(c.arg)k="args["+b.str(c.arg)+"]";else if(c.signal)k=d(c.signal,g);else if(c.predicate){var l=a.predicate(c.predicate);l.signals.forEach(function(a){g[a]=1}),l.data.forEach(function(a){h[a]=1}),b.keys(c.input).forEach(function(a){var e=c.input[a];k+="args["+b.str(a)+"] = ",e.signal?k+=d(e.signal,g):e.arg&&(k+="args["+b.str(e.arg)+"]"),k+=", "}),k+="predicates["+b.str(c.predicate)+"](args, db, signals, predicates)"}e.push(j),f.push(j+"=("+k+")")}),{code:"var "+e.join(", ")+";\n"+f.join(";\n")+";\n",signals:b.keys(g),data:b.keys(h)}}function f(a){var b=e(a.operands);return"="==a.type&&(a.type="=="),{code:b.code+"return "+["o0","o1"].join(a.type)+";",signals:b.signals,data:b.data}}function g(a){for(var b=e(a.operands),c=[],d=0,f=a.operands.length;c.push("o"+d++)<f;);return"and"==a.type?a.type="&&":"or"==a.type&&(a.type="||"),{code:b.code+"return "+c.join(a.type)+";",signals:b.signals,data:b.data}}function h(a){var c=[a.item];a.range&&c.push.apply(c,a.range),a.scale&&c.push(a.scale);var d=e(c),f=d.code;if(a.data){var g=b.field(a.field).map(b.str);f+="var where = function(d) { return d["+g.join("][")+"] == o0 };\n",f+="return db["+b.str(a.data)+"].filter(where).length > 0;"}else a.range&&(a.scale&&(f+="o1 = o3(o1);\no2 = o3(o2);\n"),f+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:f,signals:d.signals,data:d.data.concat(a.data?[a.data]:[])}}var i={"=":f,"==":f,"!=":f,">":f,">=":f,"<":f,"<=":f,and:g,"&&":g,or:g,"||":g,"in":h};return(c||[]).forEach(function(b){var c=i[b.type](b),d=Function("args","db","signals","predicates",c.code);d.signals=c.signals,d.data=c.data,a.predicate(b.name,d)}),c}}),e("parse/interactors",["require","exports","module","../util/load","../util/index","../util/constants"],function(a){var b=a("../util/load"),c=a("../util/index"),d=a("../util/constants");return function(a,e,f){function g(a){return function(b,d){if(b)c.error("LOADING FAILED: "+a.url);else{var e=c.isObject(d)?d:JSON.parse(d);h(a.name,e)}0==--q&&i()}}function h(a,b){r={},s={},e.signals=c.array(e.signals),e.predicates=c.array(e.predicates),e.signals.push.apply(e.signals,l(a,b.signals)),e.predicates.push.apply(e.predicates,m(a,b.predicates)),o(a,b.marks)}function i(){c.keys(t).length>0&&j(e.marks),f()}function j(a){var b,e,f,g;for(a=c.array(a),f=0,g=a.length;g>f;f++)b=a[f],(e=t[b.type])?(a[f]=c.duplicate(e),b.from&&(a[f].from=b.from),b.properties&&[d.ENTER,d.UPDATE,d.EXIT].forEach(function(d){a[f].properties[d]=c.extend(e.properties[d],b.properties[d])})):b.marks&&j(b.marks)}function k(a,b){return c.isString(b)?b+":"+a:(c.keys(b).forEach(function(c){a=a.replace(c,b[c])}),a)}function l(a,b){return b=c.array(b),b.forEach(function(b){b.name=r[b.name]=k(b.name,a),(b.streams||[]).forEach(function(a){a.type=k(a.type,r),a.expr=k(a.expr,r)})}),b}function m(a,b){return b=c.array(b),b.forEach(function(b){b.name=s[b.name]=k(b.name,a),[b.operands,b.range].forEach(function(a){(a||[]).forEach(function(a){a.signal?a.signal=k(a.signal,r):a.predicate&&n(a)})})}),b}function n(a){a.predicate=s[a.predicate],c.keys(a.input).forEach(function(b){var c=a.input[b];c.signal&&(c.signal=k(c.signal,r))})}function o(a,b){(b||[]).forEach(function(b){p(b.properties.enter),p(b.properties.update),p(b.properties.exit),t[k(b.name,a)]=b})}function p(a){c.keys(a).forEach(function(b){var c=a[b];c.signal?c.signal=k(c.signal,r):c.rule&&c.rule.forEach(function(a){a.signal&&(a.signal=k(a.signal,r)),a.predicate&&n(a)})})}var q=0,r={},s={},t={};return(e.interactors||[]).forEach(function(a){a.url&&(q+=1,b(a.url,g(a)))}),0===q&&setTimeout(i,1),e}}),e("parse/spec",["require","exports","module","../core/Model","../core/View","../parse/padding","../parse/marks","../parse/signals","../parse/predicates","../parse/data","../parse/interactors","../util/index"],function(a){var b=a("../core/Model"),c=a("../core/View"),d=a("../parse/padding"),e=a("../parse/marks"),f=a("../parse/signals"),g=a("../parse/predicates"),h=a("../parse/data"),i=a("../parse/interactors"),j=a("../util/index");return function(a,k,l){a=j.duplicate(a),l=l||c.factory;var m=a.width||500,n=a.height||500,o=a.viewport||null,p=new b;i(p,a,function(){p.defs({width:m,height:n,viewport:o,padding:d(a.padding),signals:f(p,a.signals),predicates:g(p,a.predicates),marks:e(p,a,m,n),data:h(p,a.data,function(){k(l(p))})})})}}),e("d3",[],function(){return a}),e("topojson",[],function(){return b}),{parse:{spec:d("parse/spec")},util:d("util/index"),config:d("util/config")}});