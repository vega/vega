!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-dataflow"),require("vega-scale"),require("vega-util")):"function"==typeof define&&define.amd?define(["exports","vega-dataflow","vega-scale","vega-util"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.vega,e.vega)}(this,(function(e,t,n,r){"use strict";function i(e){t.Transform.call(this,null,e)}function a(e){t.Transform.call(this,null,e)}function o(){return t.ingest({})}function s(e){t.Transform.call(this,null,e)}function l(e){t.Transform.call(this,[],e)}r.inherits(i,t.Transform,{transform(e,r){if(this.value&&!e.modified())return r.StopPropagation;var i=r.dataflow.locale(),a=r.fork(r.NO_SOURCE|r.NO_FIELDS),o=this.value,s=e.scale,l=null==e.count?e.values?e.values.length:10:e.count,u=n.tickCount(s,l,e.minstep),c=e.format||n.tickFormat(i,s,u,e.formatSpecifier,e.formatType,!!e.values),d=e.values?n.validTicks(s,e.values,u):n.tickValues(s,u);return o&&(a.rem=o),o=d.map(((e,n)=>t.ingest({index:n/(d.length-1||1),value:e,label:c(e)}))),e.extra&&o.length&&o.push(t.ingest({index:-1,extra:{value:o[0].value},label:""})),a.source=o,a.add=o,this.value=o,a}}),r.inherits(a,t.Transform,{transform(e,n){var i=n.dataflow,a=n.fork(n.NO_SOURCE|n.NO_FIELDS),s=e.item||o,l=e.key||t.tupleid,u=this.value;return r.isArray(a.encode)&&(a.encode=null),u&&(e.modified("key")||n.modified(l))&&r.error("DataJoin does not support modified key function or fields."),u||(n=n.addAll(),this.value=u=function(e){const t=r.fastmap().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(l)),n.visit(n.ADD,(e=>{const t=l(e);let n=u.get(t);n?n.exit?(u.empty--,a.add.push(n)):a.mod.push(n):(n=s(e),u.set(t,n),a.add.push(n)),n.datum=e,n.exit=!1})),n.visit(n.MOD,(e=>{const t=l(e),n=u.get(t);n&&(n.datum=e,a.mod.push(n))})),n.visit(n.REM,(e=>{const t=l(e),n=u.get(t);e!==n.datum||n.exit||(a.rem.push(n),n.exit=!0,++u.empty)})),n.changed(n.ADD_MOD)&&a.modifies("datum"),(n.clean()||e.clean&&u.empty>i.cleanThreshold)&&i.runAfter(u.clean),a}}),r.inherits(s,t.Transform,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,a=e.encoders,o=t.encode;if(r.isArray(o)){if(!n.changed()&&!o.every((e=>a[e])))return t.StopPropagation;o=o[0],n.encode=null}var s="enter"===o,l=a.update||r.falsy,u=a.enter||r.falsy,c=a.exit||r.falsy,d=(o&&!s?a[o]:l)||r.falsy;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{u(t,e),l(t,e)})),n.modifies(u.output),n.modifies(l.output),d!==r.falsy&&d!==l&&(t.visit(t.ADD,(t=>{d(t,e)})),n.modifies(d.output))),t.changed(t.REM)&&c!==r.falsy&&(t.visit(t.REM,(t=>{c(t,e)})),n.modifies(c.output)),s||d!==r.falsy){const r=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(r,(t=>{const r=u(t,e)||i;(d(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(r,(t=>{(d(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(d.output)}return n.changed()?n:t.StopPropagation}}),r.inherits(l,t.Transform,{transform(e,i){if(null!=this.value&&!e.modified())return i.StopPropagation;var a,o,s,l,u,c=i.dataflow.locale(),d=i.fork(i.NO_SOURCE|i.NO_FIELDS),h=this.value,f=e.type||n.SymbolLegend,m=e.scale,g=+e.limit,p=n.tickCount(m,null==e.count?5:e.count,e.minstep),y=!!e.values||f===n.SymbolLegend,v=e.format||n.labelFormat(c,m,p,f,e.formatSpecifier,e.formatType,y),b=e.values||n.labelValues(m,p);return h&&(d.rem=h),f===n.SymbolLegend?(g&&b.length>g?(i.dataflow.warn("Symbol legend count exceeds limit, filtering items."),h=b.slice(0,g-1),u=!0):h=b,r.isFunction(s=e.size)?(e.values||0!==m(h[0])||(h=h.slice(1)),l=h.reduce(((t,n)=>Math.max(t,s(n,e))),0)):s=r.constant(l=s||8),h=h.map(((n,r)=>t.ingest({index:r,label:v(n,r,h),value:n,offset:l,size:s(n,e)}))),u&&(u=b[h.length],h.push(t.ingest({index:h.length,label:`â€¦${b.length-h.length} entries`,value:u,offset:l,size:s(u,e)})))):f===n.GradientLegend?(a=m.domain(),o=n.scaleFraction(m,a[0],r.peek(a)),b.length<3&&!e.values&&a[0]!==r.peek(a)&&(b=[a[0],r.peek(a)]),h=b.map(((e,n)=>t.ingest({index:n,label:v(e,n,b),value:e,perc:o(e)})))):(s=b.length-1,o=n.labelFraction(m),h=b.map(((e,n)=>t.ingest({index:n,label:v(e,n,b),value:e,perc:n?o(e):0,perc2:n===s?1:o(b[n+1])})))),d.source=h,d.add=h,this.value=h,d}});const u=e=>e.source.x,c=e=>e.source.y,d=e=>e.target.x,h=e=>e.target.y;function f(e){t.Transform.call(this,{},e)}f.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},r.inherits(f,t.Transform,{transform(e,t){var n=e.sourceX||u,i=e.sourceY||c,a=e.targetX||d,o=e.targetY||h,s=e.as||"path",l=e.orient||"vertical",f=e.shape||"line",m=y.get(f+"-"+l)||y.get(f);return m||r.error("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[s]=m(n(e),i(e),a(e),o(e))})),t.reflow(e.modified()).modifies(s)}});const m=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,g=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.hypot(i,a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},p=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},y=r.fastmap({line:m,"line-radial":(e,t,n,r)=>m(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:g,"arc-radial":(e,t,n,r)=>g(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:p,"curve-radial":(e,t,n,r)=>p(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function v(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function b(e){t.Transform.call(this,null,e)}function w(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function M(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function x(){}b.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},r.inherits(b,t.Transform,{transform(e,t){var n,i,a,o=e.as||["startAngle","endAngle"],s=o[0],l=o[1],u=e.field||r.one,c=e.startAngle||0,d=null!=e.endAngle?e.endAngle:2*Math.PI,h=t.source,f=h.map(u),m=f.length,g=c,p=(d-c)/function(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}(f),y=v(m);for(e.sort&&y.sort(((e,t)=>f[e]-f[t])),n=0;n<m;++n)a=f[y[n]],(i=h[y[n]])[s]=g,i[l]=g+=a*p;return this.value=f,t.reflow(e.modified()).modifies(o)}});var k=.7,$=1/k,S="\\s*([+-]?\\d+)\\s*",N="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",D="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",A=/^#([0-9a-f]{3,8})$/,O=new RegExp(`^rgb\\(${S},${S},${S}\\)$`),T=new RegExp(`^rgb\\(${D},${D},${D}\\)$`),E=new RegExp(`^rgba\\(${S},${S},${S},${N}\\)$`),R=new RegExp(`^rgba\\(${D},${D},${D},${N}\\)$`),C=new RegExp(`^hsl\\(${N},${D},${D}\\)$`),L=new RegExp(`^hsla\\(${N},${D},${D},${N}\\)$`),z={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function q(){return this.rgb().formatHex()}function I(){return this.rgb().formatRgb()}function P(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=A.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?F(t):3===n?new j(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?H(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?H(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=O.exec(e))?new j(t[1],t[2],t[3],1):(t=T.exec(e))?new j(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=E.exec(e))?H(t[1],t[2],t[3],t[4]):(t=R.exec(e))?H(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=C.exec(e))?Y(t[1],t[2]/100,t[3]/100,1):(t=L.exec(e))?Y(t[1],t[2]/100,t[3]/100,t[4]):z.hasOwnProperty(e)?F(z[e]):"transparent"===e?new j(NaN,NaN,NaN,0):null}function F(e){return new j(e>>16&255,e>>8&255,255&e,1)}function H(e,t,n,r){return r<=0&&(e=t=n=NaN),new j(e,t,n,r)}function _(e,t,n,r){return 1===arguments.length?((i=e)instanceof x||(i=P(i)),i?new j((i=i.rgb()).r,i.g,i.b,i.opacity):new j):new j(e,t,n,null==r?1:r);var i}function j(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function U(){return`#${X(this.r)}${X(this.g)}${X(this.b)}`}function V(){const e=G(this.opacity);return`${1===e?"rgb(":"rgba("}${B(this.r)}, ${B(this.g)}, ${B(this.b)}${1===e?")":`, ${e})`}`}function G(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function B(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function X(e){return((e=B(e))<16?"0":"")+e.toString(16)}function Y(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new J(e,t,n,r)}function Q(e){if(e instanceof J)return new J(e.h,e.s,e.l,e.opacity);if(e instanceof x||(e=P(e)),!e)return new J;if(e instanceof J)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new J(o,s,l,e.opacity)}function J(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function W(e){return(e=(e||0)%360)<0?e+360:e}function K(e){return Math.max(0,Math.min(1,e||0))}function Z(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}w(x,P,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:q,formatHex:q,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Q(this).formatHsl()},formatRgb:I,toString:I}),w(j,_,M(x,{brighter(e){return e=null==e?$:Math.pow($,e),new j(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?k:Math.pow(k,e),new j(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new j(B(this.r),B(this.g),B(this.b),G(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:U,formatHex:U,formatHex8:function(){return`#${X(this.r)}${X(this.g)}${X(this.b)}${X(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:V,toString:V})),w(J,(function(e,t,n,r){return 1===arguments.length?Q(e):new J(e,t,n,null==r?1:r)}),M(x,{brighter(e){return e=null==e?$:Math.pow($,e),new J(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?k:Math.pow(k,e),new J(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new j(Z(e>=240?e-240:e+120,i,r),Z(e,i,r),Z(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new J(W(this.h),K(this.s),K(this.l),G(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=G(this.opacity);return`${1===e?"hsl(":"hsla("}${W(this.h)}, ${100*K(this.s)}%, ${100*K(this.l)}%${1===e?")":`, ${e})`}`}}));var ee=e=>()=>e;function te(e){return 1==(e=+e)?ne:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):ee(isNaN(t)?n:t)}}function ne(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):ee(isNaN(e)?t:e)}var re=function e(t){var n=te(t);function r(e,t){var r=n((e=_(e)).r,(t=_(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=ne(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function ie(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function ae(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=he(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function oe(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function se(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function le(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=he(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var ue=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ce=new RegExp(ue.source,"g");function de(e,t){var n,r,i,a=ue.lastIndex=ce.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=ue.exec(e))&&(r=ce.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:se(n,r)})),a=ce.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function he(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?ee(t):("number"===i?se:"string"===i?(n=P(t))?(t=n,re):de:t instanceof P?re:t instanceof Date?oe:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?ae:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?le:se:ie))(e,t)}function fe(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}const me=5;function ge(e){return n.isContinuous(e)&&e!==n.Sequential}const pe=r.toSet(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function ye(e){t.Transform.call(this,null,e),this.modified(!0)}function ve(e,t,i){n.isLogarithmic(e)&&(Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&i.warn("Log scale domain includes zero: "+r.stringValue(t)));return t}function be(e,t,i){return r.isFunction(e)&&(t||i)?n.interpolateRange(e,we(t||[0,1],i)):e}function we(e,t){return t?e.slice().reverse():e}function Me(e){t.Transform.call(this,null,e)}r.inherits(ye,t.Transform,{transform(e,t){var i=t.dataflow,a=this.value,o=function(e){var t,i=e.type,a="";if(i===n.Sequential)return n.Sequential+"-"+n.Linear;(function(e){const t=e.type;return n.isContinuous(t)&&t!==n.Time&&t!==n.UTC&&(e.scheme||e.range&&e.range.length&&e.range.every(r.isString))})(e)&&(a=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?n.Sequential+"-":3===t?n.Diverging+"-":"");return(a+i||n.Linear).toLowerCase()}(e);for(o in a&&o===a.type||(this.value=a=n.scale(o)()),e)if(!pe[o]){if("padding"===o&&ge(a.type))continue;r.isFunction(a[o])?a[o](e[o]):i.warn("Unsupported scale property: "+o)}return function(e,t,i){var a=e.type,o=t.round||!1,s=t.range;if(null!=t.rangeStep)s=function(e,t,i){e!==n.Band&&e!==n.Point&&r.error("Only band and point scales support rangeStep.");var a=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,o=e===n.Point?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*n.bandSpace(i,o,a)]}(a,t,i);else if(t.scheme&&(s=function(e,t,i){var a,o,s=t.schemeExtent;r.isArray(t.scheme)?o=n.interpolateColors(t.scheme,t.interpolate,t.interpolateGamma):(a=t.scheme.toLowerCase(),(o=n.scheme(a))||r.error(`Unrecognized scheme name: ${t.scheme}`));return i=e===n.Threshold?i+1:e===n.BinOrdinal?i-1:e===n.Quantile||e===n.Quantize?+t.schemeCount||me:i,n.isInterpolating(e)?be(o,s,t.reverse):r.isFunction(o)?n.quantizeInterpolator(be(o,s),i):e===n.Ordinal?o:o.slice(0,i)}(a,t,i),r.isFunction(s))){if(e.interpolator)return e.interpolator(s);r.error(`Scale type ${a} does not support interpolating color schemes.`)}if(s&&n.isInterpolating(a))return e.interpolator(n.interpolateColors(we(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(n.interpolate(t.interpolate,t.interpolateGamma)):r.isFunction(e.round)?e.round(o):r.isFunction(e.rangeRound)&&e.interpolate(o?fe:he);s&&e.range(we(s,t.reverse))}(a,e,function(e,t,i){let a=t.bins;if(a&&!r.isArray(a)){const t=e.domain(),n=t[0],i=r.peek(t),o=a.step;let s=null==a.start?n:a.start,l=null==a.stop?i:a.stop;o||r.error("Scale bins parameter missing step property."),s<n&&(s=o*Math.ceil(n/o)),l>i&&(l=o*Math.floor(i/o)),a=v(s,l+o/2,o)}a?e.bins=a:e.bins&&delete e.bins;e.type===n.BinOrdinal&&(a?t.domain||t.domainRaw||(e.domain(a),i=a.length):e.bins=e.domain());return i}(a,e,function(e,t,i){const a=function(e,t,n){return t?(e.domain(ve(e.type,t,n)),t.length):-1}(e,t.domainRaw,i);if(a>-1)return a;var o,s,l=t.domain,u=e.type,c=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===n.Linear||t===n.Pow||t===n.Sqrt)}(e);if(!l)return 0;ge(u)&&t.padding&&l[0]!==r.peek(l)&&(l=function(e,t,i,a,o,s){var l=Math.abs(r.peek(i)-i[0]),u=l/(l-2*a),c=e===n.Log?r.zoomLog(t,null,u):e===n.Sqrt?r.zoomPow(t,null,u,.5):e===n.Pow?r.zoomPow(t,null,u,o||1):e===n.Symlog?r.zoomSymlog(t,null,u,s||1):r.zoomLinear(t,null,u);return t=t.slice(),t[0]=c[0],t[t.length-1]=c[1],t}(u,l,t.range,t.padding,t.exponent,t.constant));if((c||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(o=(l=l.slice()).length-1||1,c&&(l[0]>0&&(l[0]=0),l[o]<0&&(l[o]=0)),null!=t.domainMin&&(l[0]=t.domainMin),null!=t.domainMax&&(l[o]=t.domainMax),null!=t.domainMid)){const e=(s=t.domainMid)>l[o]?o+1:s<l[0]?0:o;e!==o&&i.warn("Scale domainMid exceeds domain min or max.",s),l.splice(e,0,s)}e.domain(ve(u,l,i)),u===n.Ordinal&&e.unknown(t.domainImplicit?n.scaleImplicit:void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&n.tickCount(e,t.nice)||null);return l.length}(a,e,i))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),r.inherits(Me,t.Transform,{transform(e,n){const r=e.modified("sort")||n.changed(n.ADD)||n.modified(e.sort.fields)||n.modified("datum");return r&&n.source.sort(t.stableCompare(e.sort)),this.modified(r),n}});const xe="zero",ke="center",$e="normalize",Se=["y0","y1"];function Ne(e){t.Transform.call(this,null,e)}function De(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function Ae(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function Oe(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}Ne.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:xe,values:[xe,ke,$e]},{name:"as",type:"string",array:!0,length:2,default:Se}]},r.inherits(Ne,t.Transform,{transform(e,n){var i,a,o,s,l=e.as||Se,u=l[0],c=l[1],d=t.stableCompare(e.sort),h=e.field||r.one,f=e.offset===ke?De:e.offset===$e?Ae:Oe;for(i=function(e,t,n,r){var i,a,o,s,l,u,c,d,h,f=[],m=e=>e(l);if(null==t)f.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(m)])||(i[u]=c=[],f.push(c)),c.push(l);for(u=0,h=0,s=f.length;u<s;++u){for(a=0,d=0,o=(c=f[u]).length;a<o;++a)d+=Math.abs(r(c[a]));c.sum=d,d>h&&(h=d),n&&c.sort(n)}return f.max=h,f}(n.source,e.groupby,d,h),a=0,o=i.length,s=i.max;a<o;++a)f(i[a],s,h,u,c);return n.reflow(e.modified()).modifies(l)}}),e.axisticks=i,e.datajoin=a,e.encode=s,e.legendentries=l,e.linkpath=f,e.pie=b,e.scale=ye,e.sortitems=Me,e.stack=Ne}));
//# sourceMappingURL=vega-encode.min.js.map
